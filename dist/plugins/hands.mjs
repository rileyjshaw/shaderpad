var m=22,C=[0,0,5,9,13,17];function T(H){let{textureName:k,options:d}=H,h="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(i,g){let{injectGLSL:x}=g,o=null,c=null,l=-1,u=new Map,s=d?.maxHands??2;async function L(){try{let{FilesetResolver:n,HandLandmarker:a}=await import("@mediapipe/tasks-vision");c=await n.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),o=await a.createFromOptions(c,{baseOptions:{modelAssetPath:d?.modelPath||h},runningMode:"VIDEO",numHands:d?.maxHands??2,minHandDetectionConfidence:d?.minHandDetectionConfidence??.5,minHandPresenceConfidence:d?.minHandPresenceConfidence??.5,minTrackingConfidence:d?.minTrackingConfidence??.5})}catch(n){throw console.error("Failed to initialize Hand Landmarker:",n),n}}function y(n){let a=C.map(e=>n[e]).filter(e=>e&&typeof e.x=="number"&&typeof e.y=="number");if(a.length===0)return[0,0];let t=0,r=0;for(let e of a)t+=e.x,r+=e.y;return[t/a.length,r/a.length]}function f(n){if(!n.landmarks)return;let a=n.landmarks.length,t={u_nHands:a};a&&(t.u_handLandmarks=n.landmarks.flatMap(r=>{let e=y(r);return e[1]=1-e[1],r.map(p=>[p.x,1-p.y]).concat([e])})),i.updateUniforms(t)}i.registerHook("init",async()=>{i.initializeUniform("u_maxHands","int",s),i.initializeUniform("u_nHands","int",0);let n=Array.from({length:s*m},()=>[.5,.5]);i.initializeUniform("u_handLandmarks","float",n,{arrayLength:s*m}),await L()}),i.registerHook("updateTextures",n=>{Object.entries(n).forEach(([a,t])=>{if(a===k&&(u.set(a,t),!!o))try{if(t instanceof HTMLVideoElement){if(t.currentTime!==l){l=t.currentTime;let r=performance.now(),e=o.detectForVideo(t,r);f(e)}}else if(t instanceof HTMLImageElement){let r=o.detect(t);f(r)}}catch(r){console.warn("Hand detection error:",r)}})}),i.registerHook("destroy",()=>{o&&(o.close(),o=null),c=null,u.clear()}),x(`
uniform int u_maxHands;
uniform int u_nHands;
uniform vec2 u_handLandmarks[${s*m}];
vec2 handLandmark(int handIndex, int landmarkIndex) {
	return u_handLandmarks[handIndex * ${m} + landmarkIndex];
}`)}}var _=T;export{_ as default};
//# sourceMappingURL=hands.mjs.map