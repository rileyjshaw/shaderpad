var z=21,U=1,h=z+U,V=[0,0,5,9,13,17];function P(N){let{textureName:T,options:s}=N,S="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(r,v){let{injectGLSL:b,gl:k}=v,d=null,g=null,L=-1,y=new Map,C=s?.maxHands??2,c=512,_=0,t=null;async function w(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");g=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),d=await n.createFromOptions(g,{baseOptions:{modelAssetPath:s?.modelPath||S},runningMode:"VIDEO",numHands:s?.maxHands??2,minHandDetectionConfidence:s?.minHandDetectionConfidence??.5,minHandPresenceConfidence:s?.minHandPresenceConfidence??.5,minTrackingConfidence:s?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function I(e,n,u){let i=1/0,a=-1/0,H=1/0,o=-1/0,m=0,l=0;for(let O of u){let p=(n*h+O)*4,R=e[p],M=e[p+1];i=Math.min(i,R),a=Math.max(a,R),H=Math.min(H,M),o=Math.max(o,M),m+=e[p+2],l+=e[p+3]}let f=(i+a)/2,x=(H+o)/2,D=m/u.length,E=l/u.length;return[f,x,D,E]}function F(e){if(!t)return;let n=e.length,u=n*h;for(let a=0;a<n;++a){let H=e[a];for(let l=0;l<21;++l){let f=H[l],x=(a*h+l)*4;t[x]=f.x,t[x+1]=1-f.y,t[x+2]=f.z??0,t[x+3]=f.visibility??1}let o=I(t,a,V),m=(a*h+21)*4;t[m]=o[0],t[m+1]=o[1],t[m+2]=o[2],t[m+3]=o[3]}let i=Math.ceil(u/c);r.updateTextures({u_handLandmarksTex:{data:t,width:c,height:i}})}function A(e){if(!e.landmarks||!t)return;let n=e.landmarks.length;F(e.landmarks),r.updateUniforms({u_nHands:n}),s?.onResults?.(e)}r.registerHook("init",async()=>{r.initializeUniform("u_maxHands","int",C),r.initializeUniform("u_nHands","int",0);let e=C*h;_=Math.ceil(e/c);let n=c*_*4;t=new Float32Array(n),r.initializeTexture("u_handLandmarksTex",{data:t,width:c,height:_},{internalFormat:k.RGBA32F,type:k.FLOAT,minFilter:k.NEAREST,magFilter:k.NEAREST}),await w()}),r.registerHook("updateTextures",e=>{let n=e[T];if(!(!n||(y.get(T)!==n&&(L=-1),y.set(T,n),!d)))try{if(n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==L){L=n.currentTime;let i=performance.now(),a=d.detectForVideo(n,i);A(a)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let i=d.detect(n);A(i)}}catch(i){console.warn("Hand detection error:",i)}}),r.registerHook("destroy",()=>{d&&(d.close(),d=null),g=null,y.clear(),t=null}),b(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;
vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${h} + landmarkIndex;
	int x = i % ${c};
	int y = i / ${c};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}`)}}var K=P;export{K as default};
//# sourceMappingURL=hands.mjs.map