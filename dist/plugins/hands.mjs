var z=21,U=1,h=z+U,V=[0,0,5,9,13,17];function P(S){let{textureName:g,options:l}=S,v="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(r,b){let{injectGLSL:w,gl:p}=b,s=null,k=null,L=-1,y=new Map,C=l?.maxHands??2,d=512,_=0,t=null;async function I(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");k=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),s=await n.createFromOptions(k,{baseOptions:{modelAssetPath:l?.modelPath||v},runningMode:"VIDEO",numHands:l?.maxHands??2,minHandDetectionConfidence:l?.minHandDetectionConfidence??.5,minHandPresenceConfidence:l?.minHandPresenceConfidence??.5,minTrackingConfidence:l?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function R(e,n,u){let a=1/0,i=-1/0,H=1/0,o=-1/0,c=0,m=0;for(let O of u){let T=(n*h+O)*4,M=e[T],N=e[T+1];a=Math.min(a,M),i=Math.max(i,M),H=Math.min(H,N),o=Math.max(o,N),c+=e[T+2],m+=e[T+3]}let f=(a+i)/2,x=(H+o)/2,D=c/u.length,E=m/u.length;return[f,x,D,E]}function F(e){if(!t)return;let n=e.length,u=n*h;for(let i=0;i<n;++i){let H=e[i];for(let m=0;m<21;++m){let f=H[m],x=(i*h+m)*4;t[x]=f.x,t[x+1]=1-f.y,t[x+2]=f.z??0,t[x+3]=f.visibility??1}let o=R(t,i,V),c=(i*h+21)*4;t[c]=o[0],t[c+1]=o[1],t[c+2]=o[2],t[c+3]=o[3]}let a=Math.ceil(u/d);r.updateTextures({u_handLandmarksTex:{data:t,width:d,height:a}})}function A(e){if(!e.landmarks||!t)return;let n=e.landmarks.length;F(e.landmarks),r.updateUniforms({u_nHands:n})}r.registerHook("init",async()=>{r.initializeUniform("u_maxHands","int",C),r.initializeUniform("u_nHands","int",0);let e=C*h;_=Math.ceil(e/d);let n=d*_*4;t=new Float32Array(n),r.initializeTexture("u_handLandmarksTex",{data:t,width:d,height:_},{internalFormat:p.RGBA32F,type:p.FLOAT,minFilter:p.NEAREST,magFilter:p.NEAREST}),await I()}),r.registerHook("updateTextures",e=>{let n=e[g];if(!(!n||(y.get(g)!==n&&(L=-1),y.set(g,n),!s)))try{if(n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==L){L=n.currentTime;let a=performance.now(),i=s.detectForVideo(n,a);A(i)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let a=s.detect(n);A(a)}}catch(a){console.warn("Hand detection error:",a)}}),r.registerHook("destroy",()=>{s&&(s.close(),s=null),k=null,y.clear(),t=null}),w(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;
vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${h} + landmarkIndex;
	int x = i % ${d};
	int y = i / ${d};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}`)}}var K=P;export{K as default};
//# sourceMappingURL=hands.mjs.map