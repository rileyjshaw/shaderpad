var m=22,C=[0,0,5,9,13,17];function T(k){let{textureName:c,options:o}=k,h="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(r,g){let{injectGLSL:x}=g,i=null,u=null,l=-1,f=new Map,d=o?.maxHands??2;async function L(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");u=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),i=await n.createFromOptions(u,{baseOptions:{modelAssetPath:o?.modelPath||h},runningMode:"VIDEO",numHands:o?.maxHands??2,minHandDetectionConfidence:o?.minHandDetectionConfidence??.5,minHandPresenceConfidence:o?.minHandPresenceConfidence??.5,minTrackingConfidence:o?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function y(e){let n=C.map(t=>e[t]).filter(t=>t&&typeof t.x=="number"&&typeof t.y=="number");if(n.length===0)return[0,0];let s=0,a=0;for(let t of n)s+=t.x,a+=t.y;return[s/n.length,a/n.length]}function p(e){if(!e.landmarks)return;let n=e.landmarks.length,s={u_nHands:n};n&&(s.u_handLandmarks=e.landmarks.flatMap(a=>{let t=y(a);return t[1]=1-t[1],a.map(H=>[H.x,1-H.y]).concat([t])})),r.updateUniforms(s)}r.registerHook("init",async()=>{r.initializeUniform("u_maxHands","int",d),r.initializeUniform("u_nHands","int",0);let e=Array.from({length:d*m},()=>[.5,.5]);r.initializeUniform("u_handLandmarks","float",e,{arrayLength:d*m}),await L()}),r.registerHook("updateTextures",e=>{let n=e[c];if(!(!n||(f.get(c)!==n&&(l=-1),f.set(c,n),!i)))try{if(n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==l){l=n.currentTime;let a=performance.now(),t=i.detectForVideo(n,a);p(t)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let a=i.detect(n);p(a)}}catch(a){console.warn("Hand detection error:",a)}}),r.registerHook("destroy",()=>{i&&(i.close(),i=null),u=null,f.clear()}),x(`
uniform int u_maxHands;
uniform int u_nHands;
uniform vec2 u_handLandmarks[${d*m}];
vec2 handLandmark(int handIndex, int landmarkIndex) {
	return u_handLandmarks[handIndex * ${m} + landmarkIndex];
}`)}}var _=T;export{_ as default};
//# sourceMappingURL=hands.mjs.map