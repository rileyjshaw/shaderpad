var z=21,U=1,H=z+U,P=[0,0,5,9,13,17];function K(E){let{textureName:T,options:d}=E,N="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(r,S){let{injectGLSL:v,gl:g}=S,o=null,L=null,M=-1,k="VIDEO",y=new Map,_=d?.maxHands??2,c=512,A=0,t=null;async function w(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");L=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),o=await n.createFromOptions(L,{baseOptions:{modelAssetPath:d?.modelPath||N},runningMode:k,numHands:d?.maxHands??2,minHandDetectionConfidence:d?.minHandDetectionConfidence??.5,minHandPresenceConfidence:d?.minHandPresenceConfidence??.5,minTrackingConfidence:d?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function b(e,n,f){let a=1/0,i=-1/0,m=1/0,s=-1/0,l=0,u=0;for(let V of f){let p=(n*H+V)*4,R=e[p],I=e[p+1];a=Math.min(a,R),i=Math.max(i,R),m=Math.min(m,I),s=Math.max(s,I),l+=e[p+2],u+=e[p+3]}let x=(a+i)/2,h=(m+s)/2,F=l/f.length,O=u/f.length;return[x,h,F,O]}function D(e){if(!t)return;let n=e.length,f=n*H;for(let i=0;i<n;++i){let m=e[i];for(let u=0;u<21;++u){let x=m[u],h=(i*H+u)*4;t[h]=x.x,t[h+1]=1-x.y,t[h+2]=x.z??0,t[h+3]=x.visibility??1}let s=b(t,i,P),l=(i*H+21)*4;t[l]=s[0],t[l+1]=s[1],t[l+2]=s[2],t[l+3]=s[3]}let a=Math.ceil(f/c);r.updateTextures({u_handLandmarksTex:{data:t,width:c,height:a}})}function C(e){if(!e.landmarks||!t)return;let n=e.landmarks.length;D(e.landmarks),r.updateUniforms({u_nHands:n}),d?.onResults?.(e)}r.registerHook("init",async()=>{r.initializeUniform("u_maxHands","int",_),r.initializeUniform("u_nHands","int",0);let e=_*H;A=Math.ceil(e/c);let n=c*A*4;t=new Float32Array(n),r.initializeTexture("u_handLandmarksTex",{data:t,width:c,height:A},{internalFormat:g.RGBA32F,type:g.FLOAT,minFilter:g.NEAREST,magFilter:g.NEAREST}),await w()}),r.registerHook("updateTextures",async e=>{let n=e[T];if(!(!n||(y.get(T)!==n&&(M=-1),y.set(T,n),!o)))try{let a=n instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(k!==a&&(k=a,await o.setOptions({runningMode:k})),n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==M){M=n.currentTime;let i=performance.now(),m=o.detectForVideo(n,i);C(m)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let i=o.detect(n);C(i)}}catch(a){console.warn("Hand detection error:",a)}}),r.registerHook("destroy",()=>{o&&(o.close(),o=null),L=null,y.clear(),t=null}),v(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;
vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${H} + landmarkIndex;
	int x = i % ${c};
	int y = i / ${c};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}`)}}var G=K;export{G as default};
//# sourceMappingURL=hands.mjs.map