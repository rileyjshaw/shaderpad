"use strict";var _=Object.create;var y=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var j=(n,r)=>{for(var a in r)y(n,a,{get:r[a],enumerable:!0})},T=(n,r,a,d)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of R(r))!G.call(n,s)&&s!==a&&y(n,s,{get:()=>r[s],enumerable:!(d=z(r,s))||d.enumerable});return n};var N=(n,r,a)=>(a=n!=null?_(U(n)):{},T(r||!n||!n.__esModule?y(a,"default",{value:n,enumerable:!0}):a,n)),W=n=>T(y({},"__esModule",{value:!0}),n);var J={};j(J,{default:()=>B});module.exports=W(J);function q(n){let{textureName:r,options:a}=n,d="https://storage.googleapis.com/mediapipe-models/image_segmenter/hair_segmenter/float32/latest/hair_segmenter.tflite";return function(s,F){let{injectGLSL:E}=F,c=null,M=null,k=-1,f="VIDEO",S=new Map,x=2,w=512,C=512,i=document.createElement("canvas");i.width=w,i.height=C;let m=i.getContext("2d");m.fillStyle="black",m.fillRect(0,0,w,C);async function V(){try{let{FilesetResolver:t,ImageSegmenter:e}=await import("@mediapipe/tasks-vision");M=await t.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),c=await e.createFromOptions(M,{baseOptions:{modelAssetPath:a?.modelPath||d},runningMode:f,outputCategoryMask:a?.outputCategoryMask??!0,outputConfidenceMasks:a?.outputConfidenceMasks??!1});let l=c.getLabels();x=l?l.length:2}catch(t){throw console.error("[Segmenter Plugin] Failed to initialize Image Segmenter:",t),t}}async function b(t){if(!(!c||!t))try{m.clearRect(0,0,i.width,i.height);let e=t.width,l=t.height,u,p=!1;if(typeof t.getAsUint8Array=="function")u=t.getAsUint8Array();else if(typeof t.getAsFloat32Array=="function")u=t.getAsFloat32Array(),p=!0;else return;let v=e*l,g=new Uint8ClampedArray(v*4),H=Math.max(1,x-1);for(let o=0;o<v;o++){let h;p?h=Math.round(u[o]):h=u[o];let O=h/H,L=Math.round(O*255);g[o*4]=L,g[o*4+1]=0,g[o*4+2]=0,g[o*4+3]=255}let A=new ImageData(g,e,l);if(e!==i.width||l!==i.height){let o=document.createElement("canvas");o.width=e,o.height=l,o.getContext("2d").putImageData(A,0,0),m.drawImage(o,0,0,i.width,i.height)}else m.putImageData(A,0,0);s.updateTextures({u_segmentMask:i})}catch(e){console.error("[Segmenter Plugin] Failed to generate mask texture:",e)}}function I(t){let e=t.categoryMask||t.confidenceMasks&&t.confidenceMasks[0];e&&b(e).catch(l=>{console.warn("[Segmenter Plugin] Mask texture update error:",l)})}function P(t){I(t)}function D(t){I(t)}s.registerHook("init",async()=>{s.initializeTexture("u_segmentMask",i),await V()}),s.registerHook("updateTextures",async t=>{let e=t[r];if(!(!e||(S.get(r)!==e&&(k=-1),S.set(r,e),!c)))try{let u=e instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(f!==u&&(f=u,await c.setOptions({runningMode:f})),e instanceof HTMLVideoElement){if(e.videoWidth===0||e.videoHeight===0||e.readyState<2)return;if(e.currentTime!==k){k=e.currentTime;let p=performance.now();c.segmentForVideo(e,p,D)}}else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){if(e.width===0||e.height===0)return;c.segment(e,P)}}catch(u){console.error("[Segmenter Plugin] Segmentation error:",u)}}),s.registerHook("destroy",()=>{c&&(c.close(),c=null),M=null,S.clear(),i.remove()}),E(`
uniform sampler2D u_segmentMask;
float inSegment(vec2 pos) { return texture(u_segmentMask, pos).r; }`)}}var B=q;
//# sourceMappingURL=segmenter.js.map