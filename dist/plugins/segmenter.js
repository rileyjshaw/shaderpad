"use strict";var C=Object.create;var b=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var z=(n,e)=>{for(var t in e)b(n,t,{get:e[t],enumerable:!0})},A=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of O(e))!D.call(n,i)&&i!==t&&b(n,i,{get:()=>e[i],enumerable:!(s=M(e,i))||s.enumerable});return n};var H=(n,e,t)=>(t=n!=null?C(k(n)):{},A(e||!n||!n.__esModule?b(t,"default",{value:n,enumerable:!0}):t,n)),G=n=>A(b({},"__esModule",{value:!0}),n);var V={};z(V,{default:()=>Y});module.exports=G(V);var B=`#version 300 es
in vec2 aPosition;
out vec2 v_uv;
void main() {
    v_uv = aPosition * 0.5 + 0.5;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}
`,W=33.333333333333336,E=Symbol("u_history"),w=Symbol("__SHADERPAD_BUFFER");function $(n,e){if(!e?.length)return n;let t=n.split(`
`),s=t.findLastIndex(i=>{let r=i.trimStart();return r.startsWith("precision ")||r.startsWith("#version ")})+1;return t.splice(s,0,...e),t.join(`
`)}function F(n){return n instanceof WebGLTexture?{width:0,height:0}:n instanceof HTMLVideoElement?{width:n.videoWidth,height:n.videoHeight}:n instanceof HTMLImageElement?{width:n.naturalWidth??n.width,height:n.naturalHeight??n.height}:{width:n.width,height:n.height}}function T(n){return typeof n=="symbol"?n.description??"":n}var _=class{isInternalCanvas=!1;isTouchDevice=!1;gl;fragmentShaderSrc;uniforms=new Map;textures=new Map;textureUnitPool;buffer=null;program=null;aPositionLocation=0;animationFrameId;resolutionObserver;resizeObserver;resizeTimeout=null;lastResizeTime=-1/0;eventListeners=new Map;frame=0;startTime=0;cursorPosition=[.5,.5];clickPosition=[.5,.5];isMouseDown=!1;canvas;onResize;hooks=new Map;historyDepth=0;textureOptions;debug;intermediateFbo=null;constructor(e,{canvas:t,plugins:s,history:i,debug:r,...o}={}){if(this.canvas=t||document.createElement("canvas"),!t){this.isInternalCanvas=!0;let g=this.canvas;g.style.position="fixed",g.style.inset="0",g.style.height="100dvh",g.style.width="100dvw",document.body.appendChild(g)}if(this.gl=this.canvas.getContext("webgl2",{antialias:!1}),!this.gl)throw new Error("WebGL2 not supported. Please use a browser that supports WebGL2.");this.textureUnitPool={free:[],next:0,max:this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.textureOptions=o;let{internalFormat:a,type:h}=o;(h===this.gl.FLOAT||h===this.gl.HALF_FLOAT||a===this.gl.RGBA16F||a===this.gl.RGBA32F||a===this.gl.R16F||a===this.gl.R32F||a===this.gl.RG16F||a===this.gl.RG32F)&&!this.gl.getExtension("EXT_color_buffer_float")&&(console.warn("EXT_color_buffer_float not supported, falling back to RGBA8"),delete this.textureOptions?.internalFormat,delete this.textureOptions?.format,delete this.textureOptions?.type),i&&(this.historyDepth=i),this.debug=r??(typeof process<"u"&&!1),this.animationFrameId=null,this.resolutionObserver=new MutationObserver(()=>this.updateResolution()),this.resizeObserver=new ResizeObserver(()=>this.throttledHandleResize());let c=[];if(s){let g={gl:this.gl,uniforms:this.uniforms,textures:this.textures,canvas:this.canvas,reserveTextureUnit:this.reserveTextureUnit.bind(this),releaseTextureUnit:this.releaseTextureUnit.bind(this),injectGLSL:m=>{c.push(m)}};Object.defineProperty(g,"program",{get:()=>this.program,enumerable:!0,configurable:!0}),s.forEach(m=>m(this,g))}this.fragmentShaderSrc=$(e,c),this.init(),this.canvas instanceof HTMLCanvasElement&&this.addEventListeners()}registerHook(e,t){this.hooks.has(e)||this.hooks.set(e,[]),this.hooks.get(e).push(t)}init(){let e=B;if(this.program=this.gl.createProgram(),!this.program)throw new Error("Failed to create WebGL program");let t=this.createShader(this.gl.VERTEX_SHADER,e),s=this.createShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderSrc);if(this.gl.attachShader(this.program,t),this.gl.attachShader(this.program,s),this.gl.linkProgram(this.program),this.gl.deleteShader(t),this.gl.deleteShader(s),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw console.error("Program link error:",this.gl.getProgramInfoLog(this.program)),this.gl.deleteProgram(this.program),new Error("Failed to link WebGL program");this.aPositionLocation=this.gl.getAttribLocation(this.program,"aPosition"),this.setupBuffer(),this.gl.useProgram(this.program),this.canvas instanceof HTMLCanvasElement&&(this.resolutionObserver.observe(this.canvas,{attributes:!0,attributeFilter:["width","height"]}),this.resizeObserver.observe(this.canvas)),this.isInternalCanvas||this.updateResolution(),this.initializeUniform("u_cursor","float",this.cursorPosition),this.initializeUniform("u_click","float",[...this.clickPosition,this.isMouseDown?1:0]),this.initializeUniform("u_time","float",0),this.initializeUniform("u_frame","int",0),this.historyDepth>0&&(this._initializeTexture(w,this.canvas,{...this.textureOptions}),this._initializeTexture(E,this.canvas,{history:this.historyDepth,...this.textureOptions}),this.intermediateFbo=this.gl.createFramebuffer()),this.hooks.get("init")?.forEach(i=>i.call(this))}createShader(e,t){let s=this.gl.createShader(e);if(this.gl.shaderSource(s,t),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))throw console.error("Shader compilation failed:",t),console.error(this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s),new Error("Shader compilation failed");return s}setupBuffer(){let e=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.enableVertexAttribArray(this.aPositionLocation),this.gl.vertexAttribPointer(this.aPositionLocation,2,this.gl.FLOAT,!1,0,0)}throttledHandleResize(){clearTimeout(this.resizeTimeout);let e=performance.now(),t=this.lastResizeTime+W-e;t<=0?(this.lastResizeTime=e,this.handleResize()):this.resizeTimeout=setTimeout(()=>this.throttledHandleResize(),t)}handleResize(){if(!(this.canvas instanceof HTMLCanvasElement))return;let e=window.devicePixelRatio||1,t=this.canvas.clientWidth*e,s=this.canvas.clientHeight*e;this.isInternalCanvas&&(this.canvas.width!==t||this.canvas.height!==s)&&(this.canvas.width=t,this.canvas.height=s),this.onResize?.(t,s)}addEventListeners(){let e=this.canvas,t=(i,r)=>{if(!this.uniforms.has("u_cursor"))return;let o=e.getBoundingClientRect();this.cursorPosition[0]=(i-o.left)/o.width,this.cursorPosition[1]=1-(r-o.top)/o.height,this.updateUniforms({u_cursor:this.cursorPosition})},s=(i,r,o)=>{if(this.uniforms.has("u_click")){if(this.isMouseDown=i,i){let a=e.getBoundingClientRect(),h=r,u=o;this.clickPosition[0]=(h-a.left)/a.width,this.clickPosition[1]=1-(u-a.top)/a.height}this.updateUniforms({u_click:[...this.clickPosition,this.isMouseDown?1:0]})}};this.eventListeners.set("mousemove",i=>{let r=i;this.isTouchDevice||t(r.clientX,r.clientY)}),this.eventListeners.set("mousedown",i=>{let r=i;this.isTouchDevice||r.button===0&&(this.isMouseDown=!0,s(!0,r.clientX,r.clientY))}),this.eventListeners.set("mouseup",i=>{let r=i;this.isTouchDevice||r.button===0&&s(!1)}),this.eventListeners.set("touchmove",i=>{let r=i;r.touches.length>0&&t(r.touches[0].clientX,r.touches[0].clientY)}),this.eventListeners.set("touchstart",i=>{let r=i;this.isTouchDevice=!0,r.touches.length>0&&(t(r.touches[0].clientX,r.touches[0].clientY),s(!0,r.touches[0].clientX,r.touches[0].clientY))}),this.eventListeners.set("touchend",i=>{i.touches.length===0&&s(!1)}),this.eventListeners.forEach((i,r)=>{e.addEventListener(r,i)})}updateResolution(){let e=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight];this.gl.viewport(0,0,...e),this.uniforms.has("u_resolution")?this.updateUniforms({u_resolution:e}):this.initializeUniform("u_resolution","float",e),this.historyDepth>0&&(this.resizeTexture(E,...e),this.resizeTexture(w,...e)),this.hooks.get("updateResolution")?.forEach(t=>t.call(this))}resizeTexture(e,t,s){let i=this.textures.get(e);if(!i||i.width===t&&i.height===s)return;this.gl.deleteTexture(i.texture),i.width=t,i.height=s;let{texture:r}=this.createTexture(e,i);i.texture=r,i.history&&(i.history.writeIndex=0,this.clearHistoryTextureLayers(i))}reserveTextureUnit(e){let t=this.textures.get(e);if(t)return t.unitIndex;if(this.textureUnitPool.free.length>0)return this.textureUnitPool.free.pop();if(this.textureUnitPool.next>=this.textureUnitPool.max)throw new Error("Exceeded the available texture units for this device.");return this.textureUnitPool.next++}releaseTextureUnit(e){let t=this.textures.get(e);t&&this.textureUnitPool.free.push(t.unitIndex)}clearHistoryTextureLayers(e){if(!e.history)return;let t=this.gl,s=e.options?.type??t.UNSIGNED_BYTE,i=e.width*e.height*4,r=s===t.FLOAT?new Float32Array(i):s===t.HALF_FLOAT?new Uint16Array(i):new Uint8Array(i);t.activeTexture(t.TEXTURE0+e.unitIndex),t.bindTexture(t.TEXTURE_2D_ARRAY,e.texture);for(let o=0;o<e.history.depth;++o)t.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,o,e.width,e.height,1,e.options?.format??t.RGBA,s,r)}initializeUniform(e,t,s,i){let r=i?.arrayLength;if(this.uniforms.has(e))throw new Error(`${e} is already initialized.`);if(t!=="float"&&t!=="int")throw new Error(`Invalid uniform type: ${t}. Expected 'float' or 'int'.`);if(r&&!(Array.isArray(s)&&s.length===r))throw new Error(`${e} array length mismatch: must initialize with ${r} elements.`);let o=this.gl.getUniformLocation(this.program,e);if(!o&&r&&(o=this.gl.getUniformLocation(this.program,`${e}[0]`)),!o){this.log(`${e} not found in fragment shader. Skipping initialization.`);return}let a=r?s[0]:s,h=Array.isArray(a)?a.length:1;this.uniforms.set(e,{type:t,length:h,location:o,arrayLength:r});try{this.updateUniforms({[e]:s})}catch(u){throw this.uniforms.delete(e),u}this.hooks.get("initializeUniform")?.forEach(u=>u.call(this,...arguments))}log(...e){this.debug&&console.debug(...e)}updateUniforms(e,t){this.gl.useProgram(this.program),Object.entries(e).forEach(([s,i])=>{let r=this.uniforms.get(s);if(!r){this.log(`${s} not found in fragment shader. Skipping update.`);return}let o=`uniform${r.length}${r.type.charAt(0)}`;if(r.arrayLength){if(!Array.isArray(i))throw new Error(`${s} is an array, but the value passed to updateUniforms is not an array.`);let a=i.length;if(!a)return;if(a>r.arrayLength)throw new Error(`${s} received ${a} values, but maximum length is ${r.arrayLength}.`);if(i.some(c=>(Array.isArray(c)?c.length:1)!==r.length))throw new Error(`Tried to update ${s} with some elements that are not length ${r.length}.`);let h=new(r.type==="float"?Float32Array:Int32Array)(i.flat()),u=r.location;if(t?.startIndex){let c=this.gl.getUniformLocation(this.program,`${s}[${t.startIndex}]`);if(!c)throw new Error(`${s}[${t.startIndex}] not found in fragment shader. Did you pass an invalid startIndex?`);u=c}this.gl[o+"v"](u,h)}else{if(Array.isArray(i)||(i=[i]),i.length!==r.length)throw new Error(`Invalid uniform value length: ${i.length}. Expected ${r.length}.`);this.gl[o](r.location,...i)}}),this.hooks.get("updateUniforms")?.forEach(s=>s.call(this,...arguments))}createTexture(e,t){let{width:s,height:i}=t,r=t.history?.depth??0,o=this.gl.createTexture();if(!o)throw new Error("Failed to create texture");let a=t.unitIndex;if(typeof a!="number")try{a=this.reserveTextureUnit(e)}catch(g){throw this.gl.deleteTexture(o),g}let h=r>0,u=h?this.gl.TEXTURE_2D_ARRAY:this.gl.TEXTURE_2D,{options:c}=t;if(this.gl.activeTexture(this.gl.TEXTURE0+a),this.gl.bindTexture(u,o),this.gl.texParameteri(u,this.gl.TEXTURE_WRAP_S,c?.wrapS??this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(u,this.gl.TEXTURE_WRAP_T,c?.wrapT??this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(u,this.gl.TEXTURE_MIN_FILTER,c?.minFilter??this.gl.LINEAR),this.gl.texParameteri(u,this.gl.TEXTURE_MAG_FILTER,c?.magFilter??this.gl.LINEAR),h){let g=c?.type??this.gl.UNSIGNED_BYTE,m=c?.internalFormat??(g===this.gl.FLOAT?this.gl.RGBA32F:this.gl.RGBA8);this.gl.texStorage3D(u,1,m,s,i,r)}return{texture:o,unitIndex:a}}_initializeTexture(e,t,s){if(this.textures.has(e))throw new Error(`Texture '${T(e)}' is already initialized.`);let{history:i=0,...r}=s??{},{width:o,height:a}=F(t);if(!o||!a)throw new Error("Texture source must have valid dimensions");let h={width:o,height:a,options:r};i>0&&(h.history={depth:i,writeIndex:0});let{texture:u,unitIndex:c}=this.createTexture(e,h),g={texture:u,unitIndex:c,...h};i>0&&(this.initializeUniform(`${T(e)}FrameOffset`,"int",0),this.clearHistoryTextureLayers(g)),this.textures.set(e,g),this.updateTexture(e,t);let m=this.gl.getUniformLocation(this.program,T(e));m&&this.gl.uniform1i(m,c)}initializeTexture(e,t,s){this._initializeTexture(e,t,s),this.hooks.get("initializeTexture")?.forEach(i=>i.call(this,...arguments))}updateTextures(e,t){this.hooks.get("updateTextures")?.forEach(s=>s.call(this,...arguments)),Object.entries(e).forEach(([s,i])=>{this.updateTexture(s,i,t)})}updateTexture(e,t,s){let i=this.textures.get(e);if(!i)throw new Error(`Texture '${T(e)}' is not initialized.`);if(t instanceof WebGLTexture){this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,t);return}let{width:r,height:o}=F(t);if(!r||!o)return;let a="isPartial"in t&&t.isPartial;a||this.resizeTexture(e,r,o);let h="data"in t&&t.data,u=!h&&!i.options?.preserveY,c=this.gl.getParameter(this.gl.UNPACK_FLIP_Y_WEBGL);if(i.history){if(this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,i.texture),!s?.skipHistoryWrite){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,u),this.gl.texSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,i.history.writeIndex,r,o,1,i.options?.format??this.gl.RGBA,i.options?.type??this.gl.UNSIGNED_BYTE,t.data??t),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c);let g=`${T(e)}FrameOffset`;this.updateUniforms({[g]:i.history.writeIndex}),i.history.writeIndex=(i.history.writeIndex+1)%i.history.depth}}else{this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,u);let g=i.options?.format??this.gl.RGBA,m=i.options?.type??this.gl.UNSIGNED_BYTE;if(a)this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,t.x??0,t.y??0,r,o,g,m,t.data);else{let v=i.options?.internalFormat??(h?m===this.gl.FLOAT?this.gl.RGBA32F:this.gl.RGBA8:this.gl.RGBA);this.gl.texImage2D(this.gl.TEXTURE_2D,0,v,r,o,0,g,m,t.data??t)}this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c)}}draw(e){let t=this.gl,s=t.drawingBufferWidth,i=t.drawingBufferHeight,r=this.textures.get(E),o=this.textures.get(w),a=r&&!e?.skipHistoryWrite;a&&(t.bindFramebuffer(t.FRAMEBUFFER,this.intermediateFbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,o.texture,0)),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.vertexAttribPointer(this.aPositionLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.aPositionLocation),t.viewport(0,0,s,i),e?.skipClear||t.clear(t.COLOR_BUFFER_BIT),t.drawArrays(t.TRIANGLES,0,6),a&&(t.bindTexture(t.TEXTURE_2D_ARRAY,r.texture),t.copyTexSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,r.history.writeIndex,0,0,s,i),t.bindFramebuffer(t.READ_FRAMEBUFFER,this.intermediateFbo),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.blitFramebuffer(0,0,s,i,0,0,s,i,t.COLOR_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,null))}step(e,t){let s={};this.uniforms.has("u_time")&&(s.u_time=e),this.uniforms.has("u_frame")&&(s.u_frame=this.frame),this.updateUniforms(s),this.hooks.get("step")?.forEach(r=>r.call(this,e,this.frame)),this.draw(t);let i=this.textures.get(E);if(i&&!t?.skipHistoryWrite){let{writeIndex:r,depth:o}=i.history;this.updateUniforms({[`${T(E)}FrameOffset`]:r}),i.history.writeIndex=(r+1)%o}this.hooks.get("afterStep")?.forEach(r=>r.call(this,e,this.frame)),++this.frame}play(e,t){this.pause();let s=i=>{i=(i-this.startTime)/1e3;let r=t?.(i,this.frame)??void 0;this.step(i,r),this.animationFrameId=requestAnimationFrame(s),e?.(i,this.frame)};this.animationFrameId=requestAnimationFrame(s)}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}reset(){this.frame=0,this.startTime=performance.now(),this.textures.forEach(e=>{e.history&&(e.history.writeIndex=0,this.clearHistoryTextureLayers(e))}),this.hooks.get("reset")?.forEach(e=>e.call(this))}destroy(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resolutionObserver.disconnect(),this.resizeObserver.disconnect(),this.canvas instanceof HTMLCanvasElement&&this.eventListeners.forEach((e,t)=>{this.canvas.removeEventListener(t,e)}),this.program&&this.gl.deleteProgram(this.program),this.intermediateFbo&&(this.gl.deleteFramebuffer(this.intermediateFbo),this.intermediateFbo=null),this.textures.forEach(e=>{this.gl.deleteTexture(e.texture)}),this.textureUnitPool.free=[],this.textureUnitPool.next=0,this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this.hooks.get("destroy")?.forEach(e=>e.call(this)),this.isInternalCanvas&&this.canvas instanceof HTMLCanvasElement&&this.canvas.remove()}},S=_;var U={data:new Uint8Array(4),width:1,height:1};function N(n){let e=Array.from({length:n},(s,i)=>`uniform sampler2D u_confidenceMask${i};`).join(`
`),t=Array.from({length:n},(s,i)=>`		${i>0?"else ":""}if (i == ${i}) c = texelFetch(u_confidenceMask${i}, texCoord, 0).r;`).join(`
`);return`#version 300 es
precision mediump float;
in vec2 v_uv;
out vec4 outColor;
${e}

void main() {
	ivec2 texCoord = ivec2(v_uv * vec2(textureSize(u_confidenceMask0, 0)));
	float maxConfidence = 0.0;
	int maxIndex = 0;

	for (int i = 0; i < ${n}; i++) {
		float c = 0.0;
${t}
		if (c > maxConfidence) {
			maxConfidence = c;
			maxIndex = i;
		}
	}

	// Normalize index: 0 = background, 1/(n-1) to 1 for foreground categories.
	float normalizedIndex = float(maxIndex) / float(max(1, ${n-1}));
	outColor = vec4(normalizedIndex, maxConfidence, 0.0, 1.0);
}`}function X(n){let{textureName:e,options:t}=n,s="https://storage.googleapis.com/mediapipe-models/image_segmenter/hair_segmenter/float32/latest/hair_segmenter.tflite";return function(i,r){let{injectGLSL:o,gl:a}=r,h=null,u=null,c=-1,g="VIDEO",m=new Map,v=1,y=new OffscreenCanvas(1,1),p=null;async function P(){try{let{FilesetResolver:f,ImageSegmenter:l}=await import("@mediapipe/tasks-vision");u=await f.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),h=await l.createFromOptions(u,{baseOptions:{modelAssetPath:t?.modelPath||s,delegate:"GPU"},canvas:y,runningMode:g,outputCategoryMask:t?.outputCategoryMask??!1,outputConfidenceMasks:!0});let d=h.getLabels();d.length&&(v=d.length),i.updateUniforms({u_numCategories:v})}catch(f){throw console.error("[Segmenter Plugin] Failed to initialize:",f),f}}function I(f){if(!p)return;let l={};for(let d=0;d<f.length;d++)l[`u_confidenceMask${d}`]=f[d].getAsWebGLTexture();p.updateTextures(l),p.draw(),i.updateTextures({u_segmentMask:y}),f.forEach(d=>d.close())}function L(f){let{confidenceMasks:l}=f;if(!(!l||l.length===0)){if(!p){let d=N(l.length);p=new S(d,{canvas:y});for(let x=0;x<l.length;x++)p.initializeTexture(`u_confidenceMask${x}`,U)}I(l),t?.onResults?.(f)}}i.registerHook("init",async()=>{i.initializeTexture("u_segmentMask",U,{preserveY:!0,minFilter:a.NEAREST,magFilter:a.NEAREST}),i.initializeUniform("u_numCategories","int",v),await P(),t?.onReady?.()}),i.registerHook("updateTextures",async f=>{let l=f[e];if(!(!l||(m.get(e)!==l&&(c=-1),m.set(e,l),!h)))try{let x=l instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(g!==x&&(g=x,await h.setOptions({runningMode:g})),l instanceof HTMLVideoElement){if(l.videoWidth===0||l.videoHeight===0||l.readyState<2)return;if(l.currentTime!==c){c=l.currentTime;let R=h.segmentForVideo(l,performance.now());L(R)}}else if(l instanceof HTMLImageElement||l instanceof HTMLCanvasElement){if(l.width===0||l.height===0)return;let R=h.segment(l);L(R)}}catch(x){console.error("[Segmenter Plugin] Segmentation error:",x)}}),i.registerHook("destroy",()=>{h&&(h.close(),h=null),p&&(p.destroy(),p=null),u=null,m.clear()}),o(`
uniform sampler2D u_segmentMask;
uniform int u_numCategories;

vec2 segmentAt(vec2 pos) {
	vec4 mask = texture(u_segmentMask, pos);
	return vec2(mask.r, mask.g);
}`)}}var Y=X;
//# sourceMappingURL=segmenter.js.map