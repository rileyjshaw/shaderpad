{"version":3,"sources":["../../src/plugins/face.ts"],"sourcesContent":["import ShaderPad, { PluginContext, TextureSource } from '../index';\nimport type { FaceLandmarker, NormalizedLandmark } from '@mediapipe/tasks-vision';\n\nexport interface FacePluginOptions {\n\tmodelPath?: string;\n\tmaxFaces?: number;\n\tminFaceDetectionConfidence?: number;\n\tminFacePresenceConfidence?: number;\n\tminTrackingConfidence?: number;\n\toutputFaceBlendshapes?: boolean;\n\toutputFacialTransformationMatrixes?: boolean;\n}\n\nconst LANDMARK_COUNT = 478;\nconst LANDMARK_INDICES = {\n\tLEFT_EYEBROW: [336, 296, 334, 293, 300, 276, 283, 282, 295, 285],\n\tLEFT_EYE: [362, 398, 384, 385, 386, 387, 388, 466, 263, 249, 390, 373, 374, 380, 381, 382],\n\tLEFT_EYE_CENTER: 473,\n\tRIGHT_EYEBROW: [70, 63, 105, 66, 107, 55, 65, 52, 53, 46],\n\tRIGHT_EYE: [33, 246, 161, 160, 159, 158, 157, 173, 133, 155, 154, 153, 145, 144, 163, 7],\n\tRIGHT_EYE_CENTER: 468,\n\tNOSE_TIP: 4,\n\tOUTER_LIP: [61, 185, 40, 39, 37, 0, 267, 269, 270, 409, 291, 375, 321, 405, 314, 17, 84, 181, 91, 146],\n\tINNER_LIP: [78, 191, 80, 81, 82, 13, 312, 311, 310, 415, 308, 324, 318, 402, 317, 14, 87, 178, 88, 95],\n};\n\nfunction face(config: { textureName: string; options?: FacePluginOptions }) {\n\tconst { textureName, options } = config;\n\tconst defaultModelPath =\n\t\t'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/latest/face_landmarker.task';\n\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { uniforms, injectGLSL } = context;\n\n\t\tlet faceLandmarker: FaceLandmarker | null = null;\n\t\tlet vision: any = null;\n\t\tlet lastVideoTime = -1;\n\t\tconst textureSources = new Map<string, TextureSource>();\n\t\tconst maxFaces = options?.maxFaces ?? 1;\n\n\t\tconst maskWidth = 512;\n\t\tconst maskHeight = 512;\n\t\tconst faceMaskCanvas = document.createElement('canvas');\n\t\tfaceMaskCanvas.width = maskWidth;\n\t\tfaceMaskCanvas.height = maskHeight;\n\t\tconst faceMaskCtx = faceMaskCanvas.getContext('2d')!;\n\t\tfaceMaskCtx.globalCompositeOperation = 'lighten'; // Keep the highest value of each channel.\n\n\t\tasync function initializeFaceLandmarker() {\n\t\t\ttry {\n\t\t\t\tconst { FilesetResolver, FaceLandmarker } = await import('@mediapipe/tasks-vision');\n\t\t\t\tvision = await FilesetResolver.forVisionTasks(\n\t\t\t\t\t'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'\n\t\t\t\t);\n\n\t\t\t\tfaceLandmarker = await FaceLandmarker.createFromOptions(vision, {\n\t\t\t\t\tbaseOptions: {\n\t\t\t\t\t\tmodelAssetPath: options?.modelPath || defaultModelPath,\n\t\t\t\t\t},\n\t\t\t\t\trunningMode: 'VIDEO',\n\t\t\t\t\tnumFaces: options?.maxFaces ?? 1,\n\t\t\t\t\tminFaceDetectionConfidence: options?.minFaceDetectionConfidence ?? 0.5,\n\t\t\t\t\tminFacePresenceConfidence: options?.minFacePresenceConfidence ?? 0.5,\n\t\t\t\t\tminTrackingConfidence: options?.minTrackingConfidence ?? 0.5,\n\t\t\t\t\toutputFaceBlendshapes: options?.outputFaceBlendshapes ?? false,\n\t\t\t\t\toutputFacialTransformationMatrixes: options?.outputFacialTransformationMatrixes ?? false,\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to initialize Face Landmarker:', error);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\tfunction calculateBoundingBoxCenter(landmarks: NormalizedLandmark[]): [number, number] {\n\t\t\tlet minX = Infinity,\n\t\t\t\tmaxX = -Infinity,\n\t\t\t\tminY = Infinity,\n\t\t\t\tmaxY = -Infinity;\n\n\t\t\t// Calculate bounding box center.\n\t\t\tfor (const landmark of landmarks) {\n\t\t\t\tminX = Math.min(minX, landmark.x);\n\t\t\t\tmaxX = Math.max(maxX, landmark.x);\n\t\t\t\tminY = Math.min(minY, landmark.y);\n\t\t\t\tmaxY = Math.max(maxY, landmark.y);\n\t\t\t}\n\n\t\t\tconst centerX = (minX + maxX) / 2;\n\t\t\tconst centerY = (minY + maxY) / 2;\n\t\t\treturn [centerX, centerY];\n\t\t}\n\n\t\tfunction fillRegion(landmarks: NormalizedLandmark[], color: { r: number; g: number; b: number }) {\n\t\t\tfaceMaskCtx.fillStyle = `rgb(${Math.round(color.r * 255)}, ${Math.round(color.g * 255)}, ${Math.round(\n\t\t\t\tcolor.b * 255\n\t\t\t)})`;\n\t\t\tconst origin = landmarks[0];\n\t\t\tfaceMaskCtx.beginPath();\n\t\t\tfaceMaskCtx.moveTo(origin.x * faceMaskCanvas.width, origin.y * faceMaskCanvas.height);\n\t\t\tfor (let i = 1; i < landmarks.length; i++) {\n\t\t\t\tconst destination = landmarks[i];\n\t\t\t\tfaceMaskCtx.lineTo(destination.x * faceMaskCanvas.width, destination.y * faceMaskCanvas.height);\n\t\t\t}\n\t\t\tfaceMaskCtx.closePath();\n\t\t\tfaceMaskCtx.fill();\n\t\t}\n\n\t\tasync function updateMaskTexture(faces: NormalizedLandmark[][]) {\n\t\t\tif (!faceLandmarker) {\n\t\t\t\tconsole.warn('[Face Plugin] Cannot update mask: faceLandmarker missing');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst { FaceLandmarker } = await import('@mediapipe/tasks-vision');\n\t\t\t\tfaceMaskCtx.clearRect(0, 0, faceMaskCanvas.width, faceMaskCanvas.height);\n\n\t\t\t\tfaces.forEach((landmarks, i) => {\n\t\t\t\t\t// Build combined mask with RGBA channels\n\t\t\t\t\t// R: Mouth | G: Face | B: Eyes\n\t\t\t\t\t// Mouth (red channel).\n\t\t\t\t\t// Lips.\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.OUTER_LIP.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{ r: 0.25, g: 0, b: 0 }\n\t\t\t\t\t);\n\t\t\t\t\t// Inner mouth.\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.INNER_LIP.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{ r: 0.75, g: 0, b: 0 }\n\t\t\t\t\t);\n\n\t\t\t\t\t// Face (green channel).\n\t\t\t\t\t// Entire face.\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tFaceLandmarker.FACE_LANDMARKS_TESSELATION.map(({ start }) => landmarks[start]),\n\t\t\t\t\t\t{ r: 0, g: 0.25, b: 0 }\n\t\t\t\t\t);\n\t\t\t\t\t// Face contour (excludes nose in profile view).\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tFaceLandmarker.FACE_LANDMARKS_FACE_OVAL.map(({ start }) => landmarks[start]),\n\t\t\t\t\t\t{ r: 0, g: 1, b: 0 }\n\t\t\t\t\t);\n\n\t\t\t\t\t// Eyes (blue channel).\n\t\t\t\t\t// Eyebrows.\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.LEFT_EYEBROW.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr: 0,\n\t\t\t\t\t\t\tg: 0,\n\t\t\t\t\t\t\tb: 0.15,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.RIGHT_EYEBROW.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tr: 0,\n\t\t\t\t\t\t\tg: 0,\n\t\t\t\t\t\t\tb: 0.35,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\t// Eyes.\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.LEFT_EYE.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{ r: 0, g: 0, b: 0.65 }\n\t\t\t\t\t);\n\t\t\t\t\tfillRegion(\n\t\t\t\t\t\tLANDMARK_INDICES.RIGHT_EYE.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t\t{ r: 0, g: 0, b: 0.85 }\n\t\t\t\t\t);\n\t\t\t\t});\n\n\t\t\t\tshaderPad.updateTextures({ u_faceMask: faceMaskCanvas });\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('[Face Plugin] Failed to generate mask texture:', error);\n\t\t\t}\n\t\t}\n\n\t\tfunction processFaceResults(result: any) {\n\t\t\tif (!result.faceLandmarks) return;\n\n\t\t\tconst faceLandmarks: [number, number][] = [];\n\t\t\tconst faceCenters: [number, number][] = [];\n\t\t\tconst leftEyes: [number, number][] = [];\n\t\t\tconst rightEyes: [number, number][] = [];\n\t\t\tconst noseTips: [number, number][] = [];\n\t\t\tconst mouths: [number, number][] = [];\n\t\t\tfor (const landmarks of result.faceLandmarks) {\n\t\t\t\t// Invert Y-axis to match WebGL coordinate system.\n\t\t\t\tconst flippedLandmarks = landmarks.map((landmark: NormalizedLandmark) => [landmark.x, 1 - landmark.y]);\n\t\t\t\tfaceLandmarks.push(flippedLandmarks);\n\t\t\t\tfaceCenters.push(calculateBoundingBoxCenter(flippedLandmarks));\n\t\t\t\tleftEyes.push(flippedLandmarks[LANDMARK_INDICES.LEFT_EYE_CENTER]);\n\t\t\t\trightEyes.push(flippedLandmarks[LANDMARK_INDICES.RIGHT_EYE_CENTER]);\n\t\t\t\tnoseTips.push(flippedLandmarks[LANDMARK_INDICES.NOSE_TIP]);\n\t\t\t\tmouths.push(\n\t\t\t\t\tcalculateBoundingBoxCenter(LANDMARK_INDICES.INNER_LIP.map((idx: number) => flippedLandmarks[idx]))\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tupdateMaskTexture(result.faceLandmarks).catch(error => {\n\t\t\t\tconsole.warn('Mask texture update error:', error);\n\t\t\t});\n\n\t\t\tconst nFaces = result.faceLandmarks.length;\n\t\t\tconst updates: Parameters<typeof shaderPad.updateUniforms>[0] = { u_nFaces: nFaces };\n\t\t\tif (nFaces) {\n\t\t\t\tif (uniforms.has('u_faceLandmarks')) updates.u_faceLandmarks = faceLandmarks;\n\t\t\t\tif (uniforms.has('u_faceCenter')) updates.u_faceCenter = faceCenters;\n\t\t\t\tif (uniforms.has('u_leftEye')) updates.u_leftEye = leftEyes;\n\t\t\t\tif (uniforms.has('u_rightEye')) updates.u_rightEye = rightEyes;\n\t\t\t\tif (uniforms.has('u_noseTip')) updates.u_noseTip = noseTips;\n\t\t\t\tif (uniforms.has('u_mouth')) updates.u_mouth = mouths;\n\t\t\t}\n\t\t\tshaderPad.updateUniforms(updates);\n\t\t}\n\n\t\tshaderPad.registerHook('init', async () => {\n\t\t\tshaderPad.initializeTexture('u_faceMask', faceMaskCanvas);\n\t\t\tshaderPad.initializeUniform('u_maxFaces', 'int', maxFaces);\n\t\t\tshaderPad.initializeUniform('u_nFaces', 'int', 0);\n\t\t\tconst defaultFaceLandmarks: [number, number][] = Array.from({ length: maxFaces * LANDMARK_COUNT }, () => [\n\t\t\t\t0.5, 0.5,\n\t\t\t]);\n\t\t\tconst defaultFaceData: [number, number][] = Array.from({ length: maxFaces }, () => [0.5, 0.5]);\n\t\t\tshaderPad.initializeUniform('u_faceLandmarks', 'float', defaultFaceLandmarks, {\n\t\t\t\tarrayLength: maxFaces * LANDMARK_COUNT,\n\t\t\t});\n\t\t\tshaderPad.initializeUniform('u_faceCenter', 'float', defaultFaceData, { arrayLength: maxFaces });\n\t\t\tshaderPad.initializeUniform('u_leftEye', 'float', defaultFaceData, { arrayLength: maxFaces });\n\t\t\tshaderPad.initializeUniform('u_rightEye', 'float', defaultFaceData, { arrayLength: maxFaces });\n\t\t\tshaderPad.initializeUniform('u_noseTip', 'float', defaultFaceData, { arrayLength: maxFaces });\n\t\t\tshaderPad.initializeUniform('u_mouth', 'float', defaultFaceData, { arrayLength: maxFaces });\n\n\t\t\tawait initializeFaceLandmarker();\n\t\t});\n\n\t\tshaderPad.registerHook('updateTextures', (updates: Record<string, TextureSource>) => {\n\t\t\tconst source = updates[textureName];\n\t\t\tif (!source) return;\n\n\t\t\tconst previousSource = textureSources.get(textureName);\n\t\t\tif (previousSource !== source) {\n\t\t\t\tlastVideoTime = -1;\n\t\t\t}\n\n\t\t\ttextureSources.set(textureName, source);\n\t\t\tif (!faceLandmarker) return;\n\t\t\ttry {\n\t\t\t\tif (source instanceof HTMLVideoElement) {\n\t\t\t\t\tif (source.videoWidth === 0 || source.videoHeight === 0 || source.readyState < 2) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (source.currentTime !== lastVideoTime) {\n\t\t\t\t\t\tlastVideoTime = source.currentTime;\n\t\t\t\t\t\tconst timestamp = performance.now();\n\t\t\t\t\t\tconst result = faceLandmarker.detectForVideo(source, timestamp);\n\t\t\t\t\t\tprocessFaceResults(result);\n\t\t\t\t\t}\n\t\t\t\t} else if (source instanceof HTMLImageElement || source instanceof HTMLCanvasElement) {\n\t\t\t\t\tif (source.width === 0 || source.height === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst result = faceLandmarker.detect(source);\n\t\t\t\t\tprocessFaceResults(result);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn('Face detection error:', error);\n\t\t\t}\n\t\t});\n\n\t\tshaderPad.registerHook('destroy', () => {\n\t\t\tif (faceLandmarker) {\n\t\t\t\tfaceLandmarker.close();\n\t\t\t\tfaceLandmarker = null;\n\t\t\t}\n\t\t\tvision = null;\n\t\t\ttextureSources.clear();\n\t\t\tfaceMaskCanvas.remove();\n\t\t});\n\n\t\tinjectGLSL(`\nuniform int u_maxFaces;\nuniform int u_nFaces;\nuniform vec2 u_faceLandmarks[${maxFaces * LANDMARK_COUNT}];\nuniform vec2 u_faceCenter[${maxFaces}];\nuniform vec2 u_leftEye[${maxFaces}];\nuniform vec2 u_rightEye[${maxFaces}];\nuniform vec2 u_noseTip[${maxFaces}];\nuniform vec2 u_mouth[${maxFaces}];\nuniform sampler2D u_faceMask;\nvec2 faceLandmark(int faceIndex, int landmarkIndex) {\n\treturn u_faceLandmarks[faceIndex * ${LANDMARK_COUNT} + landmarkIndex];\n}\nfloat getFace(vec2 pos) { return texture(u_faceMask, pos).g; }\nfloat getEye(vec2 pos) { return texture(u_faceMask, pos).b; }\nfloat getMouth(vec2 pos) { return texture(u_faceMask, pos).r; }`);\n\t};\n}\n\nexport default face;\n"],"mappings":"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","names":["face_exports","__export","face_default","__toCommonJS","LANDMARK_COUNT","LANDMARK_INDICES","face","config","textureName","options","defaultModelPath","shaderPad","context","uniforms","injectGLSL","faceLandmarker","vision","lastVideoTime","textureSources","maxFaces","maskWidth","maskHeight","faceMaskCanvas","faceMaskCtx","initializeFaceLandmarker","FilesetResolver","FaceLandmarker","error","calculateBoundingBoxCenter","landmarks","minX","maxX","minY","maxY","landmark","centerX","centerY","fillRegion","color","origin","i","destination","updateMaskTexture","faces","idx","start","processFaceResults","result","faceLandmarks","faceCenters","leftEyes","rightEyes","noseTips","mouths","flippedLandmarks","nFaces","updates","defaultFaceLandmarks","defaultFaceData","source","timestamp"]}