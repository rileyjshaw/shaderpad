{"version":3,"sources":["../../src/plugins/autosize.ts"],"sourcesContent":["import ShaderPad, { PluginContext } from '..';\n\nconst THROTTLE_INTERVAL_DEFAULT = 1000 / 30;\n\nexport interface AutosizeOptions {\n\tignorePixelRatio?: boolean;\n\ttarget?: Element | Window;\n\tthrottle?: number;\n}\n\nfunction autosize(options: AutosizeOptions = {}) {\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { canvas, emitHook } = context;\n\t\tconst {\n\t\t\tignorePixelRatio = false,\n\t\t\ttarget = canvas instanceof HTMLCanvasElement ? canvas : window,\n\t\t\tthrottle = THROTTLE_INTERVAL_DEFAULT,\n\t\t} = options;\n\t\tconst pixelRatio = ignorePixelRatio ? 1 : window.devicePixelRatio || 1;\n\n\t\tlet resizeTimeout: ReturnType<typeof setTimeout> | null = null;\n\t\tlet lastResizeTime = -Infinity;\n\t\tfunction throttledHandleResize() {\n\t\t\tif (resizeTimeout) clearTimeout(resizeTimeout);\n\t\t\tconst now = performance.now();\n\t\t\tconst timeUntilNextResize = lastResizeTime + throttle - now;\n\t\t\tif (timeUntilNextResize <= 0) {\n\t\t\t\tlastResizeTime = now;\n\t\t\t\thandleResize();\n\t\t\t} else {\n\t\t\t\tresizeTimeout = setTimeout(() => throttledHandleResize(), timeUntilNextResize);\n\t\t\t}\n\t\t}\n\n\t\tfunction handleResize() {\n\t\t\tlet width, height;\n\t\t\tif (target instanceof Window) {\n\t\t\t\twidth = window.innerWidth * pixelRatio;\n\t\t\t\theight = window.innerHeight * pixelRatio;\n\t\t\t} else {\n\t\t\t\twidth = target.clientWidth * pixelRatio;\n\t\t\t\theight = target.clientHeight * pixelRatio;\n\t\t\t}\n\t\t\tif (canvas.width !== width || canvas.height !== height) {\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\temitHook('autosize:resize', width, height);\n\t\t\t}\n\t\t}\n\n\t\thandleResize();\n\n\t\tlet resizeObserver: ResizeObserver | null = null;\n\t\tif (target instanceof Window) {\n\t\t\twindow.addEventListener('resize', throttledHandleResize);\n\t\t} else if (target instanceof Element) {\n\t\t\tresizeObserver = new ResizeObserver(() => throttledHandleResize());\n\t\t\tresizeObserver.observe(target);\n\t\t}\n\n\t\tshaderPad.on('destroy', () => {\n\t\t\tif (resizeTimeout) clearTimeout(resizeTimeout);\n\t\t\tif (resizeObserver) resizeObserver.disconnect();\n\t\t\tif (target instanceof Window) {\n\t\t\t\twindow.removeEventListener('resize', throttledHandleResize);\n\t\t\t}\n\t\t});\n\t};\n}\n\nexport default autosize;\n"],"mappings":"AAEA,IAAMA,EAA4B,IAAO,GAQzC,SAASC,EAASC,EAA2B,CAAC,EAAG,CAChD,OAAO,SAAUC,EAAsBC,EAAwB,CAC9D,GAAM,CAAE,OAAAC,EAAQ,SAAAC,CAAS,EAAIF,EACvB,CACL,iBAAAG,EAAmB,GACnB,OAAAC,EAASH,aAAkB,kBAAoBA,EAAS,OACxD,SAAAI,EAAWT,CACZ,EAAIE,EACEQ,EAAaH,EAAmB,EAAI,OAAO,kBAAoB,EAEjEI,EAAsD,KACtDC,EAAiB,KACrB,SAASC,GAAwB,CAC5BF,GAAe,aAAaA,CAAa,EAC7C,IAAMG,EAAM,YAAY,IAAI,EACtBC,EAAsBH,EAAiBH,EAAWK,EACpDC,GAAuB,GAC1BH,EAAiBE,EACjBE,EAAa,GAEbL,EAAgB,WAAW,IAAME,EAAsB,EAAGE,CAAmB,CAE/E,CAEA,SAASC,GAAe,CACvB,IAAIC,EAAOC,EACPV,aAAkB,QACrBS,EAAQ,OAAO,WAAaP,EAC5BQ,EAAS,OAAO,YAAcR,IAE9BO,EAAQT,EAAO,YAAcE,EAC7BQ,EAASV,EAAO,aAAeE,IAE5BL,EAAO,QAAUY,GAASZ,EAAO,SAAWa,KAC/Cb,EAAO,MAAQY,EACfZ,EAAO,OAASa,EAChBZ,EAAS,kBAAmBW,EAAOC,CAAM,EAE3C,CAEAF,EAAa,EAEb,IAAIG,EAAwC,KACxCX,aAAkB,OACrB,OAAO,iBAAiB,SAAUK,CAAqB,EAC7CL,aAAkB,UAC5BW,EAAiB,IAAI,eAAe,IAAMN,EAAsB,CAAC,EACjEM,EAAe,QAAQX,CAAM,GAG9BL,EAAU,GAAG,UAAW,IAAM,CACzBQ,GAAe,aAAaA,CAAa,EACzCQ,GAAgBA,EAAe,WAAW,EAC1CX,aAAkB,QACrB,OAAO,oBAAoB,SAAUK,CAAqB,CAE5D,CAAC,CACF,CACD,CAEA,IAAOO,EAAQnB","names":["THROTTLE_INTERVAL_DEFAULT","autosize","options","shaderPad","context","canvas","emitHook","ignorePixelRatio","target","throttle","pixelRatio","resizeTimeout","lastResizeTime","throttledHandleResize","now","timeUntilNextResize","handleResize","width","height","resizeObserver","autosize_default"]}