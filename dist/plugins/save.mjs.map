{"version":3,"sources":["../../src/plugins/save.ts"],"sourcesContent":["import ShaderPad, { PluginContext } from '../index';\n\ndeclare module '../index' {\n\tinterface ShaderPad {\n\t\tsave(filename: string, text?: string): Promise<void>;\n\t}\n}\n\nfunction save() {\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { gl, canvas } = context;\n\t\tconst downloadLink = document.createElement('a');\n\n\t\t(shaderPad as any).save = async function (filename: string, text?: string) {\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\t\tgl.drawArrays(gl.TRIANGLES, 0, 6);\n\n\t\t\tif (filename && !`${filename}`.toLowerCase().endsWith('.png')) {\n\t\t\t\tfilename = `${filename}.png`;\n\t\t\t}\n\t\t\tfilename = filename || 'export.png';\n\n\t\t\tconst blob: Blob = await (canvas instanceof HTMLCanvasElement\n\t\t\t\t? new Promise(resolve => canvas.toBlob(resolve as BlobCallback, 'image/png'))\n\t\t\t\t: canvas.convertToBlob({ type: 'image/png' }));\n\n\t\t\tif (navigator.share) {\n\t\t\t\ttry {\n\t\t\t\t\tconst file = new File([blob], filename, { type: blob.type });\n\t\t\t\t\tconst shareData: ShareData = { files: [file] };\n\t\t\t\t\tif (text) shareData.text = text;\n\t\t\t\t\tawait navigator.share(shareData);\n\t\t\t\t\treturn;\n\t\t\t\t} catch (_swallowedError) {}\n\t\t\t}\n\n\t\t\tdownloadLink.download = filename;\n\t\t\tdownloadLink.href = URL.createObjectURL(blob);\n\t\t\tdownloadLink.click();\n\t\t\tURL.revokeObjectURL(downloadLink.href);\n\t\t};\n\t};\n}\n\nexport type WithSave<T extends ShaderPad> = T & {\n\tsave(filename: string, text?: string): Promise<void>;\n};\n\nexport default save;\n"],"mappings":"AAQA,SAASA,GAAO,CACf,OAAO,SAAUC,EAAsBC,EAAwB,CAC9D,GAAM,CAAE,GAAAC,EAAI,OAAAC,CAAO,EAAIF,EACjBG,EAAe,SAAS,cAAc,GAAG,EAE9CJ,EAAkB,KAAO,eAAgBK,EAAkBC,EAAe,CAC1EJ,EAAG,MAAMA,EAAG,gBAAgB,EAC5BA,EAAG,WAAWA,EAAG,UAAW,EAAG,CAAC,EAE5BG,GAAY,CAAC,GAAGA,CAAQ,GAAG,YAAY,EAAE,SAAS,MAAM,IAC3DA,EAAW,GAAGA,CAAQ,QAEvBA,EAAWA,GAAY,aAEvB,IAAME,EAAa,MAAOJ,aAAkB,kBACzC,IAAI,QAAQK,GAAWL,EAAO,OAAOK,EAAyB,WAAW,CAAC,EAC1EL,EAAO,cAAc,CAAE,KAAM,WAAY,CAAC,GAE7C,GAAI,UAAU,MACb,GAAI,CAEH,IAAMM,EAAuB,CAAE,MAAO,CADzB,IAAI,KAAK,CAACF,CAAI,EAAGF,EAAU,CAAE,KAAME,EAAK,IAAK,CAAC,CAChB,CAAE,EACzCD,IAAMG,EAAU,KAAOH,GAC3B,MAAM,UAAU,MAAMG,CAAS,EAC/B,MACD,MAA0B,CAAC,CAG5BL,EAAa,SAAWC,EACxBD,EAAa,KAAO,IAAI,gBAAgBG,CAAI,EAC5CH,EAAa,MAAM,EACnB,IAAI,gBAAgBA,EAAa,IAAI,CACtC,CACD,CACD,CAMA,IAAOM,EAAQX","names":["save","shaderPad","context","gl","canvas","downloadLink","filename","text","blob","resolve","shareData","save_default"]}