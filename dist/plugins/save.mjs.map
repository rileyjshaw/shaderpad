{"version":3,"sources":["../../src/plugins/save.ts"],"sourcesContent":["import ShaderPad, { PluginContext } from '..';\n\ndeclare module '..' {\n\tinterface ShaderPad {\n\t\tsave(filename: string, text?: string): Promise<void>;\n\t}\n}\n\nexport interface SaveOptions {\n\tpreventShare?: boolean;\n}\n\nfunction save() {\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { gl, canvas } = context;\n\t\tconst downloadLink = document.createElement('a');\n\n\t\t(shaderPad as any).save = async function (filename: string, text?: string, options: SaveOptions = {}) {\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\t\tgl.drawArrays(gl.TRIANGLES, 0, 3);\n\n\t\t\tif (filename && !`${filename}`.toLowerCase().endsWith('.png')) {\n\t\t\t\tfilename = `${filename}.png`;\n\t\t\t}\n\t\t\tfilename = filename || 'export.png';\n\n\t\t\tconst blob: Blob = await (canvas instanceof HTMLCanvasElement\n\t\t\t\t? new Promise(resolve => canvas.toBlob(resolve as BlobCallback, 'image/png'))\n\t\t\t\t: canvas.convertToBlob({ type: 'image/png' }));\n\n\t\t\tif (!options.preventShare && navigator.share) {\n\t\t\t\ttry {\n\t\t\t\t\tconst file = new File([blob], filename, { type: blob.type });\n\t\t\t\t\tconst shareData: ShareData = { files: [file] };\n\t\t\t\t\tif (text) shareData.text = text;\n\t\t\t\t\tif (!navigator.canShare || navigator.canShare(shareData)) {\n\t\t\t\t\t\tawait navigator.share(shareData);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (err: any) {\n\t\t\t\t\tif (err?.name === 'AbortError') return;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdownloadLink.download = filename;\n\t\t\tdownloadLink.href = URL.createObjectURL(blob);\n\t\t\tdownloadLink.click();\n\t\t\tURL.revokeObjectURL(downloadLink.href);\n\t\t};\n\t};\n}\n\nexport type WithSave<T extends ShaderPad> = T & {\n\tsave(filename: string, text?: string): Promise<void>;\n};\n\nexport default save;\n"],"mappings":"AAYA,SAASA,GAAO,CACf,OAAO,SAAUC,EAAsBC,EAAwB,CAC9D,GAAM,CAAE,GAAAC,EAAI,OAAAC,CAAO,EAAIF,EACjBG,EAAe,SAAS,cAAc,GAAG,EAE9CJ,EAAkB,KAAO,eAAgBK,EAAkBC,EAAeC,EAAuB,CAAC,EAAG,CACrGL,EAAG,MAAMA,EAAG,gBAAgB,EAC5BA,EAAG,WAAWA,EAAG,UAAW,EAAG,CAAC,EAE5BG,GAAY,CAAC,GAAGA,CAAQ,GAAG,YAAY,EAAE,SAAS,MAAM,IAC3DA,EAAW,GAAGA,CAAQ,QAEvBA,EAAWA,GAAY,aAEvB,IAAMG,EAAa,MAAOL,aAAkB,kBACzC,IAAI,QAAQM,GAAWN,EAAO,OAAOM,EAAyB,WAAW,CAAC,EAC1EN,EAAO,cAAc,CAAE,KAAM,WAAY,CAAC,GAE7C,GAAI,CAACI,EAAQ,cAAgB,UAAU,MACtC,GAAI,CAEH,IAAMG,EAAuB,CAAE,MAAO,CADzB,IAAI,KAAK,CAACF,CAAI,EAAGH,EAAU,CAAE,KAAMG,EAAK,IAAK,CAAC,CAChB,CAAE,EAE7C,GADIF,IAAMI,EAAU,KAAOJ,GACvB,CAAC,UAAU,UAAY,UAAU,SAASI,CAAS,EAAG,CACzD,MAAM,UAAU,MAAMA,CAAS,EAC/B,MACD,CACD,OAASC,EAAU,CAClB,GAAIA,GAAK,OAAS,aAAc,MACjC,CAGDP,EAAa,SAAWC,EACxBD,EAAa,KAAO,IAAI,gBAAgBI,CAAI,EAC5CJ,EAAa,MAAM,EACnB,IAAI,gBAAgBA,EAAa,IAAI,CACtC,CACD,CACD,CAMA,IAAOQ,EAAQb","names":["save","shaderPad","context","gl","canvas","downloadLink","filename","text","options","blob","resolve","shareData","err","save_default"]}