"use strict";var re=Object.create;var W=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var oe=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var he=(l,t)=>{for(var e in t)W(l,e,{get:t[e],enumerable:!0})},q=(l,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ne(t))!ae.call(l,i)&&i!==e&&W(l,i,{get:()=>t[i],enumerable:!(s=se(t,i))||s.enumerable});return l};var le=(l,t,e)=>(e=l!=null?re(oe(l)):{},q(t||!l||!l.__esModule?W(e,"default",{value:l,enumerable:!0}):e,l)),ue=l=>q(W({},"__esModule",{value:!0}),l);var Le={};he(Le,{default:()=>ve});module.exports=ue(Le);var ce=`#version 300 es
in vec2 aPosition;
out vec2 v_uv;
void main() {
    v_uv = aPosition * 0.5 + 0.5;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}
`,me=33.333333333333336,M=Symbol("u_history"),Y=Symbol("__SHADERPAD_BUFFER");function fe(l,t){if(!t?.length)return l;let e=l.split(`
`),s=e.findLastIndex(i=>{let r=i.trimStart();return r.startsWith("precision ")||r.startsWith("#version ")})+1;return e.splice(s,0,...t),e.join(`
`)}function Z(l){return l instanceof WebGLTexture?{width:0,height:0}:l instanceof HTMLVideoElement?{width:l.videoWidth,height:l.videoHeight}:l instanceof HTMLImageElement?{width:l.naturalWidth??l.width,height:l.naturalHeight??l.height}:{width:l.width,height:l.height}}function D(l){return typeof l=="symbol"?l.description??"":l}var V=class{isInternalCanvas=!1;isTouchDevice=!1;gl;fragmentShaderSrc;uniforms=new Map;textures=new Map;textureUnitPool;buffer=null;program=null;aPositionLocation=0;animationFrameId;resolutionObserver;resizeObserver;resizeTimeout=null;lastResizeTime=-1/0;eventListeners=new Map;frame=0;startTime=0;cursorPosition=[.5,.5];clickPosition=[.5,.5];isMouseDown=!1;canvas;onResize;hooks=new Map;historyDepth=0;textureOptions;debug;intermediateFbo=null;constructor(t,{canvas:e,plugins:s,history:i,debug:r,...h}={}){if(this.canvas=e||document.createElement("canvas"),!e){this.isInternalCanvas=!0;let g=this.canvas;g.style.position="fixed",g.style.inset="0",g.style.height="100dvh",g.style.width="100dvw",document.body.appendChild(g)}if(this.gl=this.canvas.getContext("webgl2",{antialias:!1}),!this.gl)throw new Error("WebGL2 not supported. Please use a browser that supports WebGL2.");this.textureUnitPool={free:[],next:0,max:this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.textureOptions=h;let{internalFormat:n,type:f}=h;(f===this.gl.FLOAT||f===this.gl.HALF_FLOAT||n===this.gl.RGBA16F||n===this.gl.RGBA32F||n===this.gl.R16F||n===this.gl.R32F||n===this.gl.RG16F||n===this.gl.RG32F)&&!this.gl.getExtension("EXT_color_buffer_float")&&(console.warn("EXT_color_buffer_float not supported, falling back to RGBA8"),delete this.textureOptions?.internalFormat,delete this.textureOptions?.format,delete this.textureOptions?.type),i&&(this.historyDepth=i),this.debug=r??(typeof process<"u"&&!1),this.animationFrameId=null,this.resolutionObserver=new MutationObserver(()=>this.updateResolution()),this.resizeObserver=new ResizeObserver(()=>this.throttledHandleResize());let c=[];if(s){let g={gl:this.gl,uniforms:this.uniforms,textures:this.textures,canvas:this.canvas,reserveTextureUnit:this.reserveTextureUnit.bind(this),releaseTextureUnit:this.releaseTextureUnit.bind(this),injectGLSL:_=>{c.push(_)}};Object.defineProperty(g,"program",{get:()=>this.program,enumerable:!0,configurable:!0}),s.forEach(_=>_(this,g))}this.fragmentShaderSrc=fe(t,c),this.init(),this.canvas instanceof HTMLCanvasElement&&this.addEventListeners()}registerHook(t,e){this.hooks.has(t)||this.hooks.set(t,[]),this.hooks.get(t).push(e)}init(){let t=ce;if(this.program=this.gl.createProgram(),!this.program)throw new Error("Failed to create WebGL program");let e=this.createShader(this.gl.VERTEX_SHADER,t),s=this.createShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderSrc);if(this.gl.attachShader(this.program,e),this.gl.attachShader(this.program,s),this.gl.linkProgram(this.program),this.gl.deleteShader(e),this.gl.deleteShader(s),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw console.error("Program link error:",this.gl.getProgramInfoLog(this.program)),this.gl.deleteProgram(this.program),new Error("Failed to link WebGL program");this.aPositionLocation=this.gl.getAttribLocation(this.program,"aPosition"),this.setupBuffer(),this.gl.useProgram(this.program),this.canvas instanceof HTMLCanvasElement&&(this.resolutionObserver.observe(this.canvas,{attributes:!0,attributeFilter:["width","height"]}),this.resizeObserver.observe(this.canvas)),this.isInternalCanvas||this.updateResolution(),this.initializeUniform("u_cursor","float",this.cursorPosition),this.initializeUniform("u_click","float",[...this.clickPosition,this.isMouseDown?1:0]),this.initializeUniform("u_time","float",0),this.initializeUniform("u_frame","int",0),this.historyDepth>0&&(this._initializeTexture(Y,this.canvas,{...this.textureOptions}),this._initializeTexture(M,this.canvas,{history:this.historyDepth,...this.textureOptions}),this.intermediateFbo=this.gl.createFramebuffer()),this.hooks.get("init")?.forEach(i=>i.call(this))}createShader(t,e){let s=this.gl.createShader(t);if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))throw console.error("Shader compilation failed:",e),console.error(this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s),new Error("Shader compilation failed");return s}setupBuffer(){let t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.enableVertexAttribArray(this.aPositionLocation),this.gl.vertexAttribPointer(this.aPositionLocation,2,this.gl.FLOAT,!1,0,0)}throttledHandleResize(){clearTimeout(this.resizeTimeout);let t=performance.now(),e=this.lastResizeTime+me-t;e<=0?(this.lastResizeTime=t,this.handleResize()):this.resizeTimeout=setTimeout(()=>this.throttledHandleResize(),e)}handleResize(){if(!(this.canvas instanceof HTMLCanvasElement))return;let t=window.devicePixelRatio||1,e=this.canvas.clientWidth*t,s=this.canvas.clientHeight*t;this.isInternalCanvas&&(this.canvas.width!==e||this.canvas.height!==s)&&(this.canvas.width=e,this.canvas.height=s),this.onResize?.(e,s)}addEventListeners(){let t=this.canvas,e=(i,r)=>{if(!this.uniforms.has("u_cursor"))return;let h=t.getBoundingClientRect();this.cursorPosition[0]=(i-h.left)/h.width,this.cursorPosition[1]=1-(r-h.top)/h.height,this.updateUniforms({u_cursor:this.cursorPosition})},s=(i,r,h)=>{if(this.uniforms.has("u_click")){if(this.isMouseDown=i,i){let n=t.getBoundingClientRect(),f=r,d=h;this.clickPosition[0]=(f-n.left)/n.width,this.clickPosition[1]=1-(d-n.top)/n.height}this.updateUniforms({u_click:[...this.clickPosition,this.isMouseDown?1:0]})}};this.eventListeners.set("mousemove",i=>{let r=i;this.isTouchDevice||e(r.clientX,r.clientY)}),this.eventListeners.set("mousedown",i=>{let r=i;this.isTouchDevice||r.button===0&&(this.isMouseDown=!0,s(!0,r.clientX,r.clientY))}),this.eventListeners.set("mouseup",i=>{let r=i;this.isTouchDevice||r.button===0&&s(!1)}),this.eventListeners.set("touchmove",i=>{let r=i;r.touches.length>0&&e(r.touches[0].clientX,r.touches[0].clientY)}),this.eventListeners.set("touchstart",i=>{let r=i;this.isTouchDevice=!0,r.touches.length>0&&(e(r.touches[0].clientX,r.touches[0].clientY),s(!0,r.touches[0].clientX,r.touches[0].clientY))}),this.eventListeners.set("touchend",i=>{i.touches.length===0&&s(!1)}),this.eventListeners.forEach((i,r)=>{t.addEventListener(r,i)})}updateResolution(){let t=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight];this.gl.viewport(0,0,...t),this.uniforms.has("u_resolution")?this.updateUniforms({u_resolution:t}):this.initializeUniform("u_resolution","float",t),this.historyDepth>0&&(this.resizeTexture(M,...t),this.resizeTexture(Y,...t)),this.hooks.get("updateResolution")?.forEach(e=>e.call(this))}resizeTexture(t,e,s){let i=this.textures.get(t);if(!i||i.width===e&&i.height===s)return;this.gl.deleteTexture(i.texture),i.width=e,i.height=s;let{texture:r}=this.createTexture(t,i);i.texture=r,i.history&&(i.history.writeIndex=0,this.clearHistoryTextureLayers(i))}reserveTextureUnit(t){let e=this.textures.get(t);if(e)return e.unitIndex;if(this.textureUnitPool.free.length>0)return this.textureUnitPool.free.pop();if(this.textureUnitPool.next>=this.textureUnitPool.max)throw new Error("Exceeded the available texture units for this device.");return this.textureUnitPool.next++}releaseTextureUnit(t){let e=this.textures.get(t);e&&this.textureUnitPool.free.push(e.unitIndex)}resolveTextureOptions(t){let{gl:e}=this,s=t?.type??e.UNSIGNED_BYTE;return{type:s,format:t?.format??e.RGBA,internalFormat:t?.internalFormat??(s===e.FLOAT?e.RGBA32F:s===e.HALF_FLOAT?e.RGBA16F:e.RGBA8),minFilter:t?.minFilter??e.LINEAR,magFilter:t?.magFilter??e.LINEAR,wrapS:t?.wrapS??e.CLAMP_TO_EDGE,wrapT:t?.wrapT??e.CLAMP_TO_EDGE,preserveY:t?.preserveY}}clearHistoryTextureLayers(t){if(!t.history)return;let e=this.gl,{type:s,format:i}=t.options,r=t.width*t.height*4,h=s===e.FLOAT?new Float32Array(r):s===e.HALF_FLOAT?new Uint16Array(r):new Uint8Array(r);e.activeTexture(e.TEXTURE0+t.unitIndex),e.bindTexture(e.TEXTURE_2D_ARRAY,t.texture);for(let n=0;n<t.history.depth;++n)e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,n,t.width,t.height,1,i,s,h)}initializeUniform(t,e,s,i){let r=i?.arrayLength;if(this.uniforms.has(t))throw new Error(`${t} is already initialized.`);if(e!=="float"&&e!=="int")throw new Error(`Invalid uniform type: ${e}. Expected 'float' or 'int'.`);if(r&&!(Array.isArray(s)&&s.length===r))throw new Error(`${t} array length mismatch: must initialize with ${r} elements.`);let h=this.gl.getUniformLocation(this.program,t);if(!h&&r&&(h=this.gl.getUniformLocation(this.program,`${t}[0]`)),!h){this.log(`${t} not found in fragment shader. Skipping initialization.`);return}let n=r?s[0]:s,f=Array.isArray(n)?n.length:1;this.uniforms.set(t,{type:e,length:f,location:h,arrayLength:r});try{this.updateUniforms({[t]:s})}catch(d){throw this.uniforms.delete(t),d}this.hooks.get("initializeUniform")?.forEach(d=>d.call(this,...arguments))}log(...t){this.debug&&console.debug(...t)}updateUniforms(t,e){this.gl.useProgram(this.program),Object.entries(t).forEach(([s,i])=>{let r=this.uniforms.get(s);if(!r){this.log(`${s} not found in fragment shader. Skipping update.`);return}let h=`uniform${r.length}${r.type.charAt(0)}`;if(r.arrayLength){if(!Array.isArray(i))throw new Error(`${s} is an array, but the value passed to updateUniforms is not an array.`);let n=i.length;if(!n)return;if(n>r.arrayLength)throw new Error(`${s} received ${n} values, but maximum length is ${r.arrayLength}.`);if(i.some(c=>(Array.isArray(c)?c.length:1)!==r.length))throw new Error(`Tried to update ${s} with some elements that are not length ${r.length}.`);let f=new(r.type==="float"?Float32Array:Int32Array)(i.flat()),d=r.location;if(e?.startIndex){let c=this.gl.getUniformLocation(this.program,`${s}[${e.startIndex}]`);if(!c)throw new Error(`${s}[${e.startIndex}] not found in fragment shader. Did you pass an invalid startIndex?`);d=c}this.gl[h+"v"](d,f)}else{if(Array.isArray(i)||(i=[i]),i.length!==r.length)throw new Error(`Invalid uniform value length: ${i.length}. Expected ${r.length}.`);this.gl[h](r.location,...i)}}),this.hooks.get("updateUniforms")?.forEach(s=>s.call(this,...arguments))}createTexture(t,e){let{width:s,height:i}=e,r=e.history?.depth??0,h=this.gl.createTexture();if(!h)throw new Error("Failed to create texture");let n=e.unitIndex;if(typeof n!="number")try{n=this.reserveTextureUnit(t)}catch(g){throw this.gl.deleteTexture(h),g}let f=r>0,d=f?this.gl.TEXTURE_2D_ARRAY:this.gl.TEXTURE_2D,{options:c}=e;return this.gl.activeTexture(this.gl.TEXTURE0+n),this.gl.bindTexture(d,h),this.gl.texParameteri(d,this.gl.TEXTURE_WRAP_S,c.wrapS),this.gl.texParameteri(d,this.gl.TEXTURE_WRAP_T,c.wrapT),this.gl.texParameteri(d,this.gl.TEXTURE_MIN_FILTER,c.minFilter),this.gl.texParameteri(d,this.gl.TEXTURE_MAG_FILTER,c.magFilter),f?this.gl.texStorage3D(d,1,c.internalFormat,s,i,r):t===Y&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,c.internalFormat,s,i,0,c.format,c.type,null),{texture:h,unitIndex:n}}_initializeTexture(t,e,s){if(this.textures.has(t))throw new Error(`Texture '${D(t)}' is already initialized.`);let{history:i=0,...r}=s??{},{width:h,height:n}=Z(e);if(!h||!n)throw new Error("Texture source must have valid dimensions");let f={width:h,height:n,options:this.resolveTextureOptions(r)};i>0&&(f.history={depth:i,writeIndex:0});let{texture:d,unitIndex:c}=this.createTexture(t,f),g={texture:d,unitIndex:c,...f};i>0&&(this.initializeUniform(`${D(t)}FrameOffset`,"int",0),this.clearHistoryTextureLayers(g)),this.textures.set(t,g),this.updateTexture(t,e);let _=this.gl.getUniformLocation(this.program,D(t));_&&this.gl.uniform1i(_,c)}initializeTexture(t,e,s){this._initializeTexture(t,e,s),this.hooks.get("initializeTexture")?.forEach(i=>i.call(this,...arguments))}updateTextures(t,e){this.hooks.get("updateTextures")?.forEach(s=>s.call(this,...arguments)),Object.entries(t).forEach(([s,i])=>{this.updateTexture(s,i,e)})}updateTexture(t,e,s){let i=this.textures.get(t);if(!i)throw new Error(`Texture '${D(t)}' is not initialized.`);if(e instanceof WebGLTexture){this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,e);return}let{width:r,height:h}=Z(e);if(!r||!h)return;let n="isPartial"in e&&e.isPartial;n||this.resizeTexture(t,r,h);let d=!("data"in e&&e.data)&&!i.options?.preserveY,c=this.gl.getParameter(this.gl.UNPACK_FLIP_Y_WEBGL);if(i.history){if(this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,i.texture),!s?.skipHistoryWrite){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,d),this.gl.texSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,i.history.writeIndex,r,h,1,i.options.format,i.options.type,e.data??e),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c);let g=`${D(t)}FrameOffset`;this.updateUniforms({[g]:i.history.writeIndex}),i.history.writeIndex=(i.history.writeIndex+1)%i.history.depth}}else this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,d),n?this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,e.x??0,e.y??0,r,h,i.options.format,i.options.type,e.data):this.gl.texImage2D(this.gl.TEXTURE_2D,0,i.options.internalFormat,r,h,0,i.options.format,i.options.type,e.data??e),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c)}draw(t){let e=this.gl,s=e.drawingBufferWidth,i=e.drawingBufferHeight,r=this.textures.get(M),h=this.textures.get(Y),n=r&&!t?.skipHistoryWrite;n&&(e.bindFramebuffer(e.FRAMEBUFFER,this.intermediateFbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h.texture,0)),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.vertexAttribPointer(this.aPositionLocation,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.aPositionLocation),e.viewport(0,0,s,i),t?.skipClear||e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6),n&&(e.bindTexture(e.TEXTURE_2D_ARRAY,r.texture),e.copyTexSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r.history.writeIndex,0,0,s,i),e.bindFramebuffer(e.READ_FRAMEBUFFER,this.intermediateFbo),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.blitFramebuffer(0,0,s,i,0,0,s,i,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,null))}step(t,e){let s={};this.uniforms.has("u_time")&&(s.u_time=t),this.uniforms.has("u_frame")&&(s.u_frame=this.frame),this.updateUniforms(s),this.hooks.get("step")?.forEach(r=>r.call(this,t,this.frame)),this.draw(e);let i=this.textures.get(M);if(i&&!e?.skipHistoryWrite){let{writeIndex:r,depth:h}=i.history;this.updateUniforms({[`${D(M)}FrameOffset`]:r}),i.history.writeIndex=(r+1)%h}this.hooks.get("afterStep")?.forEach(r=>r.call(this,t,this.frame)),++this.frame}play(t,e){this.pause();let s=i=>{i=(i-this.startTime)/1e3;let r=e?.(i,this.frame)??void 0;this.step(i,r),this.animationFrameId=requestAnimationFrame(s),t?.(i,this.frame)};this.animationFrameId=requestAnimationFrame(s)}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}reset(){this.frame=0,this.startTime=performance.now(),this.textures.forEach(t=>{t.history&&(t.history.writeIndex=0,this.clearHistoryTextureLayers(t))}),this.hooks.get("reset")?.forEach(t=>t.call(this))}destroy(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resolutionObserver.disconnect(),this.resizeObserver.disconnect(),this.canvas instanceof HTMLCanvasElement&&this.eventListeners.forEach((t,e)=>{this.canvas.removeEventListener(e,t)}),this.program&&this.gl.deleteProgram(this.program),this.intermediateFbo&&(this.gl.deleteFramebuffer(this.intermediateFbo),this.intermediateFbo=null),this.textures.forEach(t=>{this.gl.deleteTexture(t.texture)}),this.textureUnitPool.free=[],this.textureUnitPool.next=0,this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this.hooks.get("destroy")?.forEach(t=>t.call(this)),this.isInternalCanvas&&this.canvas instanceof HTMLCanvasElement&&this.canvas.remove()}},J=V;var L=33,de=6,p=L+de,a={LEFT_EYE:2,RIGHT_EYE:5,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32,BODY_CENTER:L,LEFT_HAND_CENTER:L+1,RIGHT_HAND_CENTER:L+2,LEFT_FOOT_CENTER:L+3,RIGHT_FOOT_CENTER:L+4,TORSO_CENTER:L+5},Te=Array.from({length:L},(l,t)=>t),ge=[a.LEFT_WRIST,a.LEFT_PINKY,a.LEFT_THUMB,a.LEFT_INDEX],Ee=[a.RIGHT_WRIST,a.RIGHT_PINKY,a.RIGHT_THUMB,a.RIGHT_INDEX],pe=[a.LEFT_ANKLE,a.LEFT_HEEL,a.LEFT_FOOT_INDEX],_e=[a.RIGHT_ANKLE,a.RIGHT_HEEL,a.RIGHT_FOOT_INDEX],xe=[a.LEFT_SHOULDER,a.RIGHT_SHOULDER,a.LEFT_HIP,a.RIGHT_HIP],Q={data:new Uint8Array(4),width:1,height:1};function Re(l){let{textureName:t,options:e}=l,s="https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task";return function(i,r){let{injectGLSL:h,gl:n}=r,f=null,d=null,c=-1,g="VIDEO",_=new Map,X=e?.maxPoses??1,F=512,$=0,o=null,K=new OffscreenCanvas(1,1),E=null;async function ee(){try{let{FilesetResolver:m,PoseLandmarker:u}=await import("@mediapipe/tasks-vision");d=await m.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),f=await u.createFromOptions(d,{baseOptions:{modelAssetPath:e?.modelPath||s,delegate:"GPU"},canvas:K,runningMode:g,numPoses:e?.maxPoses??1,minPoseDetectionConfidence:e?.minPoseDetectionConfidence??.5,minPosePresenceConfidence:e?.minPosePresenceConfidence??.5,minTrackingConfidence:e?.minTrackingConfidence??.5,outputSegmentationMasks:!0})}catch(m){throw console.error("[Pose Plugin] Failed to initialize:",m),m}}function O(m,u,R){let x=1/0,T=-1/0,N=1/0,b=-1/0,A=0,I=0;for(let U of R){let v=(u*p+U)*4,y=m[v],P=m[v+1];x=Math.min(x,y),T=Math.max(T,y),N=Math.min(N,P),b=Math.max(b,P),A+=m[v+2],I+=m[v+3]}let S=(x+T)/2,w=(N+b)/2,H=A/R.length,C=I/R.length;return[S,w,H,C]}function te(m){if(!(!m||m.length===0||!E)){for(let u=0;u<m.length;++u){let R=m[u];E.updateTextures({u_mask:R.getAsWebGLTexture()}),E.updateUniforms({u_poseIndex:(u+1)/X}),E.draw({skipClear:u>0}),R.close()}i.updateTextures({u_poseMask:K})}}function ie(m){if(!o)return;let u=m.length,R=u*p;for(let T=0;T<u;++T){let N=m[T];for(let G=0;G<L;++G){let B=N[G],z=(T*p+G)*4;o[z]=B.x,o[z+1]=1-B.y,o[z+2]=B.z??0,o[z+3]=B.visibility??1}let b=O(o,T,Te),A=(T*p+a.BODY_CENTER)*4;o[A]=b[0],o[A+1]=b[1],o[A+2]=b[2],o[A+3]=b[3];let I=O(o,T,ge),S=(T*p+a.LEFT_HAND_CENTER)*4;o[S]=I[0],o[S+1]=I[1],o[S+2]=I[2],o[S+3]=I[3];let w=O(o,T,Ee),H=(T*p+a.RIGHT_HAND_CENTER)*4;o[H]=w[0],o[H+1]=w[1],o[H+2]=w[2],o[H+3]=w[3];let C=O(o,T,pe),U=(T*p+a.LEFT_FOOT_CENTER)*4;o[U]=C[0],o[U+1]=C[1],o[U+2]=C[2],o[U+3]=C[3];let v=O(o,T,_e),y=(T*p+a.RIGHT_FOOT_CENTER)*4;o[y]=v[0],o[y+1]=v[1],o[y+2]=v[2],o[y+3]=v[3];let P=O(o,T,xe),k=(T*p+a.TORSO_CENTER)*4;o[k]=P[0],o[k+1]=P[1],o[k+2]=P[2],o[k+3]=P[3]}let x=Math.ceil(R/F);i.updateTextures({u_poseLandmarksTex:{data:o,width:F,height:x,isPartial:!0}})}function j(m){if(!m.landmarks||!o)return;E||(E=new J(`#version 300 es
					precision mediump float;
					in vec2 v_uv;
					out vec4 outColor;
					uniform sampler2D u_mask;
					uniform float u_poseIndex;
					void main() {
						ivec2 texCoord = ivec2(v_uv * vec2(textureSize(u_mask, 0)));
						float confidence = texelFetch(u_mask, texCoord, 0).r;
						if (confidence < 0.01) discard;
						outColor = vec4(1.0, confidence, u_poseIndex, 1.0);
					}`,{canvas:K}),E.initializeTexture("u_mask",Q),E.initializeUniform("u_poseIndex","float",0));let u=m.landmarks.length;ie(m.landmarks),te(m.segmentationMasks),i.updateUniforms({u_nPoses:u}),e?.onResults?.(m)}i.registerHook("init",async()=>{i.initializeTexture("u_poseMask",Q,{preserveY:!0,minFilter:n.NEAREST,magFilter:n.NEAREST}),i.initializeUniform("u_maxPoses","int",X),i.initializeUniform("u_nPoses","int",0);let m=X*p;$=Math.ceil(m/F);let u=F*$*4;o=new Float32Array(u),i.initializeTexture("u_poseLandmarksTex",{data:o,width:F,height:$},{internalFormat:n.RGBA32F,type:n.FLOAT,minFilter:n.NEAREST,magFilter:n.NEAREST}),await ee(),e?.onReady?.()}),i.registerHook("updateTextures",async m=>{let u=m[t];if(!(!u||(_.get(t)!==u&&(c=-1),_.set(t,u),!f)))try{let x=u instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(g!==x&&(g=x,await f.setOptions({runningMode:g})),u instanceof HTMLVideoElement){if(u.videoWidth===0||u.videoHeight===0||u.readyState<2)return;if(u.currentTime!==c){c=u.currentTime;let T=f.detectForVideo(u,performance.now());j(T)}}else if(u instanceof HTMLImageElement||u instanceof HTMLCanvasElement){if(u.width===0||u.height===0)return;let T=f.detect(u);j(T)}}catch(x){console.error("[Pose Plugin] Detection error:",x)}}),i.registerHook("destroy",()=>{f&&(f.close(),f=null),E&&(E.destroy(),E=null),d=null,_.clear(),o=null}),h(`
uniform int u_maxPoses;
uniform int u_nPoses;
uniform sampler2D u_poseLandmarksTex;
uniform sampler2D u_poseMask;

#define POSE_LANDMARK_LEFT_EYE ${a.LEFT_EYE}
#define POSE_LANDMARK_RIGHT_EYE ${a.RIGHT_EYE}
#define POSE_LANDMARK_LEFT_SHOULDER ${a.LEFT_SHOULDER}
#define POSE_LANDMARK_RIGHT_SHOULDER ${a.RIGHT_SHOULDER}
#define POSE_LANDMARK_LEFT_ELBOW ${a.LEFT_ELBOW}
#define POSE_LANDMARK_RIGHT_ELBOW ${a.RIGHT_ELBOW}
#define POSE_LANDMARK_LEFT_HIP ${a.LEFT_HIP}
#define POSE_LANDMARK_RIGHT_HIP ${a.RIGHT_HIP}
#define POSE_LANDMARK_LEFT_KNEE ${a.LEFT_KNEE}
#define POSE_LANDMARK_RIGHT_KNEE ${a.RIGHT_KNEE}
#define POSE_LANDMARK_BODY_CENTER ${a.BODY_CENTER}
#define POSE_LANDMARK_LEFT_HAND_CENTER ${a.LEFT_HAND_CENTER}
#define POSE_LANDMARK_RIGHT_HAND_CENTER ${a.RIGHT_HAND_CENTER}
#define POSE_LANDMARK_LEFT_FOOT_CENTER ${a.LEFT_FOOT_CENTER}
#define POSE_LANDMARK_RIGHT_FOOT_CENTER ${a.RIGHT_FOOT_CENTER}
#define POSE_LANDMARK_TORSO_CENTER ${a.TORSO_CENTER}

vec4 poseLandmark(int poseIndex, int landmarkIndex) {
	int i = poseIndex * ${p} + landmarkIndex;
	int x = i % ${F};
	int y = i / ${F};
	return texelFetch(u_poseLandmarksTex, ivec2(x, y), 0);
}

vec2 poseAt(vec2 pos) {
	vec4 mask = texture(u_poseMask, pos);
	float poseIndex = floor(mask.b * float(u_maxPoses) + 0.5) - 1.0;
	return vec2(mask.g, poseIndex);
}
	
float inPose(vec2 pos) {
	float pose = poseAt(pos).x;
	return step(0.0, pose);
}`)}}var ve=Re;
//# sourceMappingURL=pose.js.map