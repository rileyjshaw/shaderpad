"use strict";var K=Object.create;var M=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var J=(o,t)=>{for(var e in t)M(o,e,{get:t[e],enumerable:!0})},B=(o,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of j(t))!Z.call(o,i)&&i!==e&&M(o,i,{get:()=>t[i],enumerable:!(r=V(t,i))||r.enumerable});return o};var z=(o,t,e)=>(e=o!=null?K(q(o)):{},B(t||!o||!o.__esModule?M(e,"default",{value:o,enumerable:!0}):e,o)),Q=o=>B(M({},"__esModule",{value:!0}),o);var pe={};J(pe,{default:()=>Ee});module.exports=Q(pe);var ee=`#version 300 es
in vec2 aPosition;
out vec2 v_uv;
void main() {
    v_uv = aPosition * 0.5 + 0.5;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}`,te=33.333333333333336,ie=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),H=Symbol("u_history"),D=Symbol("__SHADERPAD_BUFFER");function re(o,t){if(!t?.length)return o;let e=o.split(`
`),r=e.findLastIndex(i=>{let n=i.trimStart();return n.startsWith("precision ")||n.startsWith("#version ")})+1;return e.splice(r,0,...t),e.join(`
`)}function W(o){return o instanceof WebGLTexture?{width:0,height:0}:o instanceof U?{width:o.canvas.width,height:o.canvas.height}:o instanceof HTMLVideoElement?{width:o.videoWidth,height:o.videoHeight}:o instanceof HTMLImageElement?{width:o.naturalWidth??o.width,height:o.naturalHeight??o.height}:{width:o.width,height:o.height}}function O(o){return typeof o=="symbol"?o.description??"":o}var U=class o{isInternalCanvas=!1;isTouchDevice=!1;gl;uniforms=new Map;textures=new Map;textureUnitPool;buffer=null;program=null;aPositionLocation=0;animationFrameId;resolutionObserver;resizeObserver;resizeTimeout=null;lastResizeTime=-1/0;eventListeners=new Map;frame=0;startTime=0;cursorPosition=[.5,.5];clickPosition=[.5,.5];isMouseDown=!1;canvas;hooks=new Map;historyDepth=0;textureOptions;debug;intermediateFbo=null;constructor(t,{canvas:e,plugins:r,history:i,debug:n,...u}={}){if(this.canvas=e||document.createElement("canvas"),!e){this.isInternalCanvas=!0;let a=this.canvas;a.style.position="fixed",a.style.inset="0",a.style.height="100dvh",a.style.width="100dvw",document.body.appendChild(a)}if(this.canvas instanceof OffscreenCanvas){let a=E=>{let _=Object.getOwnPropertyDescriptor(OffscreenCanvas.prototype,E);Object.defineProperty(this.canvas,E,{get:()=>_.get.call(this.canvas),set:v=>{_.set.call(this.canvas,v),this.updateResolution()},configurable:_.configurable,enumerable:_.enumerable})};a("width"),a("height")}let s=this.canvas.getContext("webgl2",{antialias:!1});if(!s)throw new Error("WebGL2 not supported. Please use a browser that supports WebGL2.");this.gl=s,this.textureUnitPool={free:[],next:0,max:s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.textureOptions=u;let{internalFormat:m,type:d}=u;(d===s.FLOAT||d===s.HALF_FLOAT||m===s.RGBA16F||m===s.RGBA32F||m===s.R16F||m===s.R32F||m===s.RG16F||m===s.RG32F)&&!s.getExtension("EXT_color_buffer_float")&&(console.warn("EXT_color_buffer_float not supported, falling back to RGBA8"),delete this.textureOptions?.internalFormat,delete this.textureOptions?.format,delete this.textureOptions?.type),i&&(this.historyDepth=i),this.debug=n??(typeof process<"u"&&!1),this.animationFrameId=null,this.resolutionObserver=new MutationObserver(()=>this.updateResolution()),this.resizeObserver=new ResizeObserver(()=>this.throttledHandleResize());let T=[];r&&r.forEach(a=>a(this,{gl:s,canvas:this.canvas,injectGLSL:E=>{T.push(E)},emitHook:this.emitHook.bind(this)}));let c=this.gl.createProgram();if(!c)throw new Error("Failed to create WebGL program");this.program=c;let p=this.createShader(this.gl.VERTEX_SHADER,ee),g=this.createShader(s.FRAGMENT_SHADER,re(t,T));if(s.attachShader(c,p),s.attachShader(c,g),s.linkProgram(c),s.deleteShader(p),s.deleteShader(g),!s.getProgramParameter(c,s.LINK_STATUS))throw console.error("Program link error:",s.getProgramInfoLog(c)),s.deleteProgram(c),new Error("Failed to link WebGL program");this.aPositionLocation=s.getAttribLocation(c,"aPosition"),this.buffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,this.buffer),s.bufferData(s.ARRAY_BUFFER,ie,s.STATIC_DRAW),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.enableVertexAttribArray(this.aPositionLocation),s.vertexAttribPointer(this.aPositionLocation,2,s.FLOAT,!1,0,0),s.useProgram(c),this.canvas instanceof HTMLCanvasElement&&(this.resolutionObserver.observe(this.canvas,{attributes:!0,attributeFilter:["width","height"]}),this.resizeObserver.observe(this.canvas)),this.isInternalCanvas||this.updateResolution(),this.initializeUniform("u_cursor","float",this.cursorPosition),this.initializeUniform("u_click","float",[...this.clickPosition,this.isMouseDown?1:0]),this.initializeUniform("u_time","float",0),this.initializeUniform("u_frame","int",0),this._initializeTexture(D,this.canvas,{...this.textureOptions}),this.intermediateFbo=s.createFramebuffer(),this.historyDepth>0&&this._initializeTexture(H,this.canvas,{history:this.historyDepth,...this.textureOptions}),this.canvas instanceof HTMLCanvasElement&&this.addEventListeners(),this.emitHook("init")}emitHook(t,...e){this.hooks.get(t)?.forEach(r=>r.call(this,...e))}on(t,e){this.hooks.has(t)||this.hooks.set(t,[]),this.hooks.get(t).push(e)}off(t,e){let r=this.hooks.get(t);r&&r.splice(r.indexOf(e),1)}createShader(t,e){let r=this.gl.createShader(t);if(this.gl.shaderSource(r,e),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS))throw console.error("Shader compilation failed:",e),console.error(this.gl.getShaderInfoLog(r)),this.gl.deleteShader(r),new Error("Shader compilation failed");return r}throttledHandleResize(){clearTimeout(this.resizeTimeout);let t=performance.now(),e=this.lastResizeTime+te-t;e<=0?(this.lastResizeTime=t,this.handleResize()):this.resizeTimeout=setTimeout(()=>this.throttledHandleResize(),e)}handleResize(){if(!(this.canvas instanceof HTMLCanvasElement))return;let t=window.devicePixelRatio||1,e=this.canvas.clientWidth*t,r=this.canvas.clientHeight*t;this.isInternalCanvas&&(this.canvas.width!==e||this.canvas.height!==r)&&(this.canvas.width=e,this.canvas.height=r),this.emitHook("resize",e,r)}addEventListeners(){let t=this.canvas,e=(i,n)=>{if(!this.uniforms.has("u_cursor"))return;let u=t.getBoundingClientRect();this.cursorPosition[0]=(i-u.left)/u.width,this.cursorPosition[1]=1-(n-u.top)/u.height,this.updateUniforms({u_cursor:this.cursorPosition})},r=(i,n,u)=>{if(this.uniforms.has("u_click")){if(this.isMouseDown=i,i){let s=t.getBoundingClientRect(),m=n,d=u;this.clickPosition[0]=(m-s.left)/s.width,this.clickPosition[1]=1-(d-s.top)/s.height}this.updateUniforms({u_click:[...this.clickPosition,this.isMouseDown?1:0]})}};this.eventListeners.set("mousemove",i=>{let n=i;this.isTouchDevice||e(n.clientX,n.clientY)}),this.eventListeners.set("mousedown",i=>{let n=i;this.isTouchDevice||n.button===0&&(this.isMouseDown=!0,r(!0,n.clientX,n.clientY))}),this.eventListeners.set("mouseup",i=>{let n=i;this.isTouchDevice||n.button===0&&r(!1)}),this.eventListeners.set("touchmove",i=>{let n=i;n.touches.length>0&&e(n.touches[0].clientX,n.touches[0].clientY)}),this.eventListeners.set("touchstart",i=>{let n=i;this.isTouchDevice=!0,n.touches.length>0&&(e(n.touches[0].clientX,n.touches[0].clientY),r(!0,n.touches[0].clientX,n.touches[0].clientY))}),this.eventListeners.set("touchend",i=>{i.touches.length===0&&r(!1)}),this.eventListeners.forEach((i,n)=>{t.addEventListener(n,i)})}updateResolution(){let t=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight];this.gl.viewport(0,0,...t),this.uniforms.has("u_resolution")?this.updateUniforms({u_resolution:t}):this.initializeUniform("u_resolution","float",t),this.resizeTexture(D,...t),this.historyDepth>0&&this.resizeTexture(H,...t),this.emitHook("updateResolution",...t)}resizeTexture(t,e,r){let i=this.textures.get(t);if(!i||i.width===e&&i.height===r)return;this.gl.deleteTexture(i.texture),i.width=e,i.height=r;let{texture:n}=this.createTexture(t,i);i.texture=n,i.history&&(i.history.writeIndex=0,this.clearHistoryTextureLayers(i))}reserveTextureUnit(t){let e=this.textures.get(t);if(e)return e.unitIndex;if(this.textureUnitPool.free.length>0)return this.textureUnitPool.free.pop();if(this.textureUnitPool.next>=this.textureUnitPool.max)throw new Error("Exceeded the available texture units for this device.");return this.textureUnitPool.next++}releaseTextureUnit(t){let e=this.textures.get(t);e&&this.textureUnitPool.free.push(e.unitIndex)}resolveTextureOptions(t){let{gl:e}=this,r=t?.type??e.UNSIGNED_BYTE;return{type:r,format:t?.format??e.RGBA,internalFormat:t?.internalFormat??(r===e.FLOAT?e.RGBA32F:r===e.HALF_FLOAT?e.RGBA16F:e.RGBA8),minFilter:t?.minFilter??e.LINEAR,magFilter:t?.magFilter??e.LINEAR,wrapS:t?.wrapS??e.CLAMP_TO_EDGE,wrapT:t?.wrapT??e.CLAMP_TO_EDGE,preserveY:t?.preserveY}}getPixelArray(t,e){return t===this.gl.FLOAT?new Float32Array(e):t===this.gl.HALF_FLOAT?new Uint16Array(e):new Uint8Array(e)}clearHistoryTextureLayers(t){if(!t.history)return;let e=this.gl,{type:r,format:i}=t.options,n=this.getPixelArray(r,t.width*t.height*4);e.activeTexture(e.TEXTURE0+t.unitIndex),e.bindTexture(e.TEXTURE_2D_ARRAY,t.texture);for(let u=0;u<t.history.depth;++u)e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,u,t.width,t.height,1,i,r,n)}initializeUniform(t,e,r,i){let n=i?.arrayLength;if(this.uniforms.has(t))throw new Error(`${t} is already initialized.`);if(e!=="float"&&e!=="int")throw new Error(`Invalid uniform type: ${e}. Expected 'float' or 'int'.`);if(n&&!(Array.isArray(r)&&r.length===n))throw new Error(`${t} array length mismatch: must initialize with ${n} elements.`);let u=this.gl.getUniformLocation(this.program,t);if(!u&&n&&(u=this.gl.getUniformLocation(this.program,`${t}[0]`)),!u){this.log(`${t} not in shader. Skipping initialization.`);return}let s=n?r[0]:r,m=Array.isArray(s)?s.length:1;this.uniforms.set(t,{type:e,length:m,location:u,arrayLength:n});try{this.updateUniforms({[t]:r})}catch(d){throw this.uniforms.delete(t),d}this.emitHook("initializeUniform",...arguments)}log(...t){this.debug&&console.debug(...t)}updateUniforms(t,e){this.gl.useProgram(this.program),Object.entries(t).forEach(([r,i])=>{let n=this.uniforms.get(r);if(!n){this.log(`${r} not in shader. Skipping update.`);return}let u=`uniform${n.length}${n.type.charAt(0)}`;if(n.arrayLength){if(!Array.isArray(i))throw new Error(`${r} is an array, but the value passed to updateUniforms is not an array.`);let s=i.length;if(!s)return;if(s>n.arrayLength)throw new Error(`${r} received ${s} values, but maximum length is ${n.arrayLength}.`);if(i.some(l=>(Array.isArray(l)?l.length:1)!==n.length))throw new Error(`Tried to update ${r} with some elements that are not length ${n.length}.`);let m=new(n.type==="float"?Float32Array:Int32Array)(i.flat()),d=n.location;if(e?.startIndex){let l=this.gl.getUniformLocation(this.program,`${r}[${e.startIndex}]`);if(!l)throw new Error(`${r}[${e.startIndex}] not in shader. Did you pass an invalid startIndex?`);d=l}this.gl[u+"v"](d,m)}else{if(Array.isArray(i)||(i=[i]),i.length!==n.length)throw new Error(`Invalid uniform value length: ${i.length}. Expected ${n.length}.`);this.gl[u](n.location,...i)}}),this.emitHook("updateUniforms",...arguments)}createTexture(t,e){let{width:r,height:i}=e,n=e.history?.depth??0,u=this.gl.createTexture();if(!u)throw new Error("Failed to create texture");let s=e.unitIndex;if(typeof s!="number")try{s=this.reserveTextureUnit(t)}catch(T){throw this.gl.deleteTexture(u),T}let m=n>0,d=m?this.gl.TEXTURE_2D_ARRAY:this.gl.TEXTURE_2D,{options:l}=e;return this.gl.activeTexture(this.gl.TEXTURE0+s),this.gl.bindTexture(d,u),this.gl.texParameteri(d,this.gl.TEXTURE_WRAP_S,l.wrapS),this.gl.texParameteri(d,this.gl.TEXTURE_WRAP_T,l.wrapT),this.gl.texParameteri(d,this.gl.TEXTURE_MIN_FILTER,l.minFilter),this.gl.texParameteri(d,this.gl.TEXTURE_MAG_FILTER,l.magFilter),m?this.gl.texStorage3D(d,1,l.internalFormat,r,i,n):t===D&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,l.internalFormat,r,i,0,l.format,l.type,null),{texture:u,unitIndex:s}}_initializeTexture(t,e,r){if(this.textures.has(t))throw new Error(`Texture '${O(t)}' is already initialized.`);let{history:i=0,...n}=r??{},{width:u,height:s}=W(e);if(!u||!s)throw new Error("Texture source must have valid dimensions");let m={width:u,height:s,options:this.resolveTextureOptions(n)};i>0&&(m.history={depth:i,writeIndex:0});let{texture:d,unitIndex:l}=this.createTexture(t,m),T={texture:d,unitIndex:l,...m};i>0&&(this.initializeUniform(`${O(t)}FrameOffset`,"int",0),this.clearHistoryTextureLayers(T)),this.textures.set(t,T),this.updateTexture(t,e);let c=this.gl.getUniformLocation(this.program,O(t));c&&this.gl.uniform1i(c,l)}initializeTexture(t,e,r){this._initializeTexture(t,e,r),this.emitHook("initializeTexture",...arguments)}updateTextures(t,e){Object.entries(t).forEach(([r,i])=>{this.updateTexture(r,i,e)}),this.emitHook("updateTextures",...arguments)}updateTexture(t,e,r){let i=this.textures.get(t);if(!i)throw new Error(`Texture '${O(t)}' is not initialized.`);if(e instanceof WebGLTexture){this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,e);return}let n=e;if(e instanceof o){let c=e.textures.get(D);if(e.gl===this.gl){this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,c.texture);return}let{width:p,height:g,options:{format:a,type:E}}=c,_=this.getPixelArray(E,p*g*4);e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,e.intermediateFbo),e.gl.readPixels(0,0,p,g,a,E,_),e.gl.bindFramebuffer(e.gl.FRAMEBUFFER,null),n={data:_,width:p,height:g}}let{width:u,height:s}=W(n);if(!u||!s)return;let m="isPartial"in n&&n.isPartial;m||this.resizeTexture(t,u,s);let l=!("data"in n&&n.data)&&!i.options?.preserveY,T=this.gl.getParameter(this.gl.UNPACK_FLIP_Y_WEBGL);if(i.history){if(this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,i.texture),!r?.skipHistoryWrite){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,l),this.gl.texSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,i.history.writeIndex,u,s,1,i.options.format,i.options.type,n.data??n),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,T);let c=`${O(t)}FrameOffset`;this.updateUniforms({[c]:i.history.writeIndex}),i.history.writeIndex=(i.history.writeIndex+1)%i.history.depth}}else{if(this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,l),m){let c=n;this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,c.x??0,c.y??0,u,s,i.options.format,i.options.type,c.data)}else this.gl.texImage2D(this.gl.TEXTURE_2D,0,i.options.internalFormat,u,s,0,i.options.format,i.options.type,n.data??n);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,T)}}draw(t){this.emitHook("beforeDraw",...arguments);let e=this.gl,r=e.drawingBufferWidth,i=e.drawingBufferHeight,n=this.textures.get(D);e.bindFramebuffer(e.FRAMEBUFFER,this.intermediateFbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n.texture,0),e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.vertexAttribPointer(this.aPositionLocation,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.aPositionLocation),e.viewport(0,0,r,i),t?.skipClear||e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6);let u=this.textures.get(H);u&&!t?.skipHistoryWrite&&(e.bindTexture(e.TEXTURE_2D_ARRAY,u.texture),e.copyTexSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,u.history.writeIndex,0,0,r,i)),e.bindFramebuffer(e.READ_FRAMEBUFFER,this.intermediateFbo),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.blitFramebuffer(0,0,r,i,0,0,r,i,e.COLOR_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,null),this.emitHook("afterDraw",...arguments)}step(t,e){this.emitHook("beforeStep",...arguments);let r={};this.uniforms.has("u_time")&&(r.u_time=t),this.uniforms.has("u_frame")&&(r.u_frame=this.frame),this.updateUniforms(r),this.draw(e);let i=this.textures.get(H);if(i&&!e?.skipHistoryWrite){let{writeIndex:n,depth:u}=i.history;this.updateUniforms({[`${O(H)}FrameOffset`]:n}),i.history.writeIndex=(n+1)%u}++this.frame,this.emitHook("afterStep",...arguments)}play(t,e){this.pause();let r=i=>{i=(i-this.startTime)/1e3;let n=e?.(i,this.frame)??void 0;this.step(i,n),this.animationFrameId=requestAnimationFrame(r),t?.(i,this.frame)};this.animationFrameId=requestAnimationFrame(r),this.emitHook("play")}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.emitHook("pause")}reset(){this.frame=0,this.startTime=performance.now(),this.textures.forEach(t=>{t.history&&(t.history.writeIndex=0,this.clearHistoryTextureLayers(t))}),this.emitHook("reset")}destroy(){this.emitHook("destroy"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resolutionObserver.disconnect(),this.resizeObserver.disconnect(),this.canvas instanceof HTMLCanvasElement&&this.eventListeners.forEach((t,e)=>{this.canvas.removeEventListener(e,t)}),this.program&&this.gl.deleteProgram(this.program),this.intermediateFbo&&(this.gl.deleteFramebuffer(this.intermediateFbo),this.intermediateFbo=null),this.textures.forEach(t=>{this.gl.deleteTexture(t.texture)}),this.textureUnitPool.free=[],this.textureUnitPool.next=0,this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this.isInternalCanvas&&this.canvas instanceof HTMLCanvasElement&&this.canvas.remove()}},Y=U;function k(o){return o instanceof HTMLVideoElement||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof OffscreenCanvas}function X(o){return JSON.stringify(o,Object.keys(o).sort())}function A(o,t,e,r){let i=1/0,n=-1/0,u=1/0,s=-1/0,m=0,d=0;for(let l of e){let T=(t*r+l)*4,c=o[T],p=o[T+1];i=Math.min(i,c),n=Math.max(n,c),u=Math.min(u,p),s=Math.max(s,p),m+=o[T+2],d+=o[T+3]}return[(i+n)/2,(u+s)/2,m/e.length,d/e.length]}var N=null;function $(){return N||(N=import("@mediapipe/tasks-vision").then(({FilesetResolver:o})=>o.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22-rc.20250304/wasm"))),N}var b=33,ne=6,x=b+ne,h={LEFT_EYE:2,RIGHT_EYE:5,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32,BODY_CENTER:b,LEFT_HAND_CENTER:b+1,RIGHT_HAND_CENTER:b+2,LEFT_FOOT_CENTER:b+3,RIGHT_FOOT_CENTER:b+4,TORSO_CENTER:b+5},se=Array.from({length:b},(o,t)=>t),oe=[h.LEFT_WRIST,h.LEFT_PINKY,h.LEFT_THUMB,h.LEFT_INDEX],ae=[h.RIGHT_WRIST,h.RIGHT_PINKY,h.RIGHT_THUMB,h.RIGHT_INDEX],ue=[h.LEFT_ANKLE,h.LEFT_HEEL,h.LEFT_FOOT_INDEX],he=[h.RIGHT_ANKLE,h.RIGHT_HEEL,h.RIGHT_FOOT_INDEX],le=[h.LEFT_SHOULDER,h.RIGHT_SHOULDER,h.LEFT_HIP,h.RIGHT_HIP],P=512,ce={data:new Uint8Array(4),width:1,height:1},me={modelPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",maxPoses:1,minPoseDetectionConfidence:.5,minPosePresenceConfidence:.5,minTrackingConfidence:.5},w=new Map;function de(o,t){let e=o.landmarks.data,r=t.length;for(let i=0;i<r;++i){let n=t[i];for(let v=0;v<b;++v){let L=n[v],F=(i*x+v)*4;e[F]=L.x,e[F+1]=1-L.y,e[F+2]=L.z??0,e[F+3]=L.visibility??1}let u=A(e,i,se,x),s=(i*x+h.BODY_CENTER)*4;e[s]=u[0],e[s+1]=u[1],e[s+2]=u[2],e[s+3]=u[3];let m=A(e,i,oe,x),d=(i*x+h.LEFT_HAND_CENTER)*4;e[d]=m[0],e[d+1]=m[1],e[d+2]=m[2],e[d+3]=m[3];let l=A(e,i,ae,x),T=(i*x+h.RIGHT_HAND_CENTER)*4;e[T]=l[0],e[T+1]=l[1],e[T+2]=l[2],e[T+3]=l[3];let c=A(e,i,ue,x),p=(i*x+h.LEFT_FOOT_CENTER)*4;e[p]=c[0],e[p+1]=c[1],e[p+2]=c[2],e[p+3]=c[3];let g=A(e,i,he,x),a=(i*x+h.RIGHT_FOOT_CENTER)*4;e[a]=g[0],e[a+1]=g[1],e[a+2]=g[2],e[a+3]=g[3];let E=A(e,i,le,x),_=(i*x+h.TORSO_CENTER)*4;e[_]=E[0],e[_+1]=E[1],e[_+2]=E[2],e[_+3]=E[3]}o.state.nPoses=r}function fe(o,t){if(!t||t.length===0)return;let{mask:{shader:e},maxPoses:r}=o;for(let i=0;i<t.length;++i){let n=t[i];e.updateTextures({u_mask:n.getAsWebGLTexture()}),e.updateUniforms({u_poseIndex:(i+1)/r}),e.draw({skipClear:i>0}),n.close()}}function Te(o){let{textureName:t,options:e={}}=o,r={...me,...e},i=X({...r,textureName:t}),n=r.maxPoses*x,u=Math.ceil(n/P);return function(s,m){let{injectGLSL:d,gl:l,emitHook:T}=m,c=w.get(i),p=c?.landmarks.data??new Float32Array(P*u*4),g=c?.canvas??new OffscreenCanvas(1,1),a=null;function E(){if(!a)return;let{nPoses:f}=a.state,R=f*x,S=Math.ceil(R/P);s.updateTextures({u_poseLandmarksTex:{data:a.landmarks.data,width:P,height:S,isPartial:!0},u_poseMask:a.canvas}),s.updateUniforms({u_nPoses:f}),T("pose:result",a.state.result)}async function _(){if(w.has(i))a=w.get(i);else{let[f,{PoseLandmarker:R}]=await Promise.all([$(),import("@mediapipe/tasks-vision")]),S=await R.createFromOptions(f,{baseOptions:{modelAssetPath:r.modelPath,delegate:"GPU"},canvas:g,runningMode:"VIDEO",numPoses:r.maxPoses,minPoseDetectionConfidence:r.minPoseDetectionConfidence,minPosePresenceConfidence:r.minPosePresenceConfidence,minTrackingConfidence:r.minTrackingConfidence,outputSegmentationMasks:!0}),I=new Y(`#version 300 es
	precision mediump float;
	in vec2 v_uv;
	out vec4 outColor;
	uniform sampler2D u_mask;
	uniform float u_poseIndex;
	void main() {
		ivec2 texCoord = ivec2(v_uv * vec2(textureSize(u_mask, 0)));
		float confidence = texelFetch(u_mask, texCoord, 0).r;
		if (confidence < 0.01) discard;
		outColor = vec4(1.0, confidence, u_poseIndex, 1.0);
	}`,{canvas:g});I.initializeTexture("u_mask",ce),I.initializeUniform("u_poseIndex","float",0),a={landmarker:S,canvas:g,subscribers:new Map,maxPoses:r.maxPoses,state:{runningMode:"VIDEO",source:null,videoTime:-1,resultTimestamp:0,result:null,pending:Promise.resolve(),nPoses:0},landmarks:{data:p,textureHeight:u},mask:{shader:I}},w.set(i,a)}a.subscribers.set(E,!1)}let v=_();s.on("init",()=>{s.initializeUniform("u_maxPoses","int",r.maxPoses),s.initializeUniform("u_nPoses","int",0),s.initializeTexture("u_poseLandmarksTex",{data:p,width:P,height:u},{internalFormat:l.RGBA32F,type:l.FLOAT,minFilter:l.NEAREST,magFilter:l.NEAREST}),s.initializeTexture("u_poseMask",g,{preserveY:!0,minFilter:l.NEAREST,magFilter:l.NEAREST}),v.then(()=>T("pose:ready"))}),s.on("initializeTexture",(f,R)=>{f===t&&k(R)&&F(R)}),s.on("updateTextures",f=>{let R=f[t];k(R)&&F(R)});let L=0;async function F(f){let R=performance.now(),S=++L;await v,a&&(a.state.pending=a.state.pending.then(async()=>{if(S!==L||!a)return;let I=f instanceof HTMLVideoElement?"VIDEO":"IMAGE";a.state.runningMode!==I&&(a.state.runningMode=I,await a.landmarker.setOptions({runningMode:I}));let C=!1;if(f!==a.state.source?(a.state.source=f,a.state.videoTime=-1,C=!0):f instanceof HTMLVideoElement?f.currentTime!==a.state.videoTime&&(a.state.videoTime=f.currentTime,C=!0):f instanceof HTMLImageElement||R-a.state.resultTimestamp>2&&(C=!0),C){let y;if(f instanceof HTMLVideoElement){if(f.videoWidth===0||f.videoHeight===0||f.readyState<2)return;y=a.landmarker.detectForVideo(f,R)}else{if(f.width===0||f.height===0)return;y=a.landmarker.detect(f)}if(y){a.state.resultTimestamp=R,a.state.result=y,de(a,y.landmarks),fe(a,y.segmentationMasks);for(let G of a.subscribers.keys())G(),a.subscribers.set(G,!0)}}else a.state.result&&!a.subscribers.get(E)&&(E(),a.subscribers.set(E,!0))}),await a.state.pending)}s.on("destroy",()=>{a&&(a.subscribers.delete(E),a.subscribers.size===0&&(a.landmarker.close(),a.mask.shader?.destroy(),w.delete(i))),a=null}),d(`
uniform int u_maxPoses;
uniform int u_nPoses;
uniform sampler2D u_poseLandmarksTex;
uniform sampler2D u_poseMask;

#define POSE_LANDMARK_LEFT_EYE ${h.LEFT_EYE}
#define POSE_LANDMARK_RIGHT_EYE ${h.RIGHT_EYE}
#define POSE_LANDMARK_LEFT_SHOULDER ${h.LEFT_SHOULDER}
#define POSE_LANDMARK_RIGHT_SHOULDER ${h.RIGHT_SHOULDER}
#define POSE_LANDMARK_LEFT_ELBOW ${h.LEFT_ELBOW}
#define POSE_LANDMARK_RIGHT_ELBOW ${h.RIGHT_ELBOW}
#define POSE_LANDMARK_LEFT_HIP ${h.LEFT_HIP}
#define POSE_LANDMARK_RIGHT_HIP ${h.RIGHT_HIP}
#define POSE_LANDMARK_LEFT_KNEE ${h.LEFT_KNEE}
#define POSE_LANDMARK_RIGHT_KNEE ${h.RIGHT_KNEE}
#define POSE_LANDMARK_BODY_CENTER ${h.BODY_CENTER}
#define POSE_LANDMARK_LEFT_HAND_CENTER ${h.LEFT_HAND_CENTER}
#define POSE_LANDMARK_RIGHT_HAND_CENTER ${h.RIGHT_HAND_CENTER}
#define POSE_LANDMARK_LEFT_FOOT_CENTER ${h.LEFT_FOOT_CENTER}
#define POSE_LANDMARK_RIGHT_FOOT_CENTER ${h.RIGHT_FOOT_CENTER}
#define POSE_LANDMARK_TORSO_CENTER ${h.TORSO_CENTER}

vec4 poseLandmark(int poseIndex, int landmarkIndex) {
	int i = poseIndex * ${x} + landmarkIndex;
	int x = i % ${P};
	int y = i / ${P};
	return texelFetch(u_poseLandmarksTex, ivec2(x, y), 0);
}

vec2 poseAt(vec2 pos) {
	vec4 mask = texture(u_poseMask, pos);
	float poseIndex = floor(mask.b * float(u_maxPoses) + 0.5) - 1.0;
	return vec2(mask.g, poseIndex);
}
	
float inPose(vec2 pos) {
	float pose = poseAt(pos).x;
	return step(0.0, pose);
}`)}}var Ee=Te;
//# sourceMappingURL=pose.js.map