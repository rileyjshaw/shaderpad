"use strict";var it=Object.create;var z=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var st=Object.getOwnPropertyNames;var nt=Object.getPrototypeOf,ot=Object.prototype.hasOwnProperty;var at=(a,t)=>{for(var e in t)z(a,e,{get:t[e],enumerable:!0})},j=(a,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of st(t))!ot.call(a,r)&&r!==e&&z(a,r,{get:()=>t[r],enumerable:!(i=rt(t,r))||i.enumerable});return a};var ht=(a,t,e)=>(e=a!=null?it(nt(a)):{},j(t||!a||!a.__esModule?z(e,"default",{value:a,enumerable:!0}):e,a)),lt=a=>j(z({},"__esModule",{value:!0}),a);var Lt={};at(Lt,{default:()=>Rt});module.exports=lt(Lt);var ut=`#version 300 es
in vec2 aPosition;
out vec2 v_uv;
void main() {
    v_uv = aPosition * 0.5 + 0.5;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}
`,ct=33.333333333333336,Y=Symbol("u_history");function mt(a,t){if(!t?.length)return a;let e=a.split(`
`),i=e.findLastIndex(r=>{let s=r.trimStart();return s.startsWith("precision ")||s.startsWith("#version ")})+1;return e.splice(i,0,...t),e.join(`
`)}function q(a){return a instanceof WebGLTexture?{width:0,height:0}:a instanceof HTMLVideoElement?{width:a.videoWidth,height:a.videoHeight}:a instanceof HTMLImageElement?{width:a.naturalWidth??a.width,height:a.naturalHeight??a.height}:{width:a.width,height:a.height}}function U(a){return typeof a=="symbol"?a.description??"":a}var X=class{isInternalCanvas=!1;isTouchDevice=!1;gl;fragmentShaderSrc;uniforms=new Map;textures=new Map;textureUnitPool;buffer=null;program=null;aPositionLocation=0;animationFrameId;resolutionObserver;resizeObserver;resizeTimeout=null;lastResizeTime=-1/0;eventListeners=new Map;frame=0;startTime=0;cursorPosition=[.5,.5];clickPosition=[.5,.5];isMouseDown=!1;canvas;onResize;hooks=new Map;historyDepth;debug;constructor(t,e={}){if(this.canvas=e.canvas||document.createElement("canvas"),!e.canvas){this.isInternalCanvas=!0;let r=this.canvas;r.style.position="fixed",r.style.inset="0",r.style.height="100dvh",r.style.width="100dvw",document.body.appendChild(r)}if(this.gl=this.canvas.getContext("webgl2",{antialias:!1}),!this.gl)throw new Error("WebGL2 not supported. Please use a browser that supports WebGL2.");this.textureUnitPool={free:[],next:0,max:this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.historyDepth=e.history??0,this.debug=e.debug??(typeof process<"u"&&!1),this.animationFrameId=null,this.resolutionObserver=new MutationObserver(()=>this.updateResolution()),this.resizeObserver=new ResizeObserver(()=>this.throttledHandleResize());let i=[];if(e.plugins){let r={gl:this.gl,uniforms:this.uniforms,textures:this.textures,canvas:this.canvas,reserveTextureUnit:this.reserveTextureUnit.bind(this),releaseTextureUnit:this.releaseTextureUnit.bind(this),injectGLSL:s=>{i.push(s)}};Object.defineProperty(r,"program",{get:()=>this.program,enumerable:!0,configurable:!0}),e.plugins.forEach(s=>s(this,r))}this.fragmentShaderSrc=mt(t,i),this.init(),this.canvas instanceof HTMLCanvasElement&&this.addEventListeners()}registerHook(t,e){this.hooks.has(t)||this.hooks.set(t,[]),this.hooks.get(t).push(e)}init(){let t=ut;if(this.program=this.gl.createProgram(),!this.program)throw new Error("Failed to create WebGL program");let e=this.createShader(this.gl.VERTEX_SHADER,t),i=this.createShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderSrc);if(this.gl.attachShader(this.program,e),this.gl.attachShader(this.program,i),this.gl.linkProgram(this.program),this.gl.deleteShader(e),this.gl.deleteShader(i),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))throw console.error("Program link error:",this.gl.getProgramInfoLog(this.program)),this.gl.deleteProgram(this.program),new Error("Failed to link WebGL program");this.aPositionLocation=this.gl.getAttribLocation(this.program,"aPosition"),this.setupBuffer(),this.gl.useProgram(this.program),this.canvas instanceof HTMLCanvasElement&&(this.resolutionObserver.observe(this.canvas,{attributes:!0,attributeFilter:["width","height"]}),this.resizeObserver.observe(this.canvas)),this.isInternalCanvas||this.updateResolution(),this.initializeUniform("u_cursor","float",this.cursorPosition),this.initializeUniform("u_click","float",[...this.clickPosition,this.isMouseDown?1:0]),this.initializeUniform("u_time","float",0),this.initializeUniform("u_frame","int",0),this.historyDepth>0&&this._initializeTexture(Y,this.canvas,{history:this.historyDepth}),this.hooks.get("init")?.forEach(r=>r.call(this))}createShader(t,e){let i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw console.error("Shader compilation failed:",e),console.error(this.gl.getShaderInfoLog(i)),this.gl.deleteShader(i),new Error("Shader compilation failed");return i}setupBuffer(){let t=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.enableVertexAttribArray(this.aPositionLocation),this.gl.vertexAttribPointer(this.aPositionLocation,2,this.gl.FLOAT,!1,0,0)}throttledHandleResize(){clearTimeout(this.resizeTimeout);let t=performance.now(),e=this.lastResizeTime+ct-t;e<=0?(this.lastResizeTime=t,this.handleResize()):this.resizeTimeout=setTimeout(()=>this.throttledHandleResize(),e)}handleResize(){if(!(this.canvas instanceof HTMLCanvasElement))return;let t=window.devicePixelRatio||1,e=this.canvas.clientWidth*t,i=this.canvas.clientHeight*t;this.isInternalCanvas&&(this.canvas.width!==e||this.canvas.height!==i)&&(this.canvas.width=e,this.canvas.height=i),this.onResize?.(e,i)}addEventListeners(){let t=this.canvas,e=(r,s)=>{if(!this.uniforms.has("u_cursor"))return;let d=t.getBoundingClientRect();this.cursorPosition[0]=(r-d.left)/d.width,this.cursorPosition[1]=1-(s-d.top)/d.height,this.updateUniforms({u_cursor:this.cursorPosition})},i=(r,s,d)=>{if(this.uniforms.has("u_click")){if(this.isMouseDown=r,r){let l=t.getBoundingClientRect(),c=s,f=d;this.clickPosition[0]=(c-l.left)/l.width,this.clickPosition[1]=1-(f-l.top)/l.height}this.updateUniforms({u_click:[...this.clickPosition,this.isMouseDown?1:0]})}};this.eventListeners.set("mousemove",r=>{let s=r;this.isTouchDevice||e(s.clientX,s.clientY)}),this.eventListeners.set("mousedown",r=>{let s=r;this.isTouchDevice||s.button===0&&(this.isMouseDown=!0,i(!0,s.clientX,s.clientY))}),this.eventListeners.set("mouseup",r=>{let s=r;this.isTouchDevice||s.button===0&&i(!1)}),this.eventListeners.set("touchmove",r=>{let s=r;s.touches.length>0&&e(s.touches[0].clientX,s.touches[0].clientY)}),this.eventListeners.set("touchstart",r=>{let s=r;this.isTouchDevice=!0,s.touches.length>0&&(e(s.touches[0].clientX,s.touches[0].clientY),i(!0,s.touches[0].clientX,s.touches[0].clientY))}),this.eventListeners.set("touchend",r=>{r.touches.length===0&&i(!1)}),this.eventListeners.forEach((r,s)=>{t.addEventListener(s,r)})}updateResolution(){let t=[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight];this.gl.viewport(0,0,...t),this.uniforms.has("u_resolution")?this.updateUniforms({u_resolution:t}):this.initializeUniform("u_resolution","float",t),this.hooks.get("updateResolution")?.forEach(e=>e.call(this))}reserveTextureUnit(t){let e=this.textures.get(t);if(e)return e.unitIndex;if(this.textureUnitPool.free.length>0)return this.textureUnitPool.free.pop();if(this.textureUnitPool.next>=this.textureUnitPool.max)throw new Error("Exceeded the available texture units for this device.");return this.textureUnitPool.next++}releaseTextureUnit(t){let e=this.textures.get(t);e&&this.textureUnitPool.free.push(e.unitIndex)}clearHistoryTextureLayers(t){if(!t.history)return;let e=t.options?.type??this.gl.UNSIGNED_BYTE,i=e===this.gl.FLOAT?new Float32Array(t.width*t.height*4):new Uint8Array(t.width*t.height*4);this.gl.activeTexture(this.gl.TEXTURE0+t.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,t.texture);for(let r=0;r<t.history.depth;++r)this.gl.texSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,r,t.width,t.height,1,t.options?.format??this.gl.RGBA,e,i)}initializeUniform(t,e,i,r){let s=r?.arrayLength;if(this.uniforms.has(t))throw new Error(`${t} is already initialized.`);if(e!=="float"&&e!=="int")throw new Error(`Invalid uniform type: ${e}. Expected 'float' or 'int'.`);if(s&&!(Array.isArray(i)&&i.length===s))throw new Error(`${t} array length mismatch: must initialize with ${s} elements.`);let d=this.gl.getUniformLocation(this.program,t);if(!d&&s&&(d=this.gl.getUniformLocation(this.program,`${t}[0]`)),!d){this.log(`${t} not found in fragment shader. Skipping initialization.`);return}let l=s?i[0]:i,c=Array.isArray(l)?l.length:1;this.uniforms.set(t,{type:e,length:c,location:d,arrayLength:s});try{this.updateUniforms({[t]:i})}catch(f){throw this.uniforms.delete(t),f}this.hooks.get("initializeUniform")?.forEach(f=>f.call(this,...arguments))}log(...t){this.debug&&console.debug(...t)}updateUniforms(t,e){this.gl.useProgram(this.program),Object.entries(t).forEach(([i,r])=>{let s=this.uniforms.get(i);if(!s){this.log(`${i} not found in fragment shader. Skipping update.`);return}let d=`uniform${s.length}${s.type.charAt(0)}`;if(s.arrayLength){if(!Array.isArray(r))throw new Error(`${i} is an array, but the value passed to updateUniforms is not an array.`);let l=r.length;if(!l)return;if(l>s.arrayLength)throw new Error(`${i} received ${l} values, but maximum length is ${s.arrayLength}.`);if(r.some(m=>(Array.isArray(m)?m.length:1)!==s.length))throw new Error(`Tried to update ${i} with some elements that are not length ${s.length}.`);let c=new(s.type==="float"?Float32Array:Int32Array)(r.flat()),f=s.location;if(e?.startIndex){let m=this.gl.getUniformLocation(this.program,`${i}[${e.startIndex}]`);if(!m)throw new Error(`${i}[${e.startIndex}] not found in fragment shader. Did you pass an invalid startIndex?`);f=m}this.gl[d+"v"](s.location,c)}else{if(Array.isArray(r)||(r=[r]),r.length!==s.length)throw new Error(`Invalid uniform value length: ${r.length}. Expected ${s.length}.`);this.gl[d](s.location,...r)}}),this.hooks.get("updateUniforms")?.forEach(i=>i.call(this,...arguments))}createTexture(t,e,i){let{width:r,height:s}=e,d=e.history?.depth??0,l=this.gl.createTexture();if(!l)throw new Error("Failed to create texture");let c=i?.unitIndex;if(typeof c!="number")try{c=this.reserveTextureUnit(t)}catch(T){throw this.gl.deleteTexture(l),T}let f=d>0,m=f?this.gl.TEXTURE_2D_ARRAY:this.gl.TEXTURE_2D;if(this.gl.activeTexture(this.gl.TEXTURE0+c),this.gl.bindTexture(m,l),this.gl.texParameteri(m,this.gl.TEXTURE_WRAP_S,i?.wrapS??this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(m,this.gl.TEXTURE_WRAP_T,i?.wrapT??this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(m,this.gl.TEXTURE_MIN_FILTER,i?.minFilter??this.gl.LINEAR),this.gl.texParameteri(m,this.gl.TEXTURE_MAG_FILTER,i?.magFilter??this.gl.LINEAR),f){let T=i?.type??this.gl.UNSIGNED_BYTE,_=i?.internalFormat??(T===this.gl.FLOAT?this.gl.RGBA32F:this.gl.RGBA8);this.gl.texStorage3D(m,1,_,r,s,d)}return{texture:l,unitIndex:c}}_initializeTexture(t,e,i){if(this.textures.has(t))throw new Error(`Texture '${U(t)}' is already initialized.`);let{history:r=0,...s}=i??{},{width:d,height:l}=q(e);if(!d||!l)throw new Error("Texture source must have valid dimensions");let c={width:d,height:l};r>0&&(c.history={depth:r,writeIndex:0});let{texture:f,unitIndex:m}=this.createTexture(t,c,s),T={texture:f,unitIndex:m,...c,options:s};r>0&&(this.initializeUniform(`${U(t)}FrameOffset`,"int",0),this.clearHistoryTextureLayers(T)),this.textures.set(t,T),this.updateTexture(t,e);let _=this.gl.getUniformLocation(this.program,U(t));_&&this.gl.uniform1i(_,m)}initializeTexture(t,e,i){this._initializeTexture(t,e,i),this.hooks.get("initializeTexture")?.forEach(r=>r.call(this,...arguments))}updateTextures(t){this.hooks.get("updateTextures")?.forEach(e=>e.call(this,...arguments)),Object.entries(t).forEach(([e,i])=>{this.updateTexture(e,i)})}updateTexture(t,e){let i=this.textures.get(t);if(!i)throw new Error(`Texture '${U(t)}' is not initialized.`);if(e instanceof WebGLTexture){this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,e);return}let{width:r,height:s}=q(e);if(!r||!s)return;let d="isPartial"in e&&e.isPartial;if(!d&&(i.width!==r||i.height!==s)){this.gl.deleteTexture(i.texture),i.width=r,i.height=s;let{texture:m}=this.createTexture(t,i,{...i.options,unitIndex:i.unitIndex});i.texture=m,i.history&&(i.history.writeIndex=0,this.clearHistoryTextureLayers(i))}let l="data"in e&&e.data,c=!l&&!i.options?.preserveY,f=this.gl.getParameter(this.gl.UNPACK_FLIP_Y_WEBGL);if(i.history){let m=t===Y;this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D_ARRAY,i.texture),m?this.gl.copyTexSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,i.history.writeIndex,0,0,r,s):(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c),this.gl.texSubImage3D(this.gl.TEXTURE_2D_ARRAY,0,0,0,i.history.writeIndex,r,s,1,i.options?.format??this.gl.RGBA,i.options?.type??this.gl.UNSIGNED_BYTE,e.data??e),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,f));let T=`${U(t)}FrameOffset`;this.updateUniforms({[T]:i.history.writeIndex}),i.history.writeIndex=(i.history.writeIndex+1)%i.history.depth}else{this.gl.activeTexture(this.gl.TEXTURE0+i.unitIndex),this.gl.bindTexture(this.gl.TEXTURE_2D,i.texture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,c);let m=i.options?.format??this.gl.RGBA,T=i.options?.type??this.gl.UNSIGNED_BYTE;if(d)this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,e.x??0,e.y??0,r,s,m,T,e.data);else{let _=i.options?.internalFormat??(l?T===this.gl.FLOAT?this.gl.RGBA32F:this.gl.RGBA8:this.gl.RGBA);this.gl.texImage2D(this.gl.TEXTURE_2D,0,_,r,s,0,m,T,e.data??e)}this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,f)}}draw(t=!0){let e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.vertexAttribPointer(this.aPositionLocation,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.aPositionLocation),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t&&e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLES,0,6)}step(t){this.uniforms.has("u_time")&&this.updateUniforms({u_time:t}),this.uniforms.has("u_frame")&&this.updateUniforms({u_frame:this.frame}),this.draw(),this.textures.get(Y)&&this.updateTexture(Y,this.canvas),this.hooks.get("step")?.forEach(e=>e.call(this,t,this.frame)),++this.frame}play(t){this.pause();let e=i=>{i=(i-this.startTime)/1e3,this.step(i),this.animationFrameId=requestAnimationFrame(e),t&&t(i,this.frame)};this.animationFrameId=requestAnimationFrame(e)}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}reset(){this.frame=0,this.startTime=performance.now(),this.textures.forEach(t=>{t.history&&(t.history.writeIndex=0,this.clearHistoryTextureLayers(t))}),this.hooks.get("reset")?.forEach(t=>t.call(this))}destroy(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resolutionObserver.disconnect(),this.resizeObserver.disconnect(),this.canvas instanceof HTMLCanvasElement&&this.eventListeners.forEach((t,e)=>{this.canvas.removeEventListener(e,t)}),this.program&&this.gl.deleteProgram(this.program),this.textures.forEach(t=>{this.gl.deleteTexture(t.texture)}),this.textureUnitPool.free=[],this.textureUnitPool.next=0,this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this.hooks.get("destroy")?.forEach(t=>t.call(this)),this.isInternalCanvas&&this.canvas instanceof HTMLCanvasElement&&this.canvas.remove()}},Z=X;var L=33,dt=6,p=L+dt,o={LEFT_EYE:2,RIGHT_EYE:5,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32,BODY_CENTER:L,LEFT_HAND_CENTER:L+1,RIGHT_HAND_CENTER:L+2,LEFT_FOOT_CENTER:L+3,RIGHT_FOOT_CENTER:L+4,TORSO_CENTER:L+5},gt=Array.from({length:L},(a,t)=>t),ft=[o.LEFT_WRIST,o.LEFT_PINKY,o.LEFT_THUMB,o.LEFT_INDEX],Tt=[o.RIGHT_WRIST,o.RIGHT_PINKY,o.RIGHT_THUMB,o.RIGHT_INDEX],Et=[o.LEFT_ANKLE,o.LEFT_HEEL,o.LEFT_FOOT_INDEX],pt=[o.RIGHT_ANKLE,o.RIGHT_HEEL,o.RIGHT_FOOT_INDEX],_t=[o.LEFT_SHOULDER,o.RIGHT_SHOULDER,o.LEFT_HIP,o.RIGHT_HIP],J={data:new Uint8Array(4),width:1,height:1};function xt(a){let{textureName:t,options:e}=a,i="https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task";return function(r,s){let{injectGLSL:d,gl:l}=s,c=null,f=null,m=-1,T="VIDEO",_=new Map,W=e?.maxPoses??1,b=512,$=0,n=null,K=new OffscreenCanvas(1,1),E=null;async function Q(){try{let{FilesetResolver:u,PoseLandmarker:h}=await import("@mediapipe/tasks-vision");f=await u.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),c=await h.createFromOptions(f,{baseOptions:{modelAssetPath:e?.modelPath||i,delegate:"GPU"},canvas:K,runningMode:T,numPoses:e?.maxPoses??1,minPoseDetectionConfidence:e?.minPoseDetectionConfidence??.5,minPosePresenceConfidence:e?.minPosePresenceConfidence??.5,minTrackingConfidence:e?.minTrackingConfidence??.5,outputSegmentationMasks:!0})}catch(u){throw console.error("[Pose Plugin] Failed to initialize:",u),u}}function S(u,h,v){let x=1/0,g=-1/0,D=1/0,I=-1/0,y=0,A=0;for(let N of v){let R=(h*p+N)*4,P=u[R],F=u[R+1];x=Math.min(x,P),g=Math.max(g,P),D=Math.min(D,F),I=Math.max(I,F),y+=u[R+2],A+=u[R+3]}let w=(x+g)/2,O=(D+I)/2,H=y/v.length,C=A/v.length;return[w,O,H,C]}function tt(u){if(!(!u||u.length===0||!E)){for(let h=0;h<u.length;++h){let v=u[h];E.updateTextures({u_mask:v.getAsWebGLTexture()}),E.updateUniforms({u_poseIndex:(h+1)/W}),E.draw(h===0)}r.updateTextures({u_poseMask:K})}}function et(u){if(!n)return;let h=u.length,v=h*p;for(let g=0;g<h;++g){let D=u[g];for(let G=0;G<L;++G){let k=D[G],B=(g*p+G)*4;n[B]=k.x,n[B+1]=1-k.y,n[B+2]=k.z??0,n[B+3]=k.visibility??1}let I=S(n,g,gt),y=(g*p+o.BODY_CENTER)*4;n[y]=I[0],n[y+1]=I[1],n[y+2]=I[2],n[y+3]=I[3];let A=S(n,g,ft),w=(g*p+o.LEFT_HAND_CENTER)*4;n[w]=A[0],n[w+1]=A[1],n[w+2]=A[2],n[w+3]=A[3];let O=S(n,g,Tt),H=(g*p+o.RIGHT_HAND_CENTER)*4;n[H]=O[0],n[H+1]=O[1],n[H+2]=O[2],n[H+3]=O[3];let C=S(n,g,Et),N=(g*p+o.LEFT_FOOT_CENTER)*4;n[N]=C[0],n[N+1]=C[1],n[N+2]=C[2],n[N+3]=C[3];let R=S(n,g,pt),P=(g*p+o.RIGHT_FOOT_CENTER)*4;n[P]=R[0],n[P+1]=R[1],n[P+2]=R[2],n[P+3]=R[3];let F=S(n,g,_t),M=(g*p+o.TORSO_CENTER)*4;n[M]=F[0],n[M+1]=F[1],n[M+2]=F[2],n[M+3]=F[3]}let x=Math.ceil(v/b);r.updateTextures({u_poseLandmarksTex:{data:n,width:b,height:x,isPartial:!0}})}function V(u){if(!u.landmarks||!n)return;E||(E=new Z(`#version 300 es
					precision mediump float;
					in vec2 v_uv;
					out vec4 outColor;
					uniform sampler2D u_mask;
					uniform float u_poseIndex;
					void main() {
						ivec2 texCoord = ivec2(v_uv * vec2(textureSize(u_mask, 0)));
						float confidence = texelFetch(u_mask, texCoord, 0).r;
						if (confidence < 0.01) discard;
						outColor = vec4(1.0, confidence, u_poseIndex, 1.0);
					}`,{canvas:K}),E.initializeTexture("u_mask",J),E.initializeUniform("u_poseIndex","float",0));let h=u.landmarks.length;et(u.landmarks),tt(u.segmentationMasks),r.updateUniforms({u_nPoses:h}),e?.onResults?.(u)}r.registerHook("init",async()=>{r.initializeTexture("u_poseMask",J,{preserveY:!0,minFilter:l.NEAREST,magFilter:l.NEAREST}),r.initializeUniform("u_maxPoses","int",W),r.initializeUniform("u_nPoses","int",0);let u=W*p;$=Math.ceil(u/b);let h=b*$*4;n=new Float32Array(h),r.initializeTexture("u_poseLandmarksTex",{data:n,width:b,height:$},{internalFormat:l.RGBA32F,type:l.FLOAT,minFilter:l.NEAREST,magFilter:l.NEAREST}),await Q()}),r.registerHook("updateTextures",async u=>{let h=u[t];if(!(!h||(_.get(t)!==h&&(m=-1),_.set(t,h),!c)))try{let x=h instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(T!==x&&(T=x,await c.setOptions({runningMode:T})),h instanceof HTMLVideoElement){if(h.videoWidth===0||h.videoHeight===0||h.readyState<2)return;if(h.currentTime!==m){m=h.currentTime;let g=c.detectForVideo(h,performance.now());V(g)}}else if(h instanceof HTMLImageElement||h instanceof HTMLCanvasElement){if(h.width===0||h.height===0)return;let g=c.detect(h);V(g)}}catch(x){console.error("[Pose Plugin] Detection error:",x)}}),r.registerHook("destroy",()=>{c&&(c.close(),c=null),E&&(E.destroy(),E=null),f=null,_.clear(),n=null}),d(`
uniform int u_maxPoses;
uniform int u_nPoses;
uniform sampler2D u_poseLandmarksTex;
uniform sampler2D u_poseMask;

#define POSE_LANDMARK_LEFT_EYE ${o.LEFT_EYE}
#define POSE_LANDMARK_RIGHT_EYE ${o.RIGHT_EYE}
#define POSE_LANDMARK_LEFT_SHOULDER ${o.LEFT_SHOULDER}
#define POSE_LANDMARK_RIGHT_SHOULDER ${o.RIGHT_SHOULDER}
#define POSE_LANDMARK_LEFT_ELBOW ${o.LEFT_ELBOW}
#define POSE_LANDMARK_RIGHT_ELBOW ${o.RIGHT_ELBOW}
#define POSE_LANDMARK_LEFT_HIP ${o.LEFT_HIP}
#define POSE_LANDMARK_RIGHT_HIP ${o.RIGHT_HIP}
#define POSE_LANDMARK_LEFT_KNEE ${o.LEFT_KNEE}
#define POSE_LANDMARK_RIGHT_KNEE ${o.RIGHT_KNEE}
#define POSE_LANDMARK_BODY_CENTER ${o.BODY_CENTER}
#define POSE_LANDMARK_LEFT_HAND_CENTER ${o.LEFT_HAND_CENTER}
#define POSE_LANDMARK_RIGHT_HAND_CENTER ${o.RIGHT_HAND_CENTER}
#define POSE_LANDMARK_LEFT_FOOT_CENTER ${o.LEFT_FOOT_CENTER}
#define POSE_LANDMARK_RIGHT_FOOT_CENTER ${o.RIGHT_FOOT_CENTER}
#define POSE_LANDMARK_TORSO_CENTER ${o.TORSO_CENTER}

vec4 poseLandmark(int poseIndex, int landmarkIndex) {
	int i = poseIndex * ${p} + landmarkIndex;
	int x = i % ${b};
	int y = i / ${b};
	return texelFetch(u_poseLandmarksTex, ivec2(x, y), 0);
}

vec2 poseAt(vec2 pos) {
	vec4 mask = texture(u_poseMask, pos);
	float poseIndex = floor(mask.b * float(u_maxPoses) + 0.5) - 1.0;
	return vec2(mask.g, poseIndex);
}
	
float inPose(vec2 pos) {
	float pose = poseAt(pos).x;
	return step(0.0, pose);
}`)}}var Rt=xt;
//# sourceMappingURL=pose.js.map