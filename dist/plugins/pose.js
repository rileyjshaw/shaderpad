"use strict";var I=Object.create;var h=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var H=(o,r)=>{for(var i in r)h(o,i,{get:r[i],enumerable:!0})},_=(o,r,i,d)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of D(r))!z.call(o,a)&&a!==i&&h(o,a,{get:()=>r[a],enumerable:!(d=O(r,a))||d.enumerable});return o};var U=(o,r,i)=>(i=o!=null?I(N(o)):{},_(r||!o||!o.__esModule?h(i,"default",{value:o,enumerable:!0}):i,o)),F=o=>_(h({},"__esModule",{value:!0}),o);var A={};H(A,{default:()=>V});module.exports=F(A);var P=33;function R(o){let{textureName:r,options:i}=o,d="https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task";return function(a,y){let{injectGLSL:T}=y,u=null,k=null,C=-1,w=new Map,p=i?.maxPoses??1,M=512,b=512,t=document.createElement("canvas");t.width=M,t.height=b;let c=t.getContext("2d");c.globalCompositeOperation="lighten";let x=[];async function v(){try{let{FilesetResolver:s,PoseLandmarker:m}=await import("@mediapipe/tasks-vision");k=await s.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),x.push(...m.POSE_CONNECTIONS),u=await m.createFromOptions(k,{baseOptions:{modelAssetPath:i?.modelPath||d},runningMode:"VIDEO",numPoses:i?.maxPoses??1,minPoseDetectionConfidence:i?.minPoseDetectionConfidence??.5,minPosePresenceConfidence:i?.minPosePresenceConfidence??.5,minTrackingConfidence:i?.minTrackingConfidence??.5,outputSegmentationMasks:i?.outputSegmentationMasks??!1})}catch(s){throw console.error("[Pose Plugin] Failed to initialize Pose Landmarker:",s),s}}async function S(s,m){if(!u){console.warn("[Pose Plugin] Cannot update mask: poseLandmarker missing");return}try{if(c.clearRect(0,0,t.width,t.height),m&&m.length>0&&m.forEach(e=>{if(e.width!==t.width||e.height!==t.height){let n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),c.drawImage(n,0,0,t.width,t.height)}else c.putImageData(e,0,0)}),x.length){let e=Math.max(2,t.width/256);c.lineWidth=e,c.lineCap="round",c.strokeStyle="#00f",s.forEach(n=>{x.forEach(({start:l,end:E})=>{let f=n[l],g=n[E];!f||!g||(f.visibility??1)<.3||(g.visibility??1)<.3||(c.beginPath(),c.moveTo(f.x*t.width,f.y*t.height),c.lineTo(g.x*t.width,g.y*t.height),c.stroke())})})}a.updateTextures({u_poseMask:t})}catch(e){console.error("[Pose Plugin] Failed to generate mask texture:",e)}}function L(s){if(!s.landmarks)return;S(s.landmarks,s.segmentationMasks).catch(n=>{console.warn("[Pose Plugin] Mask texture update error:",n)});let m=s.landmarks.length,e={u_nPoses:m};m&&(e.u_poseLandmarks=s.landmarks.flatMap(n=>n.map(l=>[l.x,1-l.y]))),a.updateUniforms(e)}a.registerHook("init",async()=>{a.initializeTexture("u_poseMask",t),a.initializeUniform("u_maxPoses","int",p),a.initializeUniform("u_nPoses","int",0);let s=Array.from({length:p*P},()=>[.5,.5]);a.initializeUniform("u_poseLandmarks","float",s,{arrayLength:p*P}),await v()}),a.registerHook("updateTextures",s=>{Object.entries(s).forEach(([m,e])=>{if(m===r&&(w.set(m,e),!!u))try{if(e instanceof HTMLVideoElement){if(e.currentTime!==C){C=e.currentTime;let n=performance.now(),l=u.detectForVideo(e,n);L(l)}}else if(e instanceof HTMLImageElement){let n=u.detect(e);L(n)}}catch(n){console.error("[Pose Plugin] Pose detection error:",n)}})}),a.registerHook("destroy",()=>{u&&(u.close(),u=null),k=null,w.clear(),t.remove()}),T(`
uniform int u_maxPoses;
uniform int u_nPoses;
uniform vec2 u_poseLandmarks[${p*P}];
uniform sampler2D u_poseMask;
vec2 poseLandmark(int poseIndex, int landmarkIndex) {
	return u_poseLandmarks[poseIndex * ${P} + landmarkIndex];
}
float getBody(vec2 pos) { return texture(u_poseMask, pos).g; }
float getSkeleton(vec2 pos) { return texture(u_poseMask, pos).b; }`)}}var V=R;
//# sourceMappingURL=pose.js.map