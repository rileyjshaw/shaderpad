"use strict";var P=Object.create;var y=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var Y=(t,a)=>{for(var i in a)y(t,i,{get:a[i],enumerable:!0})},v=(t,a,i,p)=>{if(a&&typeof a=="object"||typeof a=="function")for(let o of G(a))!B.call(t,o)&&o!==i&&y(t,o,{get:()=>a[o],enumerable:!(p=K(a,o))||p.enumerable});return t};var $=(t,a,i)=>(i=t!=null?P(X(t)):{},v(a||!t||!t.__esModule?y(i,"default",{value:t,enumerable:!0}):i,t)),j=t=>v(y({},"__esModule",{value:!0}),t);var nn={};Y(nn,{default:()=>Q});module.exports=j(nn);var W=21,Z=1,k=W+Z,q=[0,0,5,9,13,17];function J(t){let{textureName:a,options:i}=t,p="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(o,w){let{injectGLSL:b,gl:T}=w,c=null,A=null,_=-1,L="VIDEO",C=new Map,I=i?.maxHands??2,l=512,R=0,r=null;async function D(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");A=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),c=await n.createFromOptions(A,{baseOptions:{modelAssetPath:i?.modelPath||p},runningMode:L,numHands:i?.maxHands??2,minHandDetectionConfidence:i?.minHandDetectionConfidence??.5,minHandPresenceConfidence:i?.minHandPresenceConfidence??.5,minTrackingConfidence:i?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function F(e,n,h){let d=1/0,s=-1/0,u=1/0,m=-1/0,f=0,x=0;for(let U of h){let M=(n*k+U)*4,N=e[M],S=e[M+1];d=Math.min(d,N),s=Math.max(s,N),u=Math.min(u,S),m=Math.max(m,S),f+=e[M+2],x+=e[M+3]}let H=(d+s)/2,g=(u+m)/2,V=f/h.length,z=x/h.length;return[H,g,V,z]}function O(e){if(!r)return;let n=e.length,h=n*k;for(let s=0;s<n;++s){let u=e[s];for(let x=0;x<21;++x){let H=u[x],g=(s*k+x)*4;r[g]=H.x,r[g+1]=1-H.y,r[g+2]=H.z??0,r[g+3]=H.visibility??1}let m=F(r,s,q),f=(s*k+21)*4;r[f]=m[0],r[f+1]=m[1],r[f+2]=m[2],r[f+3]=m[3]}let d=Math.ceil(h/l);o.updateTextures({u_handLandmarksTex:{data:r,width:l,height:d}})}function E(e){if(!e.landmarks||!r)return;let n=e.landmarks.length;O(e.landmarks),o.updateUniforms({u_nHands:n}),i?.onResults?.(e)}o.registerHook("init",async()=>{o.initializeUniform("u_maxHands","int",I),o.initializeUniform("u_nHands","int",0);let e=I*k;R=Math.ceil(e/l);let n=l*R*4;r=new Float32Array(n),o.initializeTexture("u_handLandmarksTex",{data:r,width:l,height:R},{internalFormat:T.RGBA32F,type:T.FLOAT,minFilter:T.NEAREST,magFilter:T.NEAREST}),await D()}),o.registerHook("updateTextures",async e=>{let n=e[a];if(!(!n||(C.get(a)!==n&&(_=-1),C.set(a,n),!c)))try{let d=n instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(L!==d&&(L=d,await c.setOptions({runningMode:L})),n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==_){_=n.currentTime;let s=performance.now(),u=c.detectForVideo(n,s);E(u)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let s=c.detect(n);E(s)}}catch(d){console.warn("Hand detection error:",d)}}),o.registerHook("destroy",()=>{c&&(c.close(),c=null),A=null,C.clear(),r=null}),b(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;
vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${k} + landmarkIndex;
	int x = i % ${l};
	int y = i / ${l};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}`)}}var Q=J;
//# sourceMappingURL=hands.js.map