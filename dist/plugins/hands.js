"use strict";var Y=Object.create;var C=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var q=(e,t)=>{for(var i in t)C(e,i,{get:t[i],enumerable:!0})},z=(e,t,i,L)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of j(t))!Z.call(e,r)&&r!==i&&C(e,r,{get:()=>t[r],enumerable:!(L=$(t,r))||L.enumerable});return e};var J=(e,t,i)=>(i=e!=null?Y(W(e)):{},z(t||!e||!e.__esModule?C(i,"default",{value:e,enumerable:!0}):i,e)),Q=e=>z(C({},"__esModule",{value:!0}),e);var rn={};q(rn,{default:()=>an});module.exports=Q(rn);var w=21,nn=1,g=w+nn,en=[0,0,5,9,13,17];function tn(e){let{textureName:t,options:i}=e,L="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(r,U){let{injectGLSL:V,gl:y,emitHook:R}=U,m=null,A=null,_=-1,M="VIDEO",N=new Map,E=i?.maxHands??2,c=512,S=0,o=null;async function G(){try{let{FilesetResolver:n,HandLandmarker:a}=await import("@mediapipe/tasks-vision");A=await n.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),m=await a.createFromOptions(A,{baseOptions:{modelAssetPath:i?.modelPath||L,delegate:"GPU"},canvas:new OffscreenCanvas(1,1),runningMode:M,numHands:i?.maxHands??2,minHandDetectionConfidence:i?.minHandDetectionConfidence??.5,minHandPresenceConfidence:i?.minHandPresenceConfidence??.5,minTrackingConfidence:i?.minTrackingConfidence??.5})}catch(n){throw console.error("[Hands Plugin] Failed to initialize MediaPipe:",n),n}}let v=G();function K(n,a,l){let s=1/0,H=-1/0,d=1/0,T=-1/0,p=0,u=0;for(let B of l){let I=(a*g+B)*4,F=n[I],P=n[I+1];s=Math.min(s,F),H=Math.max(H,F),d=Math.min(d,P),T=Math.max(T,P),p+=n[I+2],u+=n[I+3]}let f=(s+H)/2,x=(d+T)/2,k=p/l.length,h=u/l.length;return[f,x,k,h]}function X(n,a){if(!o)return;let l=n.length,s=l*g;for(let d=0;d<l;++d){let T=n[d],p=a[d]?.[0]?.categoryName==="Right";for(let x=0;x<w;++x){let k=T[x],h=(d*g+x)*4;o[h]=k.x,o[h+1]=1-k.y,o[h+2]=k.z??0,o[h+3]=p?1:0}let u=K(o,d,en),f=(d*g+w)*4;o[f]=u[0],o[f+1]=u[1],o[f+2]=u[2],o[f+3]=p?1:0}let H=Math.ceil(s/c);r.updateTextures({u_handLandmarksTex:{data:o,width:c,height:H,isPartial:!0}})}function D(n){if(!n.landmarks||!o)return;let a=n.landmarks.length;X(n.landmarks,n.handedness),r.updateUniforms({u_nHands:a}),R("hands:result",n)}r.on("init",async()=>{r.initializeUniform("u_maxHands","int",E),r.initializeUniform("u_nHands","int",0);let n=E*g;S=Math.ceil(n/c);let a=c*S*4;o=new Float32Array(a),r.initializeTexture("u_handLandmarksTex",{data:o,width:c,height:S},{internalFormat:y.RGBA32F,type:y.FLOAT,minFilter:y.NEAREST,magFilter:y.NEAREST}),await v,R("hands:ready")}),r.on("initializeTexture",(n,a)=>{n===t&&b(a)}),r.on("updateTextures",n=>{let a=n[t];a&&b(a)});let O=0;async function b(n){let a=++O;if(await v,a!==O||!m)return;N.get(t)!==n&&(_=-1),N.set(t,n);try{let s=n instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(M!==s&&(M=s,await m.setOptions({runningMode:M})),n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;n.currentTime!==_&&(_=n.currentTime,D(m.detectForVideo(n,performance.now())))}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;D(m.detect(n))}}catch(s){console.error("[Hands Plugin] Detection error:",s)}}r.on("destroy",()=>{m&&(m.close(),m=null),A=null,N.clear(),o=null}),V(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;

vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${g} + landmarkIndex;
	int x = i % ${c};
	int y = i / ${c};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}

float isRightHand(int handIndex) {
	return handLandmark(handIndex, 0).w;
}

float isLeftHand(int handIndex) {
	return 1.0 - handLandmark(handIndex, 0).w;
}`)}}var an=tn;
//# sourceMappingURL=hands.js.map