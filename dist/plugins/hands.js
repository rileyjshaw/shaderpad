"use strict";var G=Object.create;var I=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var $=(a,i)=>{for(var t in i)I(a,t,{get:i[t],enumerable:!0})},O=(a,i,t,L)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of X(i))!Y.call(a,o)&&o!==t&&I(a,o,{get:()=>i[o],enumerable:!(L=K(i,o))||L.enumerable});return a};var j=(a,i,t)=>(t=a!=null?G(B(a)):{},O(i||!a||!a.__esModule?I(t,"default",{value:a,enumerable:!0}):t,a)),W=a=>O(I({},"__esModule",{value:!0}),a);var nn={};$(nn,{default:()=>Q});module.exports=W(nn);var v=21,Z=1,H=v+Z,q=[0,0,5,9,13,17];function J(a){let{textureName:i,options:t}=a,L="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(o,b){let{injectGLSL:F,gl:y}=b,m=null,A=null,C=-1,M="VIDEO",_=new Map,w=t?.maxHands??2,l=512,N=0,r=null;async function P(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");A=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),m=await n.createFromOptions(A,{baseOptions:{modelAssetPath:t?.modelPath||L,delegate:"GPU"},canvas:new OffscreenCanvas(1,1),runningMode:M,numHands:t?.maxHands??2,minHandDetectionConfidence:t?.minHandDetectionConfidence??.5,minHandPresenceConfidence:t?.minHandPresenceConfidence??.5,minTrackingConfidence:t?.minTrackingConfidence??.5})}catch(e){throw console.error("[Hands Plugin] Failed to initialize:",e),e}}function U(e,n,u){let s=1/0,c=-1/0,d=1/0,k=-1/0,T=0,f=0;for(let z of u){let R=(n*H+z)*4,S=e[R],D=e[R+1];s=Math.min(s,S),c=Math.max(c,S),d=Math.min(d,D),k=Math.max(k,D),T+=e[R+2],f+=e[R+3]}let h=(s+c)/2,x=(d+k)/2,p=T/u.length,g=f/u.length;return[h,x,p,g]}function V(e,n){if(!r)return;let u=e.length,s=u*H;for(let d=0;d<u;++d){let k=e[d],T=n[d]?.[0]?.categoryName==="Right";for(let x=0;x<v;++x){let p=k[x],g=(d*H+x)*4;r[g]=p.x,r[g+1]=1-p.y,r[g+2]=p.z??0,r[g+3]=T?1:0}let f=U(r,d,q),h=(d*H+v)*4;r[h]=f[0],r[h+1]=f[1],r[h+2]=f[2],r[h+3]=T?1:0}let c=Math.ceil(s/l);o.updateTextures({u_handLandmarksTex:{data:r,width:l,height:c,isPartial:!0}})}function E(e){if(!e.landmarks||!r)return;let n=e.landmarks.length;V(e.landmarks,e.handedness),o.updateUniforms({u_nHands:n}),t?.onResults?.(e)}o.registerHook("init",async()=>{o.initializeUniform("u_maxHands","int",w),o.initializeUniform("u_nHands","int",0);let e=w*H;N=Math.ceil(e/l);let n=l*N*4;r=new Float32Array(n),o.initializeTexture("u_handLandmarksTex",{data:r,width:l,height:N},{internalFormat:y.RGBA32F,type:y.FLOAT,minFilter:y.NEAREST,magFilter:y.NEAREST}),await P(),t?.onReady?.()}),o.registerHook("updateTextures",async e=>{let n=e[i];if(!(!n||(_.get(i)!==n&&(C=-1),_.set(i,n),!m)))try{let s=n instanceof HTMLVideoElement?"VIDEO":"IMAGE";if(M!==s&&(M=s,await m.setOptions({runningMode:M})),n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==C){C=n.currentTime;let c=m.detectForVideo(n,performance.now());E(c)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let c=m.detect(n);E(c)}}catch(s){console.error("[Hands Plugin] Detection error:",s)}}),o.registerHook("destroy",()=>{m&&(m.close(),m=null),A=null,_.clear(),r=null}),F(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;

vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${H} + landmarkIndex;
	int x = i % ${l};
	int y = i / ${l};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}

float isRightHand(int handIndex) {
	return handLandmark(handIndex, 0).w;
}

float isLeftHand(int handIndex) {
	return 1.0 - handLandmark(handIndex, 0).w;
}`)}}var Q=J;
//# sourceMappingURL=hands.js.map