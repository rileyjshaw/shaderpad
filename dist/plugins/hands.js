"use strict";var G=Object.create;var S=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var q=(n,o)=>{for(var a in o)S(n,a,{get:o[a],enumerable:!0})},F=(n,o,a,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let t of W(o))!X.call(n,t)&&t!==a&&S(n,t,{get:()=>o[t],enumerable:!(s=B(o,t))||s.enumerable});return n};var R=(n,o,a)=>(a=n!=null?G(j(n)):{},F(o||!n||!n.__esModule?S(a,"default",{value:n,enumerable:!0}):a,n)),Y=n=>F(S({},"__esModule",{value:!0}),n);var ae={};q(ae,{default:()=>te});module.exports=Y(ae);var re={data:new Uint8Array(4),width:1,height:1};function O(n){return n instanceof HTMLVideoElement||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas}function w(n){return JSON.stringify(n,Object.keys(n).sort())}function V(n,o,a,s,t=0){let i=1/0,l=-1/0,m=1/0,d=-1/0,u=0,h=0;for(let x of a){let f=(t+o*s+x)*4,L=n[f],e=n[f+1];i=Math.min(i,L),l=Math.max(l,L),m=Math.min(m,e),d=Math.max(d,e),u+=n[f+2],h+=n[f+3]}return[(i+l)/2,(m+d)/2,u/a.length,h/a.length]}var D=null;function U(){return D||(D=import("@mediapipe/tasks-vision").then(({FilesetResolver:n})=>n.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22-rc.20250304/wasm"))),D}function z(n){return{historyParams:n?", framesAgo":"",fn:n?(s,t,i,l)=>{let m=i.replace(/\w+ /g,""),d=i?`${i}, int framesAgo`:"int framesAgo",u=m?`${m}, 0`:"0";return`${s} ${t}(${d}) {
${l}
}
${s} ${t}(${i}) { return ${t}(${u}); }`}:(s,t,i,l)=>`${s} ${t}(${i}) {
${l}
}`}}var $=21,J=1,H=$+J,Z=[0,0,5,9,13,17],p=512,k=1,Q={modelPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",maxHands:2,minHandDetectionConfidence:.5,minHandPresenceConfidence:.5,minTrackingConfidence:.5},b=new Map;function ee(n,o,a){let s=n.landmarks.data,t=o.length;s[0]=t;for(let i=0;i<t;++i){let l=o[i],m=a[i]?.[0]?.categoryName==="Right";for(let h=0;h<$;++h){let x=l[h],f=(k+i*H+h)*4;s[f]=x.x,s[f+1]=1-x.y,s[f+2]=x.z??0,s[f+3]=m?1:0}let d=V(s,i,Z,H,k),u=(k+i*H+$)*4;s[u]=d[0],s[u+1]=d[1],s[u+2]=d[2],s[u+3]=m?1:0}n.state.nHands=t}function ne(n){let{textureName:o,options:{history:a,...s}={}}=n,t={...Q,...s},i=w({...t,textureName:o}),l=t.maxHands*H+k,m=Math.ceil(l/p);return function(d,u){let{injectGLSL:h,emitHook:x}=u,L=b.get(i)?.landmarks.data??new Float32Array(p*m*4),e=null,C=!1;function y(){if(!e)return;let{nHands:r}=e.state,c=r*H+k,g=Math.ceil(c/p);d.updateTextures({u_handLandmarksTex:{data:e.landmarks.data,width:p,height:g,isPartial:!0}},{skipHistoryWrite:C}),d.updateUniforms({u_nHands:r}),x("hands:result",e.state.result)}async function K(){if(b.has(i))e=b.get(i);else{let[r,{HandLandmarker:c}]=await Promise.all([U(),import("@mediapipe/tasks-vision")]),g=new OffscreenCanvas(1,1);e={landmarker:await c.createFromOptions(r,{baseOptions:{modelAssetPath:t.modelPath,delegate:"GPU"},canvas:g,runningMode:"VIDEO",numHands:t.maxHands,minHandDetectionConfidence:t.minHandDetectionConfidence,minHandPresenceConfidence:t.minHandPresenceConfidence,minTrackingConfidence:t.minTrackingConfidence}),canvas:g,subscribers:new Map,maxHands:t.maxHands,state:{runningMode:"VIDEO",source:null,videoTime:-1,resultTimestamp:0,result:null,pending:Promise.resolve(),nHands:0},landmarks:{data:L,textureHeight:m}},b.set(i,e)}e.subscribers.set(y,!1)}let I=K();d.on("init",()=>{d.initializeUniform("u_maxHands","int",t.maxHands),d.initializeUniform("u_nHands","int",0),d.initializeTexture("u_handLandmarksTex",{data:L,width:p,height:m},{internalFormat:"RGBA32F",type:"FLOAT",minFilter:"NEAREST",magFilter:"NEAREST",history:a}),I.then(()=>x("hands:ready"))}),d.on("initializeTexture",(r,c)=>{r===o&&O(c)&&P(c)}),d.on("updateTextures",(r,c)=>{let g=r[o];O(g)&&(C=c?.skipHistoryWrite??!1,P(g))});let v=0;async function P(r){let c=performance.now(),g=++v;await I,e&&(e.state.pending=e.state.pending.then(async()=>{if(g!==v||!e)return;let A=r instanceof HTMLVideoElement?"VIDEO":"IMAGE";e.state.runningMode!==A&&(e.state.runningMode=A,await e.landmarker.setOptions({runningMode:A}));let _=!1;if(r!==e.state.source?(e.state.source=r,e.state.videoTime=-1,_=!0):r instanceof HTMLVideoElement?r.currentTime!==e.state.videoTime&&(e.state.videoTime=r.currentTime,_=!0):r instanceof HTMLImageElement||c-e.state.resultTimestamp>2&&(_=!0),_){let T;if(r instanceof HTMLVideoElement){if(r.videoWidth===0||r.videoHeight===0||r.readyState<2)return;T=e.landmarker.detectForVideo(r,c)}else{if(r.width===0||r.height===0)return;T=e.landmarker.detect(r)}if(T){e.state.resultTimestamp=c,e.state.result=T,ee(e,T.landmarks,T.handedness);for(let N of e.subscribers.keys())N(),e.subscribers.set(N,!0)}}else e.state.result&&!e.subscribers.get(y)&&(y(),e.subscribers.set(y,!0))}),await e.state.pending)}d.on("destroy",()=>{e&&(e.subscribers.delete(y),e.subscribers.size===0&&(e.landmarker.close(),b.delete(i))),e=null});let{fn:M,historyParams:E}=z(a);h(`
uniform int u_maxHands;
uniform int u_nHands;
uniform highp sampler2D${a?"Array":""} u_handLandmarksTex;${a?`
uniform int u_handLandmarksTexFrameOffset;`:""}

${M("int","nHandsAt","",a?`
	int layer = (u_handLandmarksTexFrameOffset - framesAgo + ${a}) % ${a};
	return int(texelFetch(u_handLandmarksTex, ivec3(0, 0, layer), 0).r + 0.5);`:`
	return int(texelFetch(u_handLandmarksTex, ivec2(0, 0), 0).r + 0.5);`)}
${M("vec4","handLandmark","int handIndex, int landmarkIndex",`int i = ${k} + handIndex * ${H} + landmarkIndex;
	int x = i % ${p};
	int y = i / ${p};${a?`
	int layer = (u_handLandmarksTexFrameOffset - framesAgo + ${a}) % ${a};
	return texelFetch(u_handLandmarksTex, ivec3(x, y, layer), 0);`:`
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);`}`)}
${M("float","isRightHand","int handIndex",`return handLandmark(handIndex, 0${E}).w;`)}
${M("float","isLeftHand","int handIndex",`return 1.0 - handLandmark(handIndex, 0${E}).w;`)}`)}}var te=ne;
//# sourceMappingURL=hands.js.map