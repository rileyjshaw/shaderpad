"use strict";var V=Object.create;var C=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var G=(n,i)=>{for(var s in i)C(n,s,{get:i[s],enumerable:!0})},A=(n,i,s,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of z(i))!B.call(n,r)&&r!==s&&C(n,r,{get:()=>i[r],enumerable:!(a=U(i,r))||a.enumerable});return n};var P=(n,i,s)=>(s=n!=null?V(K(n)):{},A(i||!n||!n.__esModule?C(s,"default",{value:n,enumerable:!0}):s,n)),j=n=>A(C({},"__esModule",{value:!0}),n);var Z={};G(Z,{default:()=>J});module.exports=j(Z);function S(n){return n instanceof HTMLVideoElement||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas}function N(n){return JSON.stringify(n,Object.keys(n).sort())}function R(n,i,s,a){let r=1/0,d=-1/0,u=1/0,o=-1/0,p=0,f=0;for(let c of s){let l=(i*a+c)*4,g=n[l],k=n[l+1];r=Math.min(r,g),d=Math.max(d,g),u=Math.min(u,k),o=Math.max(o,k),p+=n[l+2],f+=n[l+3]}return[(r+d)/2,(u+o)/2,p/s.length,f/s.length]}var I=null;function w(){return I||(I=import("@mediapipe/tasks-vision").then(({FilesetResolver:n})=>n.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22-rc.20250304/wasm"))),I}var y=21,$=1,T=y+$,X=[0,0,5,9,13,17],h=512,q={modelPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",maxHands:2,minHandDetectionConfidence:.5,minHandPresenceConfidence:.5,minTrackingConfidence:.5},b=new Map;function W(n,i,s){let a=n.landmarks.data,r=i.length;for(let d=0;d<r;++d){let u=i[d],o=s[d]?.[0]?.categoryName==="Right";for(let c=0;c<y;++c){let l=u[c],g=(d*T+c)*4;a[g]=l.x,a[g+1]=1-l.y,a[g+2]=l.z??0,a[g+3]=o?1:0}let p=R(a,d,X,T),f=(d*T+y)*4;a[f]=p[0],a[f+1]=p[1],a[f+2]=p[2],a[f+3]=o?1:0}n.state.nHands=r}function Y(n){let{textureName:i,options:s={}}=n,a={...q,...s},r=N({...a,textureName:i}),d=a.maxHands*T,u=Math.ceil(d/h);return function(o,p){let{injectGLSL:f,gl:c,emitHook:l}=p,k=b.get(r)?.landmarks.data??new Float32Array(h*u*4),e=null;function M(){if(!e)return;let{nHands:t}=e.state,m=t*T,x=Math.ceil(m/h);o.updateTextures({u_handLandmarksTex:{data:e.landmarks.data,width:h,height:x,isPartial:t!==a.maxHands}}),o.updateUniforms({u_nHands:t}),l("hands:result",e.state.result)}async function F(){if(b.has(r))e=b.get(r);else{let[t,{HandLandmarker:m}]=await Promise.all([w(),import("@mediapipe/tasks-vision")]),x=new OffscreenCanvas(1,1);e={landmarker:await m.createFromOptions(t,{baseOptions:{modelAssetPath:a.modelPath,delegate:"GPU"},canvas:x,runningMode:"VIDEO",numHands:a.maxHands,minHandDetectionConfidence:a.minHandDetectionConfidence,minHandPresenceConfidence:a.minHandPresenceConfidence,minTrackingConfidence:a.minTrackingConfidence}),canvas:x,subscribers:new Map,state:{runningMode:"VIDEO",source:null,videoTime:-1,resultTimestamp:0,result:null,pending:Promise.resolve(),nHands:0},landmarks:{data:k,textureHeight:u}},b.set(r,e)}e.subscribers.set(M,!1)}let _=F();o.on("init",()=>{o.initializeUniform("u_maxHands","int",a.maxHands),o.initializeUniform("u_nHands","int",0),o.initializeTexture("u_handLandmarksTex",{data:k,width:h,height:u},{internalFormat:c.RGBA32F,type:c.FLOAT,minFilter:c.NEAREST,magFilter:c.NEAREST}),_.then(()=>l("hands:ready"))}),o.on("initializeTexture",(t,m)=>{t===i&&S(m)&&E(m)}),o.on("updateTextures",t=>{let m=t[i];S(m)&&E(m)});let O=0;async function E(t){let m=performance.now(),x=++O;await _,e&&(e.state.pending=e.state.pending.then(async()=>{if(x!==O||!e)return;let L=t instanceof HTMLVideoElement?"VIDEO":"IMAGE";e.state.runningMode!==L&&(e.state.runningMode=L,await e.landmarker.setOptions({runningMode:L}));let D=!1;if(t!==e.state.source?(e.state.source=t,e.state.videoTime=-1,D=!0):t instanceof HTMLVideoElement?t.currentTime!==e.state.videoTime&&(e.state.videoTime=t.currentTime,D=!0):t instanceof HTMLImageElement||m-e.state.resultTimestamp>2&&(D=!0),D){let H;if(t instanceof HTMLVideoElement){if(t.videoWidth===0||t.videoHeight===0||t.readyState<2)return;H=e.landmarker.detectForVideo(t,m)}else{if(t.width===0||t.height===0)return;H=e.landmarker.detect(t)}if(H){e.state.resultTimestamp=m,e.state.result=H,W(e,H.landmarks,H.handedness);for(let v of e.subscribers.keys())v(),e.subscribers.set(v,!0)}}else e.state.result&&!e.subscribers.get(M)&&(M(),e.subscribers.set(M,!0))}),await e.state.pending)}o.on("destroy",()=>{e&&(e.subscribers.delete(M),e.subscribers.size===0&&(e.landmarker.close(),b.delete(r))),e=null}),f(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;

vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${T} + landmarkIndex;
	int x = i % ${h};
	int y = i / ${h};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}

float isRightHand(int handIndex) {
	return handLandmark(handIndex, 0).w;
}

float isLeftHand(int handIndex) {
	return 1.0 - handLandmark(handIndex, 0).w;
}`)}}var J=Y;
//# sourceMappingURL=hands.js.map