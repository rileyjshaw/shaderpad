"use strict";var _=Object.create;var u=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var w=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var v=(n,r)=>{for(var e in r)u(n,e,{get:r[e],enumerable:!0})},x=(n,r,e,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of N(r))!P.call(n,i)&&i!==e&&u(n,i,{get:()=>r[i],enumerable:!(c=b(r,i))||c.enumerable});return n};var z=(n,r,e)=>(e=n!=null?_(w(n)):{},x(r||!n||!n.__esModule?u(e,"default",{value:n,enumerable:!0}):e,n)),M=n=>x(u({},"__esModule",{value:!0}),n);var D={};v(D,{hands:()=>A});module.exports=M(D);var f=22,S=[0,0,5,9,13,17];function A(n){let{textureName:r,options:e}=n,c="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(i,L){let{injectGLSL:y}=L,m=null,p=null,H=-1,k=new Map,l=e?.maxHands??2;async function C(){try{let{FilesetResolver:t,HandLandmarker:d}=await import("@mediapipe/tasks-vision");p=await t.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),m=await d.createFromOptions(p,{baseOptions:{modelAssetPath:e?.modelPath||c},runningMode:"VIDEO",numHands:e?.maxHands??2,minHandDetectionConfidence:e?.minHandDetectionConfidence??.5,minHandPresenceConfidence:e?.minHandPresenceConfidence??.5,minTrackingConfidence:e?.minTrackingConfidence??.5})}catch(t){throw console.error("Failed to initialize Hand Landmarker:",t),t}}function T(t){let d=S.map(a=>t[a]).filter(a=>a&&typeof a.x=="number"&&typeof a.y=="number");if(d.length===0)return[0,0];let o=0,s=0;for(let a of d)o+=a.x,s+=a.y;return[o/d.length,s/d.length]}function h(t){if(!t.landmarks)return;let d=t.landmarks.length,o={u_nHands:d};d&&(o.u_handLandmarks=t.landmarks.flatMap(s=>{let a=T(s);return a[1]=1-a[1],s.map(g=>[g.x,1-g.y]).concat([a])})),i.updateUniforms(o)}i.registerHook("init",async()=>{i.initializeUniform("u_maxHands","int",l),i.initializeUniform("u_nHands","int",0);let t=Array.from({length:l*f},()=>[.5,.5]);i.initializeUniform("u_handLandmarks","float",t,{arrayLength:l*f}),await C()}),i.registerHook("updateTextures",t=>{Object.entries(t).forEach(([d,o])=>{if(d===r&&(k.set(d,o),!!m))try{if(o instanceof HTMLVideoElement){if(o.currentTime!==H){H=o.currentTime;let s=performance.now(),a=m.detectForVideo(o,s);h(a)}}else if(o instanceof HTMLImageElement){let s=m.detect(o);h(s)}}catch(s){console.warn("Hand detection error:",s)}})}),i.registerHook("destroy",()=>{m&&(m.close(),m=null),p=null,k.clear()}),y(`
uniform int u_maxHands;
uniform int u_nHands;
uniform vec2 u_handLandmarks[${l*f}];
vec2 handLandmark(int handIndex, int landmarkIndex) {
	return u_handLandmarks[handIndex * ${f} + landmarkIndex];
}`)}}0&&(module.exports={hands});
//# sourceMappingURL=hands.js.map