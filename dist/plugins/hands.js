"use strict";var _=Object.create;var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,w=Object.prototype.hasOwnProperty;var N=(e,t)=>{for(var a in t)l(e,a,{get:t[a],enumerable:!0})},x=(e,t,a,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of b(t))!w.call(e,o)&&o!==a&&l(e,o,{get:()=>t[o],enumerable:!(c=v(t,o))||c.enumerable});return e};var M=(e,t,a)=>(a=e!=null?_(S(e)):{},x(t||!e||!e.__esModule?l(a,"default",{value:e,enumerable:!0}):a,e)),P=e=>x(l({},"__esModule",{value:!0}),e);var E={};N(E,{default:()=>D});module.exports=P(E);var f=22,z=[0,0,5,9,13,17];function A(e){let{textureName:t,options:a}=e,c="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(o,L){let{injectGLSL:y}=L,d=null,p=null,H=-1,k=new Map,u=a?.maxHands??2;async function C(){try{let{FilesetResolver:r,HandLandmarker:n}=await import("@mediapipe/tasks-vision");p=await r.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),d=await n.createFromOptions(p,{baseOptions:{modelAssetPath:a?.modelPath||c},runningMode:"VIDEO",numHands:a?.maxHands??2,minHandDetectionConfidence:a?.minHandDetectionConfidence??.5,minHandPresenceConfidence:a?.minHandPresenceConfidence??.5,minTrackingConfidence:a?.minTrackingConfidence??.5})}catch(r){throw console.error("Failed to initialize Hand Landmarker:",r),r}}function T(r){let n=z.map(i=>r[i]).filter(i=>i&&typeof i.x=="number"&&typeof i.y=="number");if(n.length===0)return[0,0];let m=0,s=0;for(let i of n)m+=i.x,s+=i.y;return[m/n.length,s/n.length]}function h(r){if(!r.landmarks)return;let n=r.landmarks.length,m={u_nHands:n};n&&(m.u_handLandmarks=r.landmarks.flatMap(s=>{let i=T(s);return i[1]=1-i[1],s.map(g=>[g.x,1-g.y]).concat([i])})),o.updateUniforms(m)}o.registerHook("init",async()=>{o.initializeUniform("u_maxHands","int",u),o.initializeUniform("u_nHands","int",0);let r=Array.from({length:u*f},()=>[.5,.5]);o.initializeUniform("u_handLandmarks","float",r,{arrayLength:u*f}),await C()}),o.registerHook("updateTextures",r=>{let n=r[t];if(!(!n||(k.get(t)!==n&&(H=-1),k.set(t,n),!d)))try{if(n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==H){H=n.currentTime;let s=performance.now(),i=d.detectForVideo(n,s);h(i)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let s=d.detect(n);h(s)}}catch(s){console.warn("Hand detection error:",s)}}),o.registerHook("destroy",()=>{d&&(d.close(),d=null),p=null,k.clear()}),y(`
uniform int u_maxHands;
uniform int u_nHands;
uniform vec2 u_handLandmarks[${u*f}];
vec2 handLandmark(int handIndex, int landmarkIndex) {
	return u_handLandmarks[handIndex * ${f} + landmarkIndex];
}`)}}var D=A;
//# sourceMappingURL=hands.js.map