"use strict";var V=Object.create;var y=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty;var Y=(t,i)=>{for(var a in i)y(t,a,{get:i[a],enumerable:!0})},w=(t,i,a,g)=>{if(i&&typeof i=="object"||typeof i=="function")for(let o of K(i))!B.call(t,o)&&o!==a&&y(t,o,{get:()=>i[o],enumerable:!(g=P(i,o))||g.enumerable});return t};var $=(t,i,a)=>(a=t!=null?V(X(t)):{},w(i||!t||!t.__esModule?y(a,"default",{value:t,enumerable:!0}):a,t)),j=t=>w(y({},"__esModule",{value:!0}),t);var Q={};Y(Q,{default:()=>J});module.exports=j(Q);var G=21,W=1,p=G+W,Z=[0,0,5,9,13,17];function q(t){let{textureName:i,options:a}=t,g="https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task";return function(o,I){let{injectGLSL:R,gl:k}=I,m=null,_=null,C=-1,A=new Map,N=a?.maxHands??2,l=512,M=0,r=null;async function F(){try{let{FilesetResolver:e,HandLandmarker:n}=await import("@mediapipe/tasks-vision");_=await e.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),m=await n.createFromOptions(_,{baseOptions:{modelAssetPath:a?.modelPath||g},runningMode:"VIDEO",numHands:a?.maxHands??2,minHandDetectionConfidence:a?.minHandDetectionConfidence??.5,minHandPresenceConfidence:a?.minHandPresenceConfidence??.5,minTrackingConfidence:a?.minTrackingConfidence??.5})}catch(e){throw console.error("Failed to initialize Hand Landmarker:",e),e}}function D(e,n,x){let d=1/0,s=-1/0,T=1/0,c=-1/0,u=0,f=0;for(let U of x){let L=(n*p+U)*4,v=e[L],b=e[L+1];d=Math.min(d,v),s=Math.max(s,v),T=Math.min(T,b),c=Math.max(c,b),u+=e[L+2],f+=e[L+3]}let h=(d+s)/2,H=(T+c)/2,O=u/x.length,z=f/x.length;return[h,H,O,z]}function E(e){if(!r)return;let n=e.length,x=n*p;for(let s=0;s<n;++s){let T=e[s];for(let f=0;f<21;++f){let h=T[f],H=(s*p+f)*4;r[H]=h.x,r[H+1]=1-h.y,r[H+2]=h.z??0,r[H+3]=h.visibility??1}let c=D(r,s,Z),u=(s*p+21)*4;r[u]=c[0],r[u+1]=c[1],r[u+2]=c[2],r[u+3]=c[3]}let d=Math.ceil(x/l);o.updateTextures({u_handLandmarksTex:{data:r,width:l,height:d}})}function S(e){if(!e.landmarks||!r)return;let n=e.landmarks.length;E(e.landmarks),o.updateUniforms({u_nHands:n})}o.registerHook("init",async()=>{o.initializeUniform("u_maxHands","int",N),o.initializeUniform("u_nHands","int",0);let e=N*p;M=Math.ceil(e/l);let n=l*M*4;r=new Float32Array(n),o.initializeTexture("u_handLandmarksTex",{data:r,width:l,height:M},{internalFormat:k.RGBA32F,type:k.FLOAT,minFilter:k.NEAREST,magFilter:k.NEAREST}),await F()}),o.registerHook("updateTextures",e=>{let n=e[i];if(!(!n||(A.get(i)!==n&&(C=-1),A.set(i,n),!m)))try{if(n instanceof HTMLVideoElement){if(n.videoWidth===0||n.videoHeight===0||n.readyState<2)return;if(n.currentTime!==C){C=n.currentTime;let d=performance.now(),s=m.detectForVideo(n,d);S(s)}}else if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){if(n.width===0||n.height===0)return;let d=m.detect(n);S(d)}}catch(d){console.warn("Hand detection error:",d)}}),o.registerHook("destroy",()=>{m&&(m.close(),m=null),_=null,A.clear(),r=null}),R(`
uniform int u_maxHands;
uniform int u_nHands;
uniform sampler2D u_handLandmarksTex;
vec4 handLandmark(int handIndex, int landmarkIndex) {
	int i = handIndex * ${p} + landmarkIndex;
	int x = i % ${l};
	int y = i / ${l};
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);
}`)}}var J=q;
//# sourceMappingURL=hands.js.map