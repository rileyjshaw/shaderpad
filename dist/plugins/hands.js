"use strict";var X=Object.create;var C=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var Q=(n,o)=>{for(var t in o)C(n,t,{get:o[t],enumerable:!0})},U=(n,o,t,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of Y(o))!Z.call(n,a)&&a!==t&&C(n,a,{get:()=>o[a],enumerable:!(s=q(o,a))||s.enumerable});return n};var z=(n,o,t)=>(t=n!=null?X(J(n)):{},U(o||!n||!n.__esModule?C(t,"default",{value:n,enumerable:!0}):t,n)),ee=n=>U(C({},"__esModule",{value:!0}),n);var oe={};Q(oe,{default:()=>se});module.exports=ee(oe);var me={data:new Uint8Array(4),width:1,height:1};function E(n){return n instanceof HTMLVideoElement||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas}function K(n){return JSON.stringify(n,Object.keys(n).sort())}function G(n,o,t,s,a=0){let i=1/0,l=-1/0,m=1/0,d=-1/0,c=0,h=0;for(let x of t){let f=(a+o*s+x)*4,L=n[f],e=n[f+1];i=Math.min(i,L),l=Math.max(l,L),m=Math.min(m,e),d=Math.max(d,e),c+=n[f+2],h+=n[f+3]}return[(i+l)/2,(m+d)/2,c/t.length,h/t.length]}var P=null;function W(){return P||(P=import("@mediapipe/tasks-vision").then(({FilesetResolver:n})=>n.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22-rc.20250304/wasm"))),P}function B(n){return{historyParams:n?", framesAgo":"",fn:n?(s,a,i,l)=>{let m=i.replace(/\w+ /g,""),d=i?`${i}, int framesAgo`:"int framesAgo",c=m?`${m}, 0`:"0";return`${s} ${a}(${d}) {
${l}
}
${s} ${a}(${i}) { return ${a}(${c}); }`}:(s,a,i,l)=>`${s} ${a}(${i}) {
${l}
}`}}var v=21,ne=1,y=v+ne,te=[0,0,5,9,13,17],k=512,b=1,ae={modelPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",maxHands:2,minHandDetectionConfidence:.5,minHandPresenceConfidence:.5,minTrackingConfidence:.5},M=new Map;function ie(n,o,t){let s=n.landmarks.data,a=o.length;s[0]=a;for(let i=0;i<a;++i){let l=o[i],m=t[i]?.[0]?.categoryName==="Right";for(let h=0;h<v;++h){let x=l[h],f=(b+i*y+h)*4;s[f]=x.x,s[f+1]=1-x.y,s[f+2]=x.z??0,s[f+3]=m?1:0}let d=G(s,i,te,y,b),c=(b+i*y+v)*4;s[c]=d[0],s[c+1]=d[1],s[c+2]=d[2],s[c+3]=m?1:0}n.state.nHands=a}function re(n){let{textureName:o,options:{history:t,...s}={}}=n,a={...ae,...s},i=K({...a,textureName:o}),l=a.maxHands*y+b,m=Math.ceil(l/k);return function(d,c){let{injectGLSL:h,emitHook:x}=c,L=M.get(i)?.landmarks.data??new Float32Array(k*m*4),e=null,A=!1,$=!1;function I(r){if(!e)return;let{nHands:u}=e.state,g=u*y+b,T=Math.ceil(g/k),H=r;typeof H>"u"&&S.length>0&&(H=S,S=[]),d.updateTextures({u_handLandmarksTex:{data:e.landmarks.data,width:k,height:T,isPartial:!0}},t?{skipHistoryWrite:$,historyWriteIndex:H}:void 0),d.updateUniforms({u_nHands:u}),x("hands:result",e.state.result)}async function j(){if(M.has(i))e=M.get(i);else{let[r,{HandLandmarker:u}]=await Promise.all([W(),import("@mediapipe/tasks-vision")]);if(A)return;let g=new OffscreenCanvas(1,1),T=await u.createFromOptions(r,{baseOptions:{modelAssetPath:a.modelPath,delegate:"GPU"},canvas:g,runningMode:"VIDEO",numHands:a.maxHands,minHandDetectionConfidence:a.minHandDetectionConfidence,minHandPresenceConfidence:a.minHandPresenceConfidence,minTrackingConfidence:a.minTrackingConfidence});if(A){T.close();return}e={landmarker:T,mediapipeCanvas:g,subscribers:new Map,maxHands:a.maxHands,state:{runningMode:"VIDEO",source:null,videoTime:-1,resultTimestamp:0,result:null,pending:Promise.resolve(),nHands:0},landmarks:{data:L,textureHeight:m}},M.set(i,e)}e.subscribers.set(I,!1)}let N=j();d.on("init",()=>{d.initializeUniform("u_maxHands","int",a.maxHands),d.initializeUniform("u_nHands","int",0),d.initializeTexture("u_handLandmarksTex",{data:L,width:k,height:m},{internalFormat:"RGBA32F",type:"FLOAT",minFilter:"NEAREST",magFilter:"NEAREST",history:t}),N.then(()=>{A||!e||x("hands:ready")})});let _=0,S=[],F=()=>{t&&(I(_),S.push(_),_=(_+1)%(t+1))};d.on("initializeTexture",(r,u)=>{r===o&&E(u)&&(F(),R(u))}),d.on("updateTextures",(r,u)=>{let g=r[o];E(g)&&($=u?.skipHistoryWrite??!1,$||F(),R(g))});let w=0;async function R(r){let u=performance.now(),g=++w;await N,e&&(e.state.pending=e.state.pending.then(async()=>{if(g!==w||!e)return;let T=r instanceof HTMLVideoElement?"VIDEO":"IMAGE";e.state.runningMode!==T&&(e.state.runningMode=T,await e.landmarker.setOptions({runningMode:T}));let H=!1;if(r!==e.state.source?(e.state.source=r,e.state.videoTime=-1,H=!0):r instanceof HTMLVideoElement?r.currentTime!==e.state.videoTime&&(e.state.videoTime=r.currentTime,H=!0):r instanceof HTMLImageElement||u-e.state.resultTimestamp>2&&(H=!0),H){let p;if(r instanceof HTMLVideoElement){if(r.videoWidth===0||r.videoHeight===0||r.readyState<2)return;p=e.landmarker.detectForVideo(r,u)}else{if(r.width===0||r.height===0)return;p=e.landmarker.detect(r)}if(p){e.state.resultTimestamp=u,e.state.result=p,ie(e,p.landmarks,p.handedness);for(let O of e.subscribers.keys())O(),e.subscribers.set(O,!0)}}else if(e.state.result)for(let[p,O]of e.subscribers.entries())O||(p(),e.subscribers.set(p,!0))}),await e.state.pending)}d.on("destroy",()=>{A=!0,e&&(e.subscribers.delete(I),e.subscribers.size===0&&(e.landmarker.close(),M.delete(i))),e=null});let{fn:D,historyParams:V}=B(t);h(`
uniform int u_maxHands;
uniform int u_nHands;
uniform highp sampler2D${t?"Array":""} u_handLandmarksTex;${t?`
uniform int u_handLandmarksTexFrameOffset;`:""}

${D("int","nHandsAt","",t?`
	int layer = (u_handLandmarksTexFrameOffset - framesAgo + ${t+1}) % ${t+1};
	return int(texelFetch(u_handLandmarksTex, ivec3(0, 0, layer), 0).r + 0.5);`:`
	return int(texelFetch(u_handLandmarksTex, ivec2(0, 0), 0).r + 0.5);`)}
${D("vec4","handLandmark","int handIndex, int landmarkIndex",`int i = ${b} + handIndex * ${y} + landmarkIndex;
	int x = i % ${k};
	int y = i / ${k};${t?`
	int layer = (u_handLandmarksTexFrameOffset - framesAgo + ${t+1}) % ${t+1};
	return texelFetch(u_handLandmarksTex, ivec3(x, y, layer), 0);`:`
	return texelFetch(u_handLandmarksTex, ivec2(x, y), 0);`}`)}
${D("float","isRightHand","int handIndex",`return handLandmark(handIndex, 0${V}).w;`)}
${D("float","isLeftHand","int handIndex",`return 1.0 - handLandmark(handIndex, 0${V}).w;`)}`)}}var se=re;
//# sourceMappingURL=hands.js.map