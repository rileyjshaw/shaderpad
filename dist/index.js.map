{"version":3,"sources":["../src/index.ts","../src/plugins/history.ts","../src/plugins/save.ts","../src/plugins/face.ts"],"sourcesContent":["const DEFAULT_VERTEX_SHADER_SRC = `#version 300 es\nin vec2 aPosition;\nout vec2 v_uv;\nvoid main() {\n    v_uv = aPosition * 0.5 + 0.5;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}\n`;\nconst RESIZE_THROTTLE_INTERVAL = 1000 / 30;\n\ninterface Uniform {\n\ttype: 'float' | 'int';\n\tlength: 1 | 2 | 3 | 4;\n\tlocation: WebGLUniformLocation;\n}\n\ninterface Texture {\n\ttexture: WebGLTexture;\n\tunitIndex: number;\n}\n\nexport type TextureSource = HTMLImageElement | HTMLVideoElement | HTMLCanvasElement;\n\nexport interface PluginContext {\n\tgl: WebGL2RenderingContext;\n\tuniforms: Map<string, Uniform>;\n\ttextures: Map<string, Texture>;\n\tget program(): WebGLProgram | null;\n\tcanvas: HTMLCanvasElement;\n\treserveTextureUnit: (name: string) => number;\n\treleaseTextureUnit: (name: string) => void;\n}\n\ntype Plugin = (shaderPad: ShaderPad, context: PluginContext) => void;\n\ntype LifecycleMethod =\n\t| 'init'\n\t| 'step'\n\t| 'destroy'\n\t| 'updateResolution'\n\t| 'reset'\n\t| 'initializeTexture'\n\t| 'updateTextures'\n\t| 'initializeUniform'\n\t| 'updateUniforms';\n\ninterface Options {\n\tcanvas?: HTMLCanvasElement | null;\n\tplugins?: Plugin[];\n}\n\ntype TextureUnitPool = {\n\tfree: number[];\n\tnext: number;\n\tmax: number;\n};\n\nclass ShaderPad {\n\tprivate isInternalCanvas = false;\n\tprivate isTouchDevice = false;\n\tprivate gl: WebGL2RenderingContext;\n\tprivate downloadLink: HTMLAnchorElement;\n\tprivate fragmentShaderSrc: string;\n\tprivate uniforms: Map<string, Uniform> = new Map();\n\tprivate textures: Map<string, Texture> = new Map();\n\tprivate textureUnitPool: TextureUnitPool;\n\tprivate buffer: WebGLBuffer | null = null;\n\tprivate program: WebGLProgram | null = null;\n\tprivate animationFrameId: number | null;\n\tprivate resolutionObserver: MutationObserver;\n\tprivate resizeObserver: ResizeObserver;\n\tprivate resizeTimeout: NodeJS.Timeout = null as unknown as NodeJS.Timeout;\n\tprivate lastResizeTime = 0;\n\tprivate eventListeners: Map<string, EventListener> = new Map();\n\tprivate frame = 0;\n\tprivate startTime = 0;\n\tprivate cursorPosition = [0.5, 0.5];\n\tprivate clickPosition = [0.5, 0.5];\n\tprivate isMouseDown = false;\n\tpublic canvas: HTMLCanvasElement;\n\tpublic onResize?: (width: number, height: number) => void;\n\tprivate hooks: Map<LifecycleMethod, Function[]> = new Map();\n\n\tconstructor(fragmentShaderSrc: string, options: Options = {}) {\n\t\tthis.canvas = options.canvas || document.createElement('canvas');\n\t\tif (!options.canvas) {\n\t\t\tthis.isInternalCanvas = true;\n\t\t\tdocument.body.appendChild(this.canvas);\n\t\t\tthis.canvas.style.position = 'fixed';\n\t\t\tthis.canvas.style.inset = '0';\n\t\t\tthis.canvas.style.height = '100dvh';\n\t\t\tthis.canvas.style.width = '100dvw';\n\t\t}\n\n\t\tthis.gl = this.canvas.getContext('webgl2', { antialias: false }) as WebGL2RenderingContext;\n\t\tif (!this.gl) {\n\t\t\tthrow new Error('WebGL2 not supported. Please use a browser that supports WebGL2.');\n\t\t}\n\n\t\tthis.textureUnitPool = {\n\t\t\tfree: [],\n\t\t\tnext: 1, // Start from 1 to avoid conflict with framebuffer history texture at unit 0.\n\t\t\tmax: this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),\n\t\t};\n\n\t\tthis.downloadLink = document.createElement('a');\n\t\tthis.fragmentShaderSrc = fragmentShaderSrc;\n\t\tthis.animationFrameId = null;\n\t\tthis.resolutionObserver = new MutationObserver(() => this.updateResolution());\n\t\tthis.resizeObserver = new ResizeObserver(() => this.throttledHandleResize());\n\n\t\tif (options.plugins) {\n\t\t\tconst context: PluginContext = {\n\t\t\t\tgl: this.gl,\n\t\t\t\tuniforms: this.uniforms,\n\t\t\t\ttextures: this.textures,\n\t\t\t\tcanvas: this.canvas,\n\t\t\t\treserveTextureUnit: this.reserveTextureUnit.bind(this),\n\t\t\t\treleaseTextureUnit: this.releaseTextureUnit.bind(this),\n\t\t\t} as PluginContext;\n\t\t\t// Define program as a getter so it always returns the current program.\n\t\t\tObject.defineProperty(context, 'program', {\n\t\t\t\tget: () => this.program,\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t});\n\t\t\toptions.plugins.forEach(plugin => plugin(this, context));\n\t\t}\n\t\tthis.init();\n\t\tthis.addEventListeners();\n\t}\n\n\tregisterHook(name: LifecycleMethod, fn: Function) {\n\t\tif (!this.hooks.has(name)) {\n\t\t\tthis.hooks.set(name, []);\n\t\t}\n\t\tthis.hooks.get(name)!.push(fn);\n\t}\n\n\tprivate init() {\n\t\tconst vertexShaderSrc = DEFAULT_VERTEX_SHADER_SRC;\n\n\t\tthis.program = this.gl.createProgram();\n\t\tif (!this.program) {\n\t\t\tthrow new Error('Failed to create WebGL program');\n\t\t}\n\t\tconst vertexShader = this.createShader(this.gl.VERTEX_SHADER, vertexShaderSrc);\n\t\tconst fragmentShader = this.createShader(this.gl.FRAGMENT_SHADER, this.fragmentShaderSrc);\n\n\t\tthis.gl.attachShader(this.program, vertexShader);\n\t\tthis.gl.attachShader(this.program, fragmentShader);\n\t\tthis.gl.linkProgram(this.program);\n\t\tthis.gl.deleteShader(vertexShader);\n\t\tthis.gl.deleteShader(fragmentShader);\n\n\t\tif (!this.gl.getProgramParameter(this.program, this.gl.LINK_STATUS)) {\n\t\t\tconsole.error('Program link error:', this.gl.getProgramInfoLog(this.program));\n\t\t\tthis.gl.deleteProgram(this.program);\n\t\t\tthrow new Error('Failed to link WebGL program');\n\t\t}\n\n\t\tconst aPosition = this.gl.getAttribLocation(this.program, 'aPosition');\n\t\tthis.setupBuffer(aPosition);\n\n\t\tthis.gl.useProgram(this.program);\n\n\t\tthis.resolutionObserver.observe(this.canvas, { attributes: true, attributeFilter: ['width', 'height'] });\n\t\tthis.resizeObserver.observe(this.canvas);\n\n\t\tif (!this.isInternalCanvas) {\n\t\t\tthis.updateResolution();\n\t\t}\n\t\tthis.initializeUniform('u_cursor', 'float', this.cursorPosition);\n\t\tthis.initializeUniform('u_click', 'float', [...this.clickPosition, this.isMouseDown ? 1.0 : 0.0]);\n\t\tthis.initializeUniform('u_time', 'float', 0);\n\t\tthis.initializeUniform('u_frame', 'int', 0);\n\n\t\tthis.hooks.get('init')?.forEach(hook => hook.call(this));\n\t}\n\n\tprivate createShader(type: number, source: string): WebGLShader {\n\t\tconst shader = this.gl.createShader(type)!;\n\t\tthis.gl.shaderSource(shader, source);\n\t\tthis.gl.compileShader(shader);\n\t\tif (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n\t\t\tconsole.error('Shader compilation failed:', source);\n\t\t\tconsole.error(this.gl.getShaderInfoLog(shader));\n\t\t\tthis.gl.deleteShader(shader);\n\t\t\tthrow new Error('Shader compilation failed');\n\t\t}\n\t\treturn shader;\n\t}\n\n\tprivate setupBuffer(aPosition: number) {\n\t\tconst quadVertices = new Float32Array([-1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1]);\n\n\t\tthis.buffer = this.gl.createBuffer();\n\t\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.buffer);\n\t\tthis.gl.bufferData(this.gl.ARRAY_BUFFER, quadVertices, this.gl.STATIC_DRAW);\n\t\tthis.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n\t\tthis.gl.enableVertexAttribArray(aPosition);\n\t\tthis.gl.vertexAttribPointer(aPosition, 2, this.gl.FLOAT, false, 0, 0);\n\t}\n\n\tprivate throttledHandleResize() {\n\t\tclearTimeout(this.resizeTimeout);\n\t\tconst now = performance.now();\n\t\tconst timeUntilNextResize = this.lastResizeTime + RESIZE_THROTTLE_INTERVAL - now;\n\t\tif (timeUntilNextResize <= 0) {\n\t\t\tthis.lastResizeTime = now;\n\t\t\tthis.handleResize();\n\t\t} else {\n\t\t\tthis.resizeTimeout = setTimeout(() => this.throttledHandleResize(), timeUntilNextResize);\n\t\t}\n\t}\n\n\tprivate handleResize() {\n\t\tconst pixelRatio = window.devicePixelRatio || 1;\n\t\tconst width = this.canvas.clientWidth * pixelRatio;\n\t\tconst height = this.canvas.clientHeight * pixelRatio;\n\t\tif (this.isInternalCanvas && (this.canvas.width !== width || this.canvas.height !== height)) {\n\t\t\tthis.canvas.width = width;\n\t\t\tthis.canvas.height = height;\n\t\t}\n\t\tthis.onResize?.(width, height);\n\t}\n\n\tprivate addEventListeners() {\n\t\tconst updateCursor = (x: number, y: number) => {\n\t\t\tif (!this.uniforms.has('u_cursor')) return;\n\t\t\tconst rect = this.canvas.getBoundingClientRect();\n\t\t\tthis.cursorPosition[0] = (x - rect.left) / rect.width;\n\t\t\tthis.cursorPosition[1] = 1 - (y - rect.top) / rect.height; // Flip Y for WebGL\n\t\t\tthis.updateUniforms({ u_cursor: this.cursorPosition });\n\t\t};\n\n\t\tconst updateClick = (isMouseDown: boolean, x?: number, y?: number) => {\n\t\t\tif (!this.uniforms.has('u_click')) return;\n\t\t\tthis.isMouseDown = isMouseDown;\n\t\t\tif (isMouseDown) {\n\t\t\t\tconst rect = this.canvas.getBoundingClientRect();\n\t\t\t\tconst xVal = x as number;\n\t\t\t\tconst yVal = y as number;\n\t\t\t\tthis.clickPosition[0] = (xVal - rect.left) / rect.width;\n\t\t\t\tthis.clickPosition[1] = 1 - (yVal - rect.top) / rect.height; // Flip Y for WebGL\n\t\t\t}\n\t\t\tthis.updateUniforms({ u_click: [...this.clickPosition, this.isMouseDown ? 1.0 : 0.0] });\n\t\t};\n\n\t\tthis.eventListeners.set('mousemove', event => {\n\t\t\tconst mouseEvent = event as MouseEvent;\n\t\t\tif (!this.isTouchDevice) {\n\t\t\t\tupdateCursor(mouseEvent.clientX, mouseEvent.clientY);\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.set('mousedown', event => {\n\t\t\tconst mouseEvent = event as MouseEvent;\n\t\t\tif (!this.isTouchDevice) {\n\t\t\t\tif (mouseEvent.button === 0) {\n\t\t\t\t\tthis.isMouseDown = true;\n\t\t\t\t\tupdateClick(true, mouseEvent.clientX, mouseEvent.clientY);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.set('mouseup', event => {\n\t\t\tconst mouseEvent = event as MouseEvent;\n\t\t\tif (!this.isTouchDevice) {\n\t\t\t\tif (mouseEvent.button === 0) {\n\t\t\t\t\tupdateClick(false);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.set('touchmove', event => {\n\t\t\tconst touchEvent = event as TouchEvent;\n\t\t\tif (touchEvent.touches.length > 0) {\n\t\t\t\tupdateCursor(touchEvent.touches[0].clientX, touchEvent.touches[0].clientY);\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.set('touchstart', event => {\n\t\t\tconst touchEvent = event as TouchEvent;\n\t\t\tthis.isTouchDevice = true;\n\t\t\tif (touchEvent.touches.length > 0) {\n\t\t\t\tupdateCursor(touchEvent.touches[0].clientX, touchEvent.touches[0].clientY);\n\t\t\t\tupdateClick(true, touchEvent.touches[0].clientX, touchEvent.touches[0].clientY);\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.set('touchend', event => {\n\t\t\tconst touchEvent = event as TouchEvent;\n\t\t\tif (touchEvent.touches.length === 0) {\n\t\t\t\tupdateClick(false);\n\t\t\t}\n\t\t});\n\n\t\tthis.eventListeners.forEach((listener, event) => {\n\t\t\tthis.canvas.addEventListener(event, listener);\n\t\t});\n\t}\n\n\tprivate updateResolution() {\n\t\tconst width = this.gl.drawingBufferWidth;\n\t\tconst height = this.gl.drawingBufferHeight;\n\t\tthis.gl.viewport(0, 0, width, height);\n\t\tif (this.uniforms.has('u_resolution')) {\n\t\t\tthis.updateUniforms({ u_resolution: [width, height] });\n\t\t} else {\n\t\t\tthis.initializeUniform('u_resolution', 'float', [width, height]);\n\t\t}\n\n\t\tthis.hooks.get('updateResolution')?.forEach(hook => hook.call(this));\n\t}\n\n\tprivate reserveTextureUnit(name: string) {\n\t\tconst existing = this.textures.get(name);\n\t\tif (existing) return existing.unitIndex;\n\t\tif (this.textureUnitPool.free.length > 0) return this.textureUnitPool.free.pop()!;\n\t\tif (this.textureUnitPool.next >= this.textureUnitPool.max) {\n\t\t\tthrow new Error('Exceeded the available texture units for this device.');\n\t\t}\n\t\treturn this.textureUnitPool.next++;\n\t}\n\n\tprivate releaseTextureUnit(name: string) {\n\t\tconst existing = this.textures.get(name);\n\t\tif (existing) {\n\t\t\tthis.textureUnitPool.free.push(existing.unitIndex);\n\t\t}\n\t}\n\n\tinitializeUniform(name: string, type: 'float' | 'int', value: number | number[]) {\n\t\tif (this.uniforms.has(name)) {\n\t\t\tthrow new Error(`Uniform '${name}' is already initialized.`);\n\t\t}\n\n\t\tif (type !== 'float' && type !== 'int') {\n\t\t\tthrow new Error(`Invalid uniform type: ${type}. Expected 'float' or 'int'.`);\n\t\t}\n\n\t\tconst location = this.gl.getUniformLocation(this.program!, name);\n\t\tif (!location) {\n\t\t\tconsole.debug(`Uniform ${name} not found in fragment shader. Skipping initialization.`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(value)) {\n\t\t\tvalue = [value];\n\t\t}\n\t\tif (value.length < 1 || value.length > 4) {\n\t\t\tthrow new Error(`Invalid uniform value length: ${value.length}. Expected a length between 1 and 4.`);\n\t\t}\n\n\t\tconst length = value.length as 1 | 2 | 3 | 4;\n\t\tthis.uniforms.set(name, { type, length, location });\n\t\tthis.hooks.get('initializeUniform')?.forEach(hook => hook.call(this, ...arguments));\n\t\tthis.updateUniforms({ [name]: value });\n\t}\n\n\tupdateUniforms(updates: Record<string, number | number[]>) {\n\t\tthis.hooks.get('updateUniforms')?.forEach(hook => hook.call(this, ...arguments));\n\n\t\tObject.entries(updates).forEach(([name, value]: [string, number | number[]]) => {\n\t\t\tif (!this.uniforms.has(name)) {\n\t\t\t\tthrow new Error(`Uniform '${name}' is not initialized.`);\n\t\t\t}\n\n\t\t\tconst uniform = this.uniforms.get(name)!;\n\t\t\tif (!Array.isArray(value)) {\n\t\t\t\tvalue = [value];\n\t\t\t}\n\t\t\tif (value.length !== uniform.length) {\n\t\t\t\tthrow new Error(`Invalid uniform value length: ${value.length}. Expected ${uniform.length}.`);\n\t\t\t}\n\t\t\t(this.gl as any)[`uniform${uniform.length}${uniform.type.charAt(0)}`](uniform.location, ...value);\n\t\t});\n\t}\n\n\tinitializeTexture(name: string, source: TextureSource) {\n\t\tif (this.textures.has(name)) {\n\t\t\tthrow new Error(`Texture '${name}' is already initialized.`);\n\t\t}\n\n\t\tconst texture = this.gl.createTexture();\n\t\tif (!texture) {\n\t\t\tthrow new Error('Failed to create texture');\n\t\t}\n\t\tlet unitIndex: number;\n\t\ttry {\n\t\t\tunitIndex = this.reserveTextureUnit(name);\n\t\t} catch (error) {\n\t\t\tthis.gl.deleteTexture(texture);\n\t\t\tthrow error;\n\t\t}\n\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + unitIndex);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n\t\t// Flip the texture vertically during upload to match WebGL's coordinate system.\n\t\t// WebGL uses bottom-left origin, while images/videos use top-left origin.\n\t\tthis.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, true);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\n\t\tthis.textures.set(name, { texture, unitIndex });\n\t\tthis.hooks.get('initializeTexture')?.forEach(hook => hook.call(this, ...arguments));\n\t\tthis.updateTextures({ [name]: source });\n\t\tconst uSampler = this.gl.getUniformLocation(this.program!, name);\n\t\tif (uSampler) {\n\t\t\tthis.gl.uniform1i(uSampler, unitIndex);\n\t\t}\n\t}\n\n\tupdateTextures(updates: Record<string, TextureSource>) {\n\t\tthis.hooks.get('updateTextures')?.forEach(hook => hook.call(this, ...arguments));\n\n\t\tObject.entries(updates).forEach(([name, source]) => {\n\t\t\tconst info = this.textures.get(name);\n\t\t\tif (!info) {\n\t\t\t\tthrow new Error(`Texture '${name}' is not initialized.`);\n\t\t\t}\n\t\t\tthis.gl.activeTexture(this.gl.TEXTURE0 + info.unitIndex);\n\t\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, info.texture);\n\t\t\tthis.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, source);\n\t\t});\n\t}\n\n\tstep(time: number) {\n\t\tconst gl = this.gl;\n\n\t\tif (this.uniforms.has('u_time')) {\n\t\t\tthis.updateUniforms({ u_time: time });\n\t\t}\n\t\tif (this.uniforms.has('u_frame')) {\n\t\t\tthis.updateUniforms({ u_frame: this.frame });\n\t\t}\n\n\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\tgl.drawArrays(gl.TRIANGLES, 0, 6);\n\n\t\tthis.hooks.get('step')?.forEach(hook => hook.call(this, time, this.frame));\n\n\t\t++this.frame;\n\t}\n\n\tplay(callback?: (time: number, frame: number) => void) {\n\t\tthis.pause(); // Prevent double play.\n\t\tconst loop = (time: number) => {\n\t\t\ttime = (time - this.startTime) / 1000; // Convert from milliseconds to seconds.\n\t\t\tthis.step(time);\n\t\t\tthis.animationFrameId = requestAnimationFrame(loop);\n\t\t\tif (callback) callback(time, this.frame);\n\t\t};\n\t\tthis.animationFrameId = requestAnimationFrame(loop);\n\t}\n\n\tpause() {\n\t\tif (this.animationFrameId) {\n\t\t\tcancelAnimationFrame(this.animationFrameId);\n\t\t\tthis.animationFrameId = null;\n\t\t}\n\t}\n\n\treset() {\n\t\tthis.frame = 0;\n\t\tthis.startTime = performance.now();\n\t\tthis.hooks.get('reset')?.forEach(hook => hook.call(this));\n\t}\n\n\tdestroy() {\n\t\tif (this.animationFrameId) {\n\t\t\tcancelAnimationFrame(this.animationFrameId);\n\t\t\tthis.animationFrameId = null;\n\t\t}\n\n\t\tthis.resolutionObserver.disconnect();\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.eventListeners.forEach((listener, event) => {\n\t\t\tthis.canvas.removeEventListener(event, listener);\n\t\t});\n\n\t\tif (this.program) {\n\t\t\tthis.gl.deleteProgram(this.program);\n\t\t}\n\n\t\tthis.textures.forEach(texture => {\n\t\t\tthis.gl.deleteTexture(texture.texture);\n\t\t});\n\t\tthis.textureUnitPool.free = [];\n\t\tthis.textureUnitPool.next = 1;\n\n\t\tif (this.buffer) {\n\t\t\tthis.gl.deleteBuffer(this.buffer);\n\t\t\tthis.buffer = null;\n\t\t}\n\n\t\tthis.hooks.get('destroy')?.forEach(hook => hook.call(this));\n\n\t\tif (this.isInternalCanvas) {\n\t\t\tthis.canvas.remove();\n\t\t}\n\t}\n}\n\nexport * from './plugins';\nexport default ShaderPad;\n","import ShaderPad, { PluginContext, TextureSource } from '../index';\n\nexport type WithHistory<T extends ShaderPad> = T & {\n\tinitializeTexture(name: string, source: TextureSource, historyDepth?: number): void;\n};\n\nfunction getSourceDimensions(source: TextureSource) {\n\tif (source instanceof HTMLVideoElement) {\n\t\treturn { width: source.videoWidth, height: source.videoHeight };\n\t}\n\tif (source instanceof HTMLCanvasElement) {\n\t\treturn { width: source.width, height: source.height };\n\t}\n\t// HTMLImageElement\n\treturn { width: source.naturalWidth || source.width, height: source.naturalHeight || source.height };\n}\n\nfunction clearHistoryTextureLayers(gl: WebGL2RenderingContext, width: number, height: number, depth: number): void {\n\tconst transparent = new Uint8Array(width * height * 4);\n\tfor (let layer = 0; layer < depth; ++layer) {\n\t\tgl.texSubImage3D(gl.TEXTURE_2D_ARRAY, 0, 0, 0, layer, width, height, 1, gl.RGBA, gl.UNSIGNED_BYTE, transparent);\n\t}\n}\n\nfunction createHistoryTexture(gl: WebGL2RenderingContext, depth: number, width: number, height: number): WebGLTexture {\n\tconst texture = gl.createTexture();\n\tif (!texture) {\n\t\tthrow new Error('Failed to create history texture');\n\t}\n\tgl.activeTexture(gl.TEXTURE0);\n\tgl.bindTexture(gl.TEXTURE_2D_ARRAY, texture);\n\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\tgl.texStorage3D(gl.TEXTURE_2D_ARRAY, 1, gl.RGBA8, width, height, depth);\n\tclearHistoryTextureLayers(gl, width, height, depth);\n\treturn texture;\n}\n\ninterface TextureHistoryInfo {\n\tdepth: number;\n\twriteIndex: number;\n}\n\nexport function history(framebufferDepth: number = 1) {\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { gl, uniforms, textures, reserveTextureUnit } = context;\n\t\tconst shaderPadWithHistory = shaderPad as WithHistory<ShaderPad>;\n\n\t\tconst originalInitializeTexture = shaderPad.initializeTexture.bind(shaderPad);\n\t\tconst originalUpdateTextures = shaderPad.updateTextures.bind(shaderPad);\n\n\t\tconst historyTextureInfo = new Map<string, TextureHistoryInfo>();\n\n\t\tlet framebufferHistoryTexture: WebGLTexture | null = null;\n\t\tconst shouldTrackFramebuffer = framebufferDepth > 1;\n\t\tif (shouldTrackFramebuffer) {\n\t\t\tfunction initializeFramebufferHistory() {\n\t\t\t\tframebufferHistoryTexture = createHistoryTexture(\n\t\t\t\t\tgl,\n\t\t\t\t\tframebufferDepth,\n\t\t\t\t\tgl.drawingBufferWidth,\n\t\t\t\t\tgl.drawingBufferHeight\n\t\t\t\t);\n\n\t\t\t\tif (!uniforms.has('u_history')) {\n\t\t\t\t\tshaderPad.initializeUniform('u_history', 'int', 0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction clearFramebufferHistory() {\n\t\t\t\tif (!framebufferHistoryTexture) return;\n\t\t\t\tgl.activeTexture(gl.TEXTURE0);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D_ARRAY, framebufferHistoryTexture);\n\t\t\t\tclearHistoryTextureLayers(gl, gl.drawingBufferWidth, gl.drawingBufferHeight, framebufferDepth);\n\t\t\t}\n\n\t\t\tshaderPad.registerHook('init', initializeFramebufferHistory);\n\t\t\tshaderPad.registerHook('step', (_time: number, frame: number) => {\n\t\t\t\tif (!framebufferHistoryTexture) return;\n\t\t\t\tconst writeIdx = frame % framebufferDepth;\n\t\t\t\tgl.activeTexture(gl.TEXTURE0);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D_ARRAY, framebufferHistoryTexture);\n\t\t\t\tgl.copyTexSubImage3D(\n\t\t\t\t\tgl.TEXTURE_2D_ARRAY,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\twriteIdx,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\tgl.drawingBufferWidth,\n\t\t\t\t\tgl.drawingBufferHeight\n\t\t\t\t);\n\t\t\t});\n\t\t\tshaderPad.registerHook('updateResolution', () => {\n\t\t\t\tif (framebufferHistoryTexture) {\n\t\t\t\t\tgl.deleteTexture(framebufferHistoryTexture);\n\t\t\t\t}\n\t\t\t\tinitializeFramebufferHistory();\n\t\t\t});\n\t\t\tshaderPad.registerHook('reset', clearFramebufferHistory);\n\t\t}\n\t\tshaderPad.registerHook('reset', () => {\n\t\t\thistoryTextureInfo.forEach(info => {\n\t\t\t\tinfo.writeIndex = 0;\n\t\t\t});\n\t\t});\n\n\t\tshaderPadWithHistory.initializeTexture = function (\n\t\t\tname: string,\n\t\t\tsource: TextureSource,\n\t\t\thistoryDepth: number = 1\n\t\t) {\n\t\t\tconst { width, height } = getSourceDimensions(source);\n\t\t\tif (!width || !height) {\n\t\t\t\tthrow new Error(`Texture source must have valid dimensions`);\n\t\t\t}\n\n\t\t\tconst depth = Math.floor(historyDepth);\n\t\t\tif (depth <= 1) {\n\t\t\t\treturn originalInitializeTexture(name, source);\n\t\t\t}\n\n\t\t\tif (textures.has(name)) {\n\t\t\t\tthrow new Error(`Texture '${name}' is already initialized.`);\n\t\t\t}\n\n\t\t\tlet unitIndex: number | undefined;\n\t\t\tlet texture: WebGLTexture | null = null;\n\t\t\ttry {\n\t\t\t\tunitIndex = reserveTextureUnit(name);\n\t\t\t\ttexture = createHistoryTexture(gl, depth, width, height);\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + unitIndex);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D_ARRAY, texture);\n\n\t\t\t\t// Flip the texture vertically during upload to match WebGL's coordinate system.\n\t\t\t\t// WebGL uses bottom-left origin, while images/videos use top-left origin.\n\t\t\t\tgl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\t\t\tgl.texParameteri(gl.TEXTURE_2D_ARRAY, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n\n\t\t\t\tif (context.program) {\n\t\t\t\t\tconst uSampler = gl.getUniformLocation(context.program, name);\n\t\t\t\t\tif (uSampler) {\n\t\t\t\t\t\tgl.uniform1i(uSampler, unitIndex);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttextures.set(name, {\n\t\t\t\t\ttexture,\n\t\t\t\t\tunitIndex,\n\t\t\t\t});\n\n\t\t\t\thistoryTextureInfo.set(name, {\n\t\t\t\t\tdepth,\n\t\t\t\t\twriteIndex: 0,\n\t\t\t\t});\n\n\t\t\t\tshaderPadWithHistory.updateTextures({ [name]: source });\n\t\t\t} catch (error) {\n\t\t\t\tif (texture) gl.deleteTexture(texture);\n\t\t\t\tif (unitIndex !== undefined) {\n\t\t\t\t\tcontext.releaseTextureUnit(name);\n\t\t\t\t}\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t};\n\n\t\tshaderPadWithHistory.updateTextures = function (updates) {\n\t\t\tObject.entries(updates).forEach(([name, source]) => {\n\t\t\t\tconst textureInfo = textures.get(name);\n\t\t\t\tconst historyInfo = historyTextureInfo.get(name);\n\n\t\t\t\tif (!textureInfo || !historyInfo || historyInfo.depth <= 1) {\n\t\t\t\t\treturn originalUpdateTextures({ [name]: source });\n\t\t\t\t}\n\n\t\t\t\tconst { width, height } = getSourceDimensions(source);\n\t\t\t\tconst writeIndex = historyInfo.writeIndex;\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + textureInfo.unitIndex);\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D_ARRAY, textureInfo.texture);\n\t\t\t\tgl.texSubImage3D(\n\t\t\t\t\tgl.TEXTURE_2D_ARRAY,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\twriteIndex,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t\t1,\n\t\t\t\t\tgl.RGBA,\n\t\t\t\t\tgl.UNSIGNED_BYTE,\n\t\t\t\t\tsource\n\t\t\t\t);\n\t\t\t\thistoryInfo.writeIndex = (writeIndex + 1) % historyInfo.depth;\n\t\t\t});\n\t\t};\n\n\t\tshaderPad.registerHook('destroy', () => {\n\t\t\tif (framebufferHistoryTexture) {\n\t\t\t\tgl.deleteTexture(framebufferHistoryTexture);\n\t\t\t}\n\t\t\thistoryTextureInfo.clear();\n\t\t});\n\t};\n}\n","import ShaderPad, { PluginContext } from '../index';\n\ndeclare module '../index' {\n\tinterface ShaderPad {\n\t\tsave(filename: string): Promise<void>;\n\t}\n}\n\nexport function save() {\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { gl, canvas } = context;\n\t\tconst downloadLink = document.createElement('a');\n\n\t\t(shaderPad as any).save = async function (filename: string) {\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\t\tgl.drawArrays(gl.TRIANGLES, 0, 6);\n\n\t\t\tif (filename && !`${filename}`.toLowerCase().endsWith('.png')) {\n\t\t\t\tfilename = `${filename}.png`;\n\t\t\t}\n\t\t\tfilename = filename || 'export.png';\n\t\t\tif ('ongesturechange' in window) {\n\t\t\t\t// Mobile.\n\t\t\t\ttry {\n\t\t\t\t\tconst blob: Blob = await new Promise(resolve =>\n\t\t\t\t\t\tcanvas.toBlob(resolve as BlobCallback, 'image/png')\n\t\t\t\t\t);\n\t\t\t\t\tconst file = new File([blob], filename, { type: blob.type });\n\n\t\t\t\t\tif (navigator.canShare?.({ files: [file] })) {\n\t\t\t\t\t\tawait navigator.share({ files: [file] });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.warn('Web Share API failed:', error);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Desktop.\n\t\t\t\tdownloadLink.download = filename;\n\t\t\t\tdownloadLink.href = canvas.toDataURL();\n\t\t\t\tdownloadLink.click();\n\t\t\t}\n\t\t};\n\t};\n}\n\n// Type helper.\nexport type WithSave<T extends ShaderPad> = T & {\n\tsave(filename: string): Promise<void>;\n};\n","import ShaderPad, { PluginContext, TextureSource } from '../index';\nimport type { FaceLandmarker, NormalizedLandmark } from '@mediapipe/tasks-vision';\n\nexport interface FacePluginOptions {\n\tmodelPath?: string;\n\tnumFaces?: number;\n\tminFaceDetectionConfidence?: number;\n\tminFacePresenceConfidence?: number;\n\tminTrackingConfidence?: number;\n\toutputFaceBlendshapes?: boolean;\n\toutputFacialTransformationMatrixes?: boolean;\n}\n\nconst LANDMARK_INDICES = {\n\tLEFT_EYEBROW: [336, 296, 334, 293, 300, 276, 283, 282, 295, 285],\n\tLEFT_EYE: [362, 398, 384, 385, 386, 387, 388, 466, 263, 249, 390, 373, 374, 380, 381, 382],\n\tLEFT_EYE_CENTER: 473,\n\tRIGHT_EYEBROW: [70, 63, 105, 66, 107, 55, 65, 52, 53, 46],\n\tRIGHT_EYE: [33, 246, 161, 160, 159, 158, 157, 173, 133, 155, 154, 153, 145, 144, 163, 7],\n\tRIGHT_EYE_CENTER: 468,\n\tNOSE_TIP: 4,\n\tOUTER_LIP: [61, 185, 40, 39, 37, 0, 267, 269, 270, 409, 291, 375, 321, 405, 314, 17, 84, 181, 91, 146],\n\tINNER_LIP: [78, 191, 80, 81, 82, 13, 312, 311, 310, 415, 308, 324, 318, 402, 317, 14, 87, 178, 88, 95],\n};\n\nexport function face(config: { textureName: string; options?: FacePluginOptions }) {\n\tconst { textureName, options } = config;\n\tconst defaultModelPath =\n\t\t'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/latest/face_landmarker.task';\n\n\treturn function (shaderPad: ShaderPad, context: PluginContext) {\n\t\tconst { uniforms } = context;\n\n\t\tlet faceLandmarker: FaceLandmarker | null = null;\n\t\tlet vision: any = null;\n\t\tlet lastVideoTime = -1;\n\t\tconst textureSources = new Map<string, TextureSource>();\n\n\t\tlet faceMaskCanvas: HTMLCanvasElement | null = null;\n\t\tlet faceMaskCtx: CanvasRenderingContext2D | null = null;\n\t\tconst maskWidth = 512;\n\t\tconst maskHeight = 512;\n\n\t\tfunction initializeMaskCanvas() {\n\t\t\tfaceMaskCanvas = document.createElement('canvas');\n\t\t\tfaceMaskCanvas.width = maskWidth;\n\t\t\tfaceMaskCanvas.height = maskHeight;\n\t\t\tfaceMaskCtx = faceMaskCanvas.getContext('2d')!;\n\t\t\tfaceMaskCtx.globalCompositeOperation = 'lighten'; // Keep the highest value of each channel.\n\t\t}\n\n\t\tasync function initializeFaceLandmarker() {\n\t\t\ttry {\n\t\t\t\tconst { FilesetResolver, FaceLandmarker } = await import('@mediapipe/tasks-vision');\n\t\t\t\tvision = await FilesetResolver.forVisionTasks(\n\t\t\t\t\t'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm'\n\t\t\t\t);\n\n\t\t\t\tfaceLandmarker = await FaceLandmarker.createFromOptions(vision, {\n\t\t\t\t\tbaseOptions: {\n\t\t\t\t\t\tmodelAssetPath: options?.modelPath || defaultModelPath,\n\t\t\t\t\t},\n\t\t\t\t\trunningMode: 'VIDEO',\n\t\t\t\t\tnumFaces: options?.numFaces ?? 1,\n\t\t\t\t\tminFaceDetectionConfidence: options?.minFaceDetectionConfidence ?? 0.5,\n\t\t\t\t\tminFacePresenceConfidence: options?.minFacePresenceConfidence ?? 0.5,\n\t\t\t\t\tminTrackingConfidence: options?.minTrackingConfidence ?? 0.5,\n\t\t\t\t\toutputFaceBlendshapes: options?.outputFaceBlendshapes ?? false,\n\t\t\t\t\toutputFacialTransformationMatrixes: options?.outputFacialTransformationMatrixes ?? false,\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('Failed to initialize Face Landmarker:', error);\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\n\t\tfunction calculateFaceCenter(landmarks: NormalizedLandmark[]): [number, number] {\n\t\t\tlet minX = Infinity,\n\t\t\t\tmaxX = -Infinity,\n\t\t\t\tminY = Infinity,\n\t\t\t\tmaxY = -Infinity;\n\n\t\t\t// Calculate bounding box center.\n\t\t\tfor (const landmark of landmarks) {\n\t\t\t\tminX = Math.min(minX, landmark.x);\n\t\t\t\tmaxX = Math.max(maxX, landmark.x);\n\t\t\t\tminY = Math.min(minY, landmark.y);\n\t\t\t\tmaxY = Math.max(maxY, landmark.y);\n\t\t\t}\n\n\t\t\tconst centerX = (minX + maxX) / 2;\n\t\t\tconst centerY = (minY + maxY) / 2;\n\t\t\treturn [centerX, centerY];\n\t\t}\n\n\t\tfunction fillRegion(landmarks: NormalizedLandmark[], color: { r: number; g: number; b: number }) {\n\t\t\tif (!faceMaskCtx) return;\n\t\t\tfaceMaskCtx.fillStyle = `rgb(${Math.round(color.r * 255)}, ${Math.round(color.g * 255)}, ${Math.round(\n\t\t\t\tcolor.b * 255\n\t\t\t)})`;\n\t\t\tconst origin = landmarks[0];\n\t\t\tfaceMaskCtx.beginPath();\n\t\t\tfaceMaskCtx.moveTo(origin.x * faceMaskCtx.canvas.width, origin.y * faceMaskCtx.canvas.height);\n\t\t\tfor (let i = 1; i < landmarks.length; i++) {\n\t\t\t\tconst destination = landmarks[i];\n\t\t\t\tfaceMaskCtx.lineTo(destination.x * faceMaskCtx.canvas.width, destination.y * faceMaskCtx.canvas.height);\n\t\t\t}\n\t\t\tfaceMaskCtx.closePath();\n\t\t\tfaceMaskCtx.fill();\n\t\t}\n\n\t\tasync function updateMaskTexture(landmarks: NormalizedLandmark[]) {\n\t\t\tif (!faceLandmarker || !faceMaskCanvas) {\n\t\t\t\tconsole.warn('[Face Plugin] Cannot update mask: faceLandmarker or canvas missing');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\t// Get MediaPipe landmark connection constants\n\t\t\t\tconst { FaceLandmarker } = await import('@mediapipe/tasks-vision');\n\n\t\t\t\tif (!faceMaskCtx) return;\n\t\t\t\tfaceMaskCtx.clearRect(0, 0, faceMaskCanvas.width, faceMaskCanvas.height);\n\n\t\t\t\t// Build combined mask with RGBA channels\n\t\t\t\t// R: Mouth | G: Face | B: Eyes\n\t\t\t\t// Mouth (red channel).\n\t\t\t\t// Lips.\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.OUTER_LIP.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{ r: 0.25, g: 0, b: 0 }\n\t\t\t\t);\n\t\t\t\t// Inner mouth.\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.INNER_LIP.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{ r: 0.75, g: 0, b: 0 }\n\t\t\t\t);\n\n\t\t\t\t// Face (green channel).\n\t\t\t\t// Entire face.\n\t\t\t\tfillRegion(\n\t\t\t\t\tFaceLandmarker.FACE_LANDMARKS_TESSELATION.map(({ start }) => landmarks[start]),\n\t\t\t\t\t{ r: 0, g: 0.25, b: 0 }\n\t\t\t\t);\n\t\t\t\t// Face contour (excludes nose in profile view).\n\t\t\t\tfillRegion(\n\t\t\t\t\tFaceLandmarker.FACE_LANDMARKS_FACE_OVAL.map(({ start }) => landmarks[start]),\n\t\t\t\t\t{ r: 0, g: 1, b: 0 }\n\t\t\t\t);\n\n\t\t\t\t// Eyes (blue channel).\n\t\t\t\t// Eyebrows.\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.LEFT_EYEBROW.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{\n\t\t\t\t\t\tr: 0,\n\t\t\t\t\t\tg: 0,\n\t\t\t\t\t\tb: 0.15,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.RIGHT_EYEBROW.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{\n\t\t\t\t\t\tr: 0,\n\t\t\t\t\t\tg: 0,\n\t\t\t\t\t\tb: 0.35,\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t\t// Eyes.\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.LEFT_EYE.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{ r: 0, g: 0, b: 0.65 }\n\t\t\t\t);\n\t\t\t\tfillRegion(\n\t\t\t\t\tLANDMARK_INDICES.RIGHT_EYE.map((idx: number) => landmarks[idx]),\n\t\t\t\t\t{ r: 0, g: 0, b: 0.85 }\n\t\t\t\t);\n\n\t\t\t\tshaderPad.updateTextures({ u_faceMask: faceMaskCanvas });\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('[Face Plugin] Failed to generate mask texture:', error);\n\t\t\t}\n\t\t}\n\n\t\tfunction processFaceResults(result: any) {\n\t\t\tif (!result.faceLandmarks || result.faceLandmarks.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst landmarks = result.faceLandmarks[0]; // HACK: Use first detected face. Might want to support multiple faces in the future.\n\t\t\tif (!landmarks || landmarks.length !== 478) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst faceCenter = calculateFaceCenter(landmarks);\n\t\t\tconst leftEye: [number, number] = [\n\t\t\t\tlandmarks[LANDMARK_INDICES.LEFT_EYE_CENTER].x,\n\t\t\t\tlandmarks[LANDMARK_INDICES.LEFT_EYE_CENTER].y,\n\t\t\t];\n\t\t\tconst rightEye: [number, number] = [\n\t\t\t\tlandmarks[LANDMARK_INDICES.RIGHT_EYE_CENTER].x,\n\t\t\t\tlandmarks[LANDMARK_INDICES.RIGHT_EYE_CENTER].y,\n\t\t\t];\n\t\t\tconst noseTip: [number, number] = [\n\t\t\t\tlandmarks[LANDMARK_INDICES.NOSE_TIP].x,\n\t\t\t\tlandmarks[LANDMARK_INDICES.NOSE_TIP].y,\n\t\t\t];\n\n\t\t\tconsole.log(faceCenter, leftEye, rightEye, noseTip);\n\n\t\t\tupdateMaskTexture(landmarks).catch(error => {\n\t\t\t\tconsole.warn('Mask texture update error:', error);\n\t\t\t});\n\n\t\t\t// Update uniforms with Y-axis inverted to match WebGL coordinate system.\n\t\t\tif (uniforms.has('u_faceCenter')) {\n\t\t\t\tshaderPad.updateUniforms({ u_faceCenter: [faceCenter[0], 1.0 - faceCenter[1]] });\n\t\t\t}\n\t\t\tif (uniforms.has('u_leftEye')) {\n\t\t\t\tshaderPad.updateUniforms({ u_leftEye: [leftEye[0], 1.0 - leftEye[1]] });\n\t\t\t}\n\t\t\tif (uniforms.has('u_rightEye')) {\n\t\t\t\tshaderPad.updateUniforms({ u_rightEye: [rightEye[0], 1.0 - rightEye[1]] });\n\t\t\t}\n\t\t\tif (uniforms.has('u_noseTip')) {\n\t\t\t\tshaderPad.updateUniforms({ u_noseTip: [noseTip[0], 1.0 - noseTip[1]] });\n\t\t\t}\n\t\t}\n\n\t\tshaderPad.registerHook('init', async () => {\n\t\t\tinitializeMaskCanvas();\n\t\t\tawait initializeFaceLandmarker();\n\t\t\tif (!faceMaskCanvas) {\n\t\t\t\tthrow new Error('Face mask canvas not initialized');\n\t\t\t}\n\t\t\tshaderPad.initializeTexture('u_faceMask', faceMaskCanvas);\n\t\t\tshaderPad.initializeUniform('u_faceCenter', 'float', [0.5, 0.5]);\n\t\t\tshaderPad.initializeUniform('u_leftEye', 'float', [0.5, 0.5]);\n\t\t\tshaderPad.initializeUniform('u_rightEye', 'float', [0.5, 0.5]);\n\t\t\tshaderPad.initializeUniform('u_noseTip', 'float', [0.5, 0.5]);\n\t\t});\n\n\t\tshaderPad.registerHook('updateTextures', (updates: Record<string, TextureSource>) => {\n\t\t\tObject.entries(updates).forEach(([name, source]) => {\n\t\t\t\tif (name !== textureName) return;\n\t\t\t\ttextureSources.set(name, source);\n\t\t\t\tif (!faceLandmarker) return;\n\t\t\t\ttry {\n\t\t\t\t\tif (source instanceof HTMLVideoElement) {\n\t\t\t\t\t\tif (source.currentTime !== lastVideoTime) {\n\t\t\t\t\t\t\tlastVideoTime = source.currentTime;\n\t\t\t\t\t\t\tconst timestamp = performance.now();\n\t\t\t\t\t\t\tconst result = faceLandmarker.detectForVideo(source, timestamp);\n\t\t\t\t\t\t\tprocessFaceResults(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (source instanceof HTMLImageElement) {\n\t\t\t\t\t\tconst result = faceLandmarker.detect(source);\n\t\t\t\t\t\tprocessFaceResults(result);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.warn('Face detection error:', error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tshaderPad.registerHook('destroy', () => {\n\t\t\tif (faceLandmarker) {\n\t\t\t\tfaceLandmarker.close();\n\t\t\t\tfaceLandmarker = null;\n\t\t\t}\n\t\t\tvision = null;\n\t\t\ttextureSources.clear();\n\t\t\tfaceMaskCanvas = null;\n\t\t});\n\t};\n}\n\nexport type WithFace<T extends ShaderPad> = T;\n"],"mappings":"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","names":["index_exports","__export","index_default","face","history","save","__toCommonJS","getSourceDimensions","source","clearHistoryTextureLayers","gl","width","height","depth","transparent","layer","createHistoryTexture","texture","history","framebufferDepth","shaderPad","context","uniforms","textures","reserveTextureUnit","shaderPadWithHistory","originalInitializeTexture","originalUpdateTextures","historyTextureInfo","framebufferHistoryTexture","initializeFramebufferHistory","clearFramebufferHistory","_time","frame","writeIdx","info","name","historyDepth","unitIndex","uSampler","error","updates","textureInfo","historyInfo","writeIndex","save","shaderPad","context","gl","canvas","downloadLink","filename","blob","resolve","file","error","LANDMARK_INDICES","face","config","textureName","options","defaultModelPath","shaderPad","context","uniforms","faceLandmarker","vision","lastVideoTime","textureSources","faceMaskCanvas","faceMaskCtx","maskWidth","maskHeight","initializeMaskCanvas","initializeFaceLandmarker","FilesetResolver","FaceLandmarker","error","calculateFaceCenter","landmarks","minX","maxX","minY","maxY","landmark","centerX","centerY","fillRegion","color","origin","i","destination","updateMaskTexture","idx","start","processFaceResults","result","faceCenter","leftEye","rightEye","noseTip","updates","name","source","timestamp","DEFAULT_VERTEX_SHADER_SRC","RESIZE_THROTTLE_INTERVAL","ShaderPad","fragmentShaderSrc","options","context","plugin","name","fn","vertexShaderSrc","vertexShader","fragmentShader","aPosition","hook","type","source","shader","quadVertices","now","timeUntilNextResize","pixelRatio","width","height","updateCursor","x","y","rect","updateClick","isMouseDown","xVal","yVal","event","mouseEvent","touchEvent","listener","existing","value","location","length","updates","uniform","texture","unitIndex","error","uSampler","info","time","gl","callback","loop","index_default"]}